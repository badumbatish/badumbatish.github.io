<!DOCTYPE html><html lang="en" class="px-4 py-4"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/7385e8d9d3c5518f-s.p.ttf" as="font" crossorigin="" type="font/ttf"/><link rel="stylesheet" href="/_next/static/css/d9bc7f7efd1039ef.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/7ad14cf05ba66ef7.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-a3e322df7e912d9b.js"/><script src="/_next/static/chunks/4bd1b696-436c238309a8f4af.js" async=""></script><script src="/_next/static/chunks/517-2d9b4e2e142759c9.js" async=""></script><script src="/_next/static/chunks/main-app-64657d68b3fa7103.js" async=""></script><script src="/_next/static/chunks/173-09f9817a8afa96b6.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bid%5D/page-0a046863f2056281.js" async=""></script><script src="/_next/static/chunks/970-1bb5a11d460674d4.js" async=""></script><script src="/_next/static/chunks/app/layout-8efea218579f6a1a.js" async=""></script><meta name="next-size-adjust" content=""/><title>What after Kaleidoscope: Error location</title><meta name="description" content="Jasmine discusses a simple error/warn/log method after Kaleidoscope."/><link rel="icon" href="/_next/static/media/pfp5.0daa0f7d.jpeg"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__className_d4e0c8 flex flex-col min-h-screen"><a href="/"><div class="flex justify-center items-center py-4 "><h1 class="text-4xl font-bold">Jasmine Tang</h1></div></a><div class="flex-1"><div class="py-12 flex flex-col items-center  justify-items-start mx-auto "><a class="flex justify-center text-4xl" href="/blog"><h2>My blog</h2></a><article class="p-8 prose pt-0.5 max-w-none w-full lg:w-1/2 md:w-4/6 sm:w-5/6 prose-sky mx-auto"><div class="flex justify-center text-2xl font-bold "><h2>What after Kaleidoscope: Error location</h2></div><div class="flex justify-start text-xl font-bold underline"><h4>2025-02-27</h4></div><div><nav class="toc"><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#prologue">Prologue</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#introduction">Introduction</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#location-reporter-locator-and-reporter">Location, Reporter, Locator and Reporter</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h4"><a class="toc-link toc-link-h4" href="#the-location-class">The Location class</a></li><li class="toc-item toc-item-h4"><a class="toc-link toc-link-h4" href="#the-reportee-class">The Reportee class</a></li><li class="toc-item toc-item-h4"><a class="toc-link toc-link-h4" href="#the-reporter-class">The Reporter class</a></li><li class="toc-item toc-item-h4"><a class="toc-link toc-link-h4" href="#the-locator-class">The Locator class</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#tokens-and-the-lexer">Tokens (and the lexer)</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#ast-nodes-and-the-parser">AST nodes (and the parser)</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#study-case-scope-checking-visitor">Study case: scope checking visitor</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#class-lexical-scope">class Lexical Scope</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#visiting">Visiting</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#result">Result</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#whats-next">What's next?</a></li></ol></nav><h2 id="prologue"><a aria-hidden="true" tabindex="-1" href="#prologue"><span class="icon icon-link"></span></a>Prologue</h2>
<p>Hi everyone, wow, it's been a quick minute since I posted a new article. How's everyone doing :) I'm still trucking
away at life applying to compiler jobs as well as schooling at Berk. Hope everybody's doing great :)</p>
<p>This
article is for
people
who might be
asking:</p>
<p>"Ok, I've done the <a href="https://llvm.org/docs/tutorial/MyFirstLanguageFrontend/index.html" rel="nofollow" target="_blank">llvm tutorial</a> already.
What's next?"</p>
<p>More specifically, the article is about adding primitive support for error reporting to the
toy compiler. The article assumes some familiarity with lexer, parsing and the visitor pattern. Some familiarity with
the parser and its abstract syntax tree (<a href="https://dev.to/balapriya/abstract-syntax-tree-ast-explained-in-plain-english-1h38" rel="nofollow" target="_blank">AST</a>) construction from the <a href="https://llvm.org/docs/tutorial/MyFirstLanguageFrontend/index.html" rel="nofollow" target="_blank">llvm tutorial</a>
is helpful
but not necessary.</p>
<p>Besides that, the article is also to share my software design decisions regarding my compiler's diagnostics and to
improve my technical writing ability.</p>
<p>As is tradition :) I also wanna share some songs with you. The two songs are <a href="https://www.youtube.com/watch?v=r-zubTTp8Tg&#x26;ab_channel=COIN" rel="nofollow" target="_blank">Valentine</a> and <a href="https://www.youtube.com/watch?v=XvG12DVUCNg&#x26;ab_channel=COIN" rel="nofollow" target="_blank">Into my arms</a>,
both by COIN, one of my fav bands :) To me, Valentine is this flirty and fun—like a rush of butterflies, you know?
It’s got that energetic, dreamy beat that feels like falling in love for the first time. But Into My Arms' this
pure intimacy, deep, and emotional calling. It's as if the singer knows what they really wants and they're just
pulling at the heartstrings and begging
you to just melt
into
someone’s
embrace.</p>
<p>Sigh, at this point you might be thinking I must be writing blogs just to share and review music, huh? :) Smh</p>
<p>I hope you enjoy :) (both the songs and the blog hahah)</p>
<h2 id="introduction"><a aria-hidden="true" tabindex="-1" href="#introduction"><span class="icon icon-link"></span></a>Introduction</h2>
<p>Compiler diagnostics is an important aspect in one's compiler. From erroring out on the programmer's mistake to
providing warnings or giving diagnostics, the ability to accurately locate the location of the pesky problems to said
programmer is proven to be extremely valuable: only providing to the programmer the row and column number of where an error occurs is less helpful and more confusing than a compiler pointing, tracing and explaining an error to a programmer.</p>
<p>The article then discusses a way to improve upon the llvm Kaleidoscope toy compiler in the diagnostic aspect for the
user. The picture below shows the difference between a primitive and a somewhat sophisticated
error
diagnostics scheme and is implemented as
part of
the sammine
compiler.</p>
<p><img src="/blogs/what_after_kalei_location_debug/comparison.png" alt="comparison between"></p>
<h2 id="location-reporter-locator-and-reporter"><a aria-hidden="true" tabindex="-1" href="#location-reporter-locator-and-reporter"><span class="icon icon-link"></span></a>Location, Reporter, Locator and Reporter</h2>
<p>Let's start with a simple description of the problem and a simple answer to the said problem.</p>
<blockquote>
<p>Given a string (which is the input of the compiler), and a starting point index and an ending point index of said
string, indicate the component (either a token or a subpart of some AST) that is faulty.</p>
</blockquote>
<p>Below shows a string of a <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">variable definition </span></span></code></span> and its corresponding starting and ending point in
the input
string:</p>
<pre><code>start of decl
|       end of decl
|       |
↓       ↓
01234556789
let x = 1;\eof
</code></pre>
<p>Here, the starting point for the let expr has index 0 in
the string, and the ending point for the let expr has index 7 in the string (the semicolon at 8 is not counted).</p>
<p>From first principles, how can a compiler consolidate the location of these tokens: <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">let</span></span></code></span>, <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">x</span></span></code></span>, <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#81C8BE">=</span></span></code></span>, <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#EF9F76">1</span></span></code></span>
together and understand that the declaration spans from 0 to 7?</p>
<p>Let us define the class <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Location</span></span></code></span>, <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Reportee</span></span></code></span>
and <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Reporter</span></span></code></span> currently implemented as part of the compiler and see how all of these building blocks fit in together.</p>
<h4 id="the-location-class"><a aria-hidden="true" tabindex="-1" href="#the-location-class"><span class="icon icon-link"></span></a>The Location class</h4>
<p>The <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Location</span></span></code></span> class is basically two indices, indicating the location of a construct in the
input string. The first index
<span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">source_start</span></span></code></span>
signifies the
starting location of a component and vice versa for <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">source_end</span></span></code></span>. If a construct in the compiler (a token or an AST)
only occupies a single space, then <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">source_start</span></span></code></span> == <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">source_end</span></span></code></span>.</p>
<p>When two <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Location</span></span></code></span>s come together to form one singular <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Location</span></span></code></span>, we take the minimum of all
<span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">source_start</span></span></code></span> and the maximum of all the <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">source_end</span></span></code></span>. This is implemented as the pipe operator <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#81C8BE">|</span></span></code></span> for the class:</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#737994;font-style:italic">// Combine two locations</span></span>
<span class="line"><span style="color:#E5C890;font-style:italic">Location</span><span style="color:#CA9EE6"> operator</span><span style="color:#C6D0F5">|</span><span style="color:#949CBB">(</span><span style="color:#CA9EE6">const</span><span style="color:#E5C890;font-style:italic"> Location</span><span style="color:#81C8BE"> &#x26;</span><span style="color:#EA999C;font-style:italic">other</span><span style="color:#949CBB">)</span><span style="color:#CA9EE6"> const</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#C6D0F5">    Location result</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#C6D0F5">    result</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">source_start </span><span style="color:#81C8BE">=</span><span style="color:#E5C890"> std</span><span style="color:#949CBB">::</span><span style="color:#8CAAEE;font-style:italic">min</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">source_start</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> other</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">source_start</span><span style="color:#949CBB">);</span></span>
<span class="line"><span style="color:#C6D0F5">    result</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">source_end </span><span style="color:#81C8BE">=</span><span style="color:#E5C890"> std</span><span style="color:#949CBB">::</span><span style="color:#8CAAEE;font-style:italic">max</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">source_end</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> other</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">source_end</span><span style="color:#949CBB">);</span></span>
<span class="line"><span style="color:#CA9EE6">    return</span><span style="color:#C6D0F5"> result</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#949CBB">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CA9EE6">void</span><span style="color:#CA9EE6"> operator</span><span style="color:#C6D0F5">|=</span><span style="color:#949CBB">(</span><span style="color:#CA9EE6">const</span><span style="color:#E5C890;font-style:italic"> Location</span><span style="color:#81C8BE"> &#x26;</span><span style="color:#EA999C;font-style:italic">other</span><span style="color:#949CBB">)</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#C6D0F5">    source_start </span><span style="color:#81C8BE">=</span><span style="color:#E5C890"> std</span><span style="color:#949CBB">::</span><span style="color:#8CAAEE;font-style:italic">min</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">source_start</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> other</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">source_start</span><span style="color:#949CBB">);</span></span>
<span class="line"><span style="color:#C6D0F5">    source_end </span><span style="color:#81C8BE">=</span><span style="color:#E5C890"> std</span><span style="color:#949CBB">::</span><span style="color:#8CAAEE;font-style:italic">max</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">source_end</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> other</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">source_end</span><span style="color:#949CBB">);</span></span>
<span class="line"><span style="color:#949CBB">}</span></span></code></pre>
<p>Let's look at an example, given the string of a binary expression <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">x</span><span style="color:#81C8BE">+</span><span style="color:#C6D0F5">y</span></span></code></span>, since <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">x</span></span></code></span> takes the <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#8CAAEE;font-style:italic">Location</span><span style="color:#949CBB">(</span><span style="color:#EF9F76">0</span><span style="color:#949CBB">,</span><span style="color:#EF9F76">0</span><span style="color:#949CBB">)</span></span></code></span>, <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">y</span></span></code></span>
takes the <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#8CAAEE;font-style:italic">Location</span><span style="color:#949CBB">(</span><span style="color:#EF9F76">2</span><span style="color:#949CBB">,</span><span style="color:#EF9F76">2</span><span style="color:#949CBB">)</span></span></code></span>. The location for the resulting binary expression is <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#8CAAEE;font-style:italic">Location</span><span style="color:#949CBB">(</span><span style="color:#8CAAEE;font-style:italic">min</span><span style="color:#949CBB">(</span><span style="color:#EF9F76">0</span><span style="color:#949CBB">,</span><span style="color:#EF9F76">2</span><span style="color:#949CBB">),</span><span style="color:#8CAAEE;font-style:italic"> max</span><span style="color:#949CBB">(</span><span style="color:#EF9F76">0</span><span style="color:#949CBB">,</span><span style="color:#EF9F76">2</span><span style="color:#949CBB">))</span><span style="color:#81C8BE"> =</span><span style="color:#8CAAEE;font-style:italic"> Location</span><span style="color:#949CBB">(</span><span style="color:#EF9F76">0</span><span style="color:#949CBB">,</span><span style="color:#EF9F76"> 2</span><span style="color:#949CBB">)</span></span></code></span>.</p>
<p>Another thing to notice is that the Location class offers modifiers on <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">source_end</span></span></code></span>, this is mostly useful in the
case of lexing different token such as <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#81C8BE">+</span></span></code></span> and <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#81C8BE">+=</span></span></code></span> - often in sammine I have to backtrack and thus this is really
helpful.</p>
<h4 id="the-reportee-class"><a aria-hidden="true" tabindex="-1" href="#the-reportee-class"><span class="icon icon-link"></span></a>The Reportee class</h4>
<p>Given a location, we need a message to be associated with it, together with the diagnostic kind: Is this message an
error? Is it a warning? Is this just to provide the programmer/compiler writer with some extra information for an
informed decision?</p>
<p>The class that takes care of this is the <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Reportee</span></span></code></span> class. It defines different <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">ReportKind</span></span></code></span> such as <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">error</span></span></code></span>,
<span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">warn</span></span></code></span> or <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">diag</span></span></code></span> for error, warning or diagnostics respectively. It also provides abstraction such as <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#8CAAEE;font-style:italic">add_error</span><span style="color:#949CBB">()</span></span></code></span>,
<span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#8CAAEE;font-style:italic">add_warn</span><span style="color:#949CBB">()</span></span></code></span> or <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">add_diag</span></span></code></span> for said <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">ReportKind</span></span></code></span>s. The input to these <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">add_</span><span style="color:#81C8BE">*</span><span style="color:#949CBB">()</span></span></code></span> call is a <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Report</span></span></code></span> type, which is
just a tuple of <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">ReportKind</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> Location</span><span style="color:#949CBB">,</span><span style="color:#E5C890"> std</span><span style="color:#949CBB">::</span><span style="color:#C6D0F5">string</span></span></code></span>.</p>
<p>Who's calling <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#8CAAEE;font-style:italic">add_error</span><span style="color:#949CBB">()</span></span></code></span> and <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#8CAAEE;font-style:italic">add_warn</span><span style="color:#949CBB">()</span></span></code></span>? Whichever phase the compiler needs to communicate with the
programmer
about, that phase will inherit from this <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Reportee</span></span></code></span> class and use these utilities functions. The sections on Lexer and
Parser will go over these finer details.</p>
<p>Besides this, the <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Reportee</span></span></code></span> class also carries <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#CA9EE6">size_t</span></span></code></span> of <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">error_count</span></span></code></span>, <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">warn_count</span></span></code></span> and
<span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">diag_count</span></span></code></span> to be used as statistics for the <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Reporter</span></span></code></span> class, which is the topic of our next subsection.</p>
<h4 id="the-reporter-class"><a aria-hidden="true" tabindex="-1" href="#the-reporter-class"><span class="icon icon-link"></span></a>The Reporter class</h4>
<p>The compiler
needs to 'report' messages coming from different stages (Reportee) such as lexing, parsing or type checking, of
which the <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Reporter</span></span></code></span> class is in charge.</p>
<p>Upon construction, it takes in a file name, the source code string, and the context radius. For example, if the context
radius is 2, then if we're reporting on 1 line of code at line 3, we would print out from line 1 to line 5 (via the
Locator class).</p>
<p>Then it splits this source code string into different strings seperated by newlines, and constructs a <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#E5C890">std</span><span style="color:#949CBB">::</span><span style="color:#C6D0F5">vector</span></span></code></span>
of pairs of the running sum lengths of all the strings up to the current string and the current
string. This is implemented as <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#E5C890">Reporter</span><span style="color:#949CBB">::</span><span style="color:#C6D0F5">get_diagnostic_data</span></span></code></span> and the result is stored as an intermediary
ingredient for the <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Locator</span></span></code></span> class:</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#CA9EE6">using</span><span style="color:#E5C890;font-style:italic"> DiagnosticData</span><span style="color:#81C8BE"> =</span><span style="color:#E5C890"> std</span><span style="color:#949CBB">::</span><span style="color:#E5C890;font-style:italic">vector</span><span style="color:#949CBB">&#x3C;</span><span style="color:#E5C890">std</span><span style="color:#949CBB">::</span><span style="color:#E5C890;font-style:italic">pair</span><span style="color:#949CBB">&#x3C;</span><span style="color:#E5C890">std</span><span style="color:#949CBB">::</span><span style="color:#CA9EE6">size_t</span><span style="color:#949CBB">,</span><span style="color:#E5C890"> std</span><span style="color:#949CBB">::</span><span style="color:#E5C890;font-style:italic">string_view</span><span style="color:#949CBB">>>;</span></span>
<span class="line"><span style="color:#E5C890;font-style:italic">DiagnosticData</span><span style="color:#E5C890"> Reporter</span><span style="color:#949CBB">::</span><span style="color:#8CAAEE;font-style:italic">get_diagnostic_data</span><span style="color:#949CBB">(</span><span style="color:#E5C890">std</span><span style="color:#949CBB">::</span><span style="color:#E5C890;font-style:italic">string_view</span><span style="color:#EA999C;font-style:italic"> str</span><span style="color:#949CBB">)</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#C6D0F5">  DiagnosticData result</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#CA9EE6">  size_t</span><span style="color:#C6D0F5"> start </span><span style="color:#81C8BE">=</span><span style="color:#EF9F76"> 0</span><span style="color:#949CBB">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CA9EE6">  while</span><span style="color:#949CBB"> (</span><span style="color:#C6D0F5">start </span><span style="color:#81C8BE">&#x3C;</span><span style="color:#C6D0F5"> str</span><span style="color:#949CBB">.</span><span style="color:#8CAAEE;font-style:italic">size</span><span style="color:#949CBB">())</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#CA9EE6">    size_t</span><span style="color:#C6D0F5"> end </span><span style="color:#81C8BE">=</span><span style="color:#C6D0F5"> str</span><span style="color:#949CBB">.</span><span style="color:#8CAAEE;font-style:italic">find</span><span style="color:#949CBB">(</span><span style="color:#A6D189">'</span><span style="color:#F4B8E4">\n</span><span style="color:#A6D189">'</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> start</span><span style="color:#949CBB">);</span></span>
<span class="line"><span style="color:#CA9EE6">    if</span><span style="color:#949CBB"> (</span><span style="color:#C6D0F5">end </span><span style="color:#81C8BE">==</span><span style="color:#E5C890"> std</span><span style="color:#949CBB">::</span><span style="color:#E5C890">string_view</span><span style="color:#949CBB">::</span><span style="color:#C6D0F5">npos</span><span style="color:#949CBB">)</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#737994;font-style:italic">      // Add the last substring if no more newlines are found</span></span>
<span class="line"><span style="color:#C6D0F5">      result</span><span style="color:#949CBB">.</span><span style="color:#8CAAEE;font-style:italic">push_back</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">{start</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> str</span><span style="color:#949CBB">.</span><span style="color:#8CAAEE;font-style:italic">substr</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">start</span><span style="color:#949CBB">)</span><span style="color:#C6D0F5">}</span><span style="color:#949CBB">);</span></span>
<span class="line"><span style="color:#CA9EE6">      break</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#949CBB">    }</span></span>
<span class="line"><span style="color:#737994;font-style:italic">    // Add the substring excluding the newline character</span></span>
<span class="line"><span style="color:#C6D0F5">    result</span><span style="color:#949CBB">.</span><span style="color:#8CAAEE;font-style:italic">push_back</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">{start</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> str</span><span style="color:#949CBB">.</span><span style="color:#8CAAEE;font-style:italic">substr</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">start</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> end </span><span style="color:#81C8BE">-</span><span style="color:#C6D0F5"> start</span><span style="color:#949CBB">)</span><span style="color:#C6D0F5">}</span><span style="color:#949CBB">);</span></span>
<span class="line"><span style="color:#C6D0F5">    start </span><span style="color:#81C8BE">=</span><span style="color:#C6D0F5"> end </span><span style="color:#81C8BE">+</span><span style="color:#EF9F76"> 1</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#949CBB">  }</span></span>
<span class="line"><span style="color:#CA9EE6">  return</span><span style="color:#C6D0F5"> result</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#949CBB">}</span></span></code></pre>
<p>Then, the <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Reporter</span></span></code></span> class takes in a <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Report</span></span></code></span>, a tuple of <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">ReportKind</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> Location</span><span style="color:#949CBB">,</span><span style="color:#E5C890"> std</span><span style="color:#949CBB">::</span><span style="color:#C6D0F5">string</span></span></code></span> and
print the message via stderr to the programmer; it also knows that for a specific
<span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">ReportKind</span></span></code></span>, which color should be printed.</p>
<h4 id="the-locator-class"><a aria-hidden="true" tabindex="-1" href="#the-locator-class"><span class="icon icon-link"></span></a>The Locator class</h4>
<p>You must be wondering, just the linear <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#949CBB">(</span><span style="color:#C6D0F5">source_start</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> source_end</span><span style="color:#949CBB">)</span></span></code></span> indices is not enough, this result is just
the
bare
minimum.
Somehow the compiler needs to be able to map a location of <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#949CBB"> (</span><span style="color:#C6D0F5">source_start</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> source_end</span><span style="color:#949CBB">)</span></span></code></span> to the starting and ending rows and columns for easier visualization.
What if we also want some lines of code before and
after the concerning line of code for more context, how would we do that?
Maybe if the <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Location</span></span></code></span> needed to be
reported is one,
or two,
or
three lines only, and it'd be very helpful to hone in and point out the mistake for the programmer.</p>
<p>To do this, the <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Locator</span></span></code></span>, with the <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">source_start</span></span></code></span> and <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">source_end</span></span></code></span>, consecutively performs binary search on the
<span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">DiagnosticData</span></span></code></span>
given by the <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Reporter</span></span></code></span>,
and
returns the row and column needed for reporting.</p>
<p>This is why we're making <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">DiagnosticData</span></span></code></span> to be a vector of
pairs where the first element is monotonically increasing: we can binary search on the first element of the pair to
get out the index of the vector (which tells us what row it is), as well as the second element of said index (which
allows us to print out the involving row). The reduction from <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mi>n</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(ln(n))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">))</span></span></span></span> is a much-needed break once the
compiler input exceeds 10,000 rows or more with multiple files.</p>
<p>It then subtracts and adds, respectively on these rows obtained from
<span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">source_start</span></span></code></span> and <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">source_end</span></span></code></span>, the provided <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">context_radius</span></span></code></span> to get the final rows and columns
result,
usable by the <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Reporter</span></span></code></span> class.</p>
<h2 id="tokens-and-the-lexer"><a aria-hidden="true" tabindex="-1" href="#tokens-and-the-lexer"><span class="icon icon-link"></span></a>Tokens (and the lexer)</h2>
<p>Wewwww....
Let's talk about the tokens and the lexer. When given the source code as a string (maybe via a file), the lexer
scans from left to right on that string, each time incrementing the index on the string and returning a token.
Thus, this is the basis of our class Location.</p>
<p>In sammine, tokens are (loosely) modeled as:</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#CA9EE6">class</span><span style="color:#E5C890;font-style:italic"> Token</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#CA9EE6">public</span><span style="color:#949CBB">:</span></span>
<span class="line"><span style="color:#C6D0F5">    TokenType type</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#E5C890">    std</span><span style="color:#949CBB">::</span><span style="color:#C6D0F5">string lexeme</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#C6D0F5">    Location location</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#8CAAEE;font-style:italic">    Token</span><span style="color:#949CBB">(</span><span style="color:#E5C890;font-style:italic">TokenType</span><span style="color:#EA999C;font-style:italic"> type</span><span style="color:#949CBB">,</span><span style="color:#E5C890"> std</span><span style="color:#949CBB">::</span><span style="color:#E5C890;font-style:italic">string</span><span style="color:#EA999C;font-style:italic"> lexeme</span><span style="color:#949CBB">,</span><span style="color:#E5C890;font-style:italic"> Location</span><span style="color:#EA999C;font-style:italic"> location</span><span style="color:#949CBB">)</span></span>
<span class="line"><span style="color:#949CBB">      :</span><span style="color:#8CAAEE;font-style:italic"> type</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">type</span><span style="color:#949CBB">),</span><span style="color:#8CAAEE;font-style:italic"> lexeme</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">std</span><span style="color:#949CBB">::</span><span style="color:#8CAAEE;font-style:italic">move</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">lexeme</span><span style="color:#949CBB">)),</span><span style="color:#8CAAEE;font-style:italic"> location</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">location</span><span style="color:#949CBB">)</span><span style="color:#949CBB"> {}</span></span>
<span class="line"><span style="color:#949CBB">};</span></span></code></pre>
<p>and for the lexer:</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#CA9EE6">class</span><span style="color:#E5C890;font-style:italic"> Lexer</span><span style="color:#949CBB"> :</span><span style="color:#CA9EE6"> public</span><span style="color:#E5C890"> sammine_util</span><span style="color:#949CBB">::</span><span style="color:#E5C890;font-style:italic">Reportee</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#CA9EE6">private</span><span style="color:#949CBB">:</span></span>
<span class="line"><span style="color:#E5C890">    sammine_util</span><span style="color:#949CBB">::</span><span style="color:#C6D0F5">Location location</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#E5C890">    std</span><span style="color:#949CBB">::</span><span style="color:#C6D0F5">vector</span><span style="color:#81C8BE">&#x3C;</span><span style="color:#C6D0F5">Token</span><span style="color:#81C8BE">></span><span style="color:#C6D0F5"> tokStream</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#C6D0F5">    ...</span></span></code></pre>
<p>One thing to note is after we've recognized a token together with its <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Location</span></span></code></span>, we update the Location of the
Lexer via <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#8CAAEE;font-style:italic">update_location</span><span style="color:#949CBB">()</span></span></code></span>.</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#CA9EE6">void</span><span style="color:#E5C890"> Lexer</span><span style="color:#949CBB">::</span><span style="color:#8CAAEE;font-style:italic">updateLocation</span><span style="color:#949CBB">()</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#C6D0F5">    location </span><span style="color:#81C8BE">=</span><span style="color:#E5C890"> sammine_util</span><span style="color:#949CBB">::</span><span style="color:#8CAAEE;font-style:italic">Location</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">location</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">source_end</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> location</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">source_end</span><span style="color:#949CBB">);</span></span>
<span class="line"><span style="color:#949CBB">}</span></span></code></pre>
<p>The reasoning for this is that if we don't do this, then in the following example, the
token <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#81C8BE">+=</span></span></code></span> as well as the token <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">b</span></span></code></span> will have inaccurate locations, spanning from the start of the input to the
current index.</p>
<pre><code>Location a: (0, 0)
| Location +=: (0, 3)
| |  Location b: (0, 5)
↓ ↓  ↓
012345
a += b
</code></pre>
<h2 id="ast-nodes-and-the-parser"><a aria-hidden="true" tabindex="-1" href="#ast-nodes-and-the-parser"><span class="icon icon-link"></span></a>AST nodes (and the parser)</h2>
<p>After we've produced our tokens, the parser takes in the stream of tokens and produces our ASTs. An AST is created
after identification for a specific ordering of some tokens.</p>
<p>For this newly created AST, the simple thing to do is to combine all the AST's token's location into one. Below shows
pseudocode for that</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#8CAAEE;font-style:italic">AST_construct</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">Token tok1</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> Token tok2</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> ...</span><span style="color:#949CBB">)</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#C6D0F5">    ...</span></span>
<span class="line"><span style="color:#C6D0F5">    AST</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">Location </span><span style="color:#81C8BE">=</span><span style="color:#C6D0F5"> first token location of AST</span></span>
<span class="line"><span style="color:#C6D0F5">    For all tokens T that made up the AST</span><span style="color:#949CBB">:</span></span>
<span class="line"><span style="color:#C6D0F5">        AST</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">Location </span><span style="color:#81C8BE">|=</span><span style="color:#C6D0F5"> T</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">location</span></span>
<span class="line"><span style="color:#C6D0F5">    ...</span></span>
<span class="line"><span style="color:#949CBB">}</span></span></code></pre>
<p>In AST construction, we follow quite literally what the parser is parsing, for the following example: there is an
AST of function with an AST
of expr being nested in it (as a list of expressions).</p>
<pre><code>fn f(x : f64) {
    let y = 0;
}
</code></pre>
<p>The code block then translates to this pseudocode c++ structure:</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#CA9EE6">class</span><span style="color:#E5C890;font-style:italic"> AST_Func</span><span style="color:#949CBB"> {</span><span style="color:#737994;font-style:italic"> // this stands for fn f</span></span>
<span class="line"><span style="color:#C6D0F5">    AST_Prototype prototype </span><span style="color:#949CBB">{</span></span>
<span class="line"><span style="color:#E5C890">        std</span><span style="color:#949CBB">::</span><span style="color:#C6D0F5">string func_name</span><span style="color:#737994;font-style:italic"> // stands for the name `f`</span></span>
<span class="line"><span style="color:#E5C890">        std</span><span style="color:#949CBB">::</span><span style="color:#C6D0F5">vector</span><span style="color:#81C8BE">&#x3C;</span><span style="color:#C6D0F5">AST_TypedVar</span><span style="color:#81C8BE">></span><span style="color:#C6D0F5"> function_arguments</span><span style="color:#737994;font-style:italic"> // this stands for `x : 64`</span></span>
<span class="line"><span style="color:#949CBB">    }</span></span>
<span class="line"><span style="color:#C6D0F5">    AST_Block function_block </span><span style="color:#949CBB">{</span></span>
<span class="line"><span style="color:#E5C890">        std</span><span style="color:#949CBB">::</span><span style="color:#C6D0F5">vector</span><span style="color:#81C8BE">&#x3C;</span><span style="color:#E5C890">AST</span><span style="color:#949CBB">::</span><span style="color:#C6D0F5">Expr</span><span style="color:#81C8BE">></span><span style="color:#C6D0F5"> statements</span><span style="color:#737994;font-style:italic"> // this stands for a singular `let y = 0;`</span></span>
<span class="line"><span style="color:#949CBB">    }</span></span>
<span class="line"><span style="color:#949CBB">}</span></span></code></pre>
<h2 id="study-case-scope-checking-visitor"><a aria-hidden="true" tabindex="-1" href="#study-case-scope-checking-visitor"><span class="icon icon-link"></span></a>Study case: scope checking visitor</h2>
<p>Knowing how a <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Location</span></span></code></span> plays out in a <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">lexer</span></span></code></span>'s token and <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">parser</span></span></code></span>'s AST is helpful, but so what? Operations on the
AST such as scope checking or type checking also needs reporting on where a programmer went wrong, the responsibility
is
not just within the lexer
and the parser.</p>
<p>In this case, let's see how we
can use
<span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Location</span></span></code></span> to inform our programmers of some scope problem.</p>
<p>In <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">sammine</span></span></code></span>, given a function, the compiler should error out if an unknown variable is referenced or if
a variable is defined twice (the language prevents shadowing variable).</p>
<p>Given the following code:</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#E5C890;font-style:italic">fn</span><span style="color:#8CAAEE;font-style:italic"> f</span><span style="color:#949CBB">(</span><span style="color:#E5C890;font-style:italic">x</span><span style="color:#C6D0F5"> : </span><span style="color:#E5C890;font-style:italic">f64</span><span style="color:#949CBB">)</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#C6D0F5">    let x </span><span style="color:#81C8BE">=</span><span style="color:#EF9F76"> 0</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#C6D0F5">    ...</span></span>
<span class="line"><span style="color:#949CBB">}</span></span></code></pre>
<p>the compiler should error out since we don't allow shadowing of a variable:</p>
<p>To do this, we set up an AST visitor first, where each kind of visitor visits an outlying AST <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">out</span></span></code></span> first, perform
something (walk) on that AST (<a href="https://en.wikipedia.org/wiki/Tree_traversal#Pre-order_implementation" rel="nofollow" target="_blank">preorder</a>), then
visit its children AST, and then comes back and perform another action (walk) on the
AST <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">out</span></span></code></span> (<a href="https://en.wikipedia.org/wiki/Tree_traversal#Post-order_implementation" rel="nofollow" target="_blank">postorder</a>).</p>
<p>For paraphrasing purposes, on how to <a href="https://en.wikipedia.org/wiki/Visitor_pattern#Java_example" rel="nofollow" target="_blank">set up
the AST visitor pattern</a>, we
separate the step between visiting an AST and performing the pre- and post-ordering operation on said AST.</p>
<p>The action of perform the pre- and post-ordering operation on an AST is called walking and is implemented as
<span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">pre_order_walk</span></span></code></span> and <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">post_order_walk</span></span></code></span>.</p>
<p>Without specified otherwise, readers (and programmers) can assume that this is the execution ordering for a visitor:</p>
<pre><code>Visit(AST):
    pre_order_walk(ast)
    ~ recursively visit each element (sub AST) in the AST ~
    post_order_walk(ast)
</code></pre>
<p>Following the assumption that a visit to AST will ultimately and recursively visit each element of the AST as well,
the following sections on scope checking
will only discuss the <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#8CAAEE;font-style:italic">pre_order_walk</span><span style="color:#949CBB">()</span></span></code></span> and the <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#8CAAEE;font-style:italic">post_order_walk</span><span style="color:#949CBB">()</span></span></code></span></p>
<h3 id="class-lexical-scope"><a aria-hidden="true" tabindex="-1" href="#class-lexical-scope"><span class="icon icon-link"></span></a>class Lexical Scope</h3>
<p>The Lexical Scope class stores information about variable declarations and can be used to query whether a certain
variable (represented by a string) existed in a scope or not.</p>
<p>For example, in a function <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">f</span></span></code></span>, if we haven't defined a variable <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">x</span></span></code></span> but we're using it, it is considered
illegal in
<span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">sammine</span></span></code></span> .</p>
<p>To do this, the scope class consists of a mapping <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">symbol_to_loc</span></span></code></span> between symbols to locations as well as a
reference to
the parent
scope (just in case we want to implement some kind of lambda).</p>
<p>The reason to have a mapping between symbols and locations is when we have a clash of symbol, we can error out and
report on the location that is registered for the clashed symbol.</p>
<h3 id="visiting"><a aria-hidden="true" tabindex="-1" href="#visiting"><span class="icon icon-link"></span></a>Visiting</h3>
<p>The scope visitor will, of course, visit different ASTs at play. However, what we're concerned with is how these
orders affect what we want to do, in this case, scope checking. What we want to do next is to declare a few rules
for the scope visitor to register a scope and check for variable shadowing in a scope. Since we have seperated the
pattern into the visit step and the walk step.</p>
<ul>
<li><span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#8CAAEE;font-style:italic">pre_order_walk</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">FunctionAST</span><span style="color:#949CBB">)</span></span></code></span>: We push a newly created scope on the
scope stack.</li>
<li><span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#8CAAEE;font-style:italic">post_order_walk</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">FunctionAST</span><span style="color:#949CBB">)</span></span></code></span>: We pop that stack out of the scope stack</li>
</ul>
<p>Let's talk about VarDefAST's walk first, after which the walk of PrototypeAST will make more sense. A VarDefAST
basically just contains a variable definition:</p>
<ul>
<li><span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#8CAAEE;font-style:italic">pre_order_walk</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">VarDefAST</span><span style="color:#949CBB">)</span></span></code></span>: We check if a variable named <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">var</span></span></code></span> that we want to define has already been
defined or not.
If it has, then we query the location that previously defined <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">var</span></span></code></span> via <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">symbol_to_loc</span><span style="color:#949CBB">[</span><span style="color:#C6D0F5">var</span><span style="color:#949CBB">]</span></span></code></span> and <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#8CAAEE;font-style:italic">add_error</span><span style="color:#949CBB">()</span></span></code></span> both
the previous location and the current <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">VarDefAST</span></span></code></span>'s location.</li>
<li><span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#8CAAEE;font-style:italic">post_order_walk</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">VarDefAST</span><span style="color:#949CBB">)</span></span></code></span>: Do nothing.</li>
</ul>
<p>Since <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">PrototypeAST</span></span></code></span>, the definition of a <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">FunctionAST</span></span></code></span>, contains a vector of variable declaration, we apply the same
procedure that we have for <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">VarDefAST</span></span></code></span> on <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">PrototypeAST</span></span></code></span>.</p>
<ul>
<li><span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#8CAAEE;font-style:italic">pre_order_walk</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">PrototypeAST</span><span style="color:#949CBB">)</span></span></code></span> : Same as <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#8CAAEE;font-style:italic">pre_order_walk</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">VarDefAST</span><span style="color:#949CBB">)</span></span></code></span> for its vector of variable declaration.</li>
<li><span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#8CAAEE;font-style:italic">post_order_walk</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">PrototypeAST</span><span style="color:#949CBB">)</span></span></code></span>: Do nothing.</li>
</ul>
<h3 id="result"><a aria-hidden="true" tabindex="-1" href="#result"><span class="icon icon-link"></span></a>Result</h3>
<p>Yayyy! Now, if we call the scope checking visitor and let it recursively visit down to each function and
consequently to each variable definition, we'll get something like this to the terminal for the following program.</p>
<pre><code># this is a function
fn f(x : f64) {
    # Use `let{:cpp}` keyword
    let x = 0;
    3 + 1;
    x + 2;
    x - 2;
    x = 2;
}

</code></pre>
<p><img src="/blogs/what_after_kalei_location_debug/scopecheck_error.png" alt="scope_check_demo"></p>
<h2 id="whats-next"><a aria-hidden="true" tabindex="-1" href="#whats-next"><span class="icon icon-link"></span></a>What's next?</h2>
<p>That's it from me for now!</p>
<p>Implementing diagnostics for my compiler was really fun. I knew that being able to abstract and reuse code is a
crucial aspect of software engineering, and showcasing this in an actual project is a big deal for me. Different
stages in a compiler needing diagnostics mean that unless I reuse code, repetitive concepts will keep popping up.</p>
<p>There are still features to be desired and to be implemented. One of them is chaining diagnostic locations: figuring
out a clean way to chain together multiple diagnostic would be really helpful for programmers. Another one is
propagating the location info down to LLVM's codegen stage:
this means that we need to somehow conform the <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">Location</span></span></code></span> class to LLVM's debugging location info class.
Interested readers can read about the write up <a href="https://llvm.org/docs/SourceLevelDebugging.html" rel="nofollow" target="_blank">here</a></p>
<p>After this quick demonstration, hopefully I have motivated you to now implement features like detecting the <em>use of
not-yet-defined
variables</em> and <em>use of not-yet-defined functions</em>.</p>
<p>I hope you enjoyed the blog! (And the music recommendations as well—heheh.)</p></div></article></div></div><button class="bottom-4 right-4 fixed"><div class="inline text-2xl font-bold border-black border-2 rounded  p-0 m-0 h-100 w-100">⇡⇡</div></button><footer class="footer self-center justify-center gap-2 pt-4 items-center italic "><p>Built by Jasmine with NextJS, TailwindCSS, and a tonnn of loveee :)</p></footer><script src="/_next/static/chunks/webpack-a3e322df7e912d9b.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[8173,[\"173\",\"static/chunks/173-09f9817a8afa96b6.js\",\"880\",\"static/chunks/app/posts/%5Bid%5D/page-0a046863f2056281.js\"],\"\"]\n3:I[5244,[],\"\"]\n4:I[3866,[],\"\"]\n5:I[1168,[\"173\",\"static/chunks/173-09f9817a8afa96b6.js\",\"970\",\"static/chunks/970-1bb5a11d460674d4.js\",\"177\",\"static/chunks/app/layout-8efea218579f6a1a.js\"],\"default\"]\n7:I[6213,[],\"OutletBoundary\"]\n9:I[6213,[],\"MetadataBoundary\"]\nb:I[6213,[],\"ViewportBoundary\"]\nd:I[4835,[],\"\"]\n:HL[\"/_next/static/media/7385e8d9d3c5518f-s.p.ttf\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/ttf\"}]\n:HL[\"/_next/static/css/d9bc7f7efd1039ef.css\",\"style\"]\n:HL[\"/_next/static/css/7ad14cf05ba66ef7.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"hNKjssvh6TtX7T9mJrhMf\",\"p\":\"\",\"c\":[\"\",\"posts\",\"what_after_kalei_location_debug\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"what_after_kalei_location_debug\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/d9bc7f7efd1039ef.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"px-4 py-4\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_d4e0c8 flex flex-col min-h-screen\",\"children\":[[\"$\",\"$L2\",null,{\"href\":\"/\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex justify-center items-center py-4 \",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-4xl font-bold\",\"children\":\"Jasmine Tang\"}]}]}],[\"$\",\"div\",null,{\"className\":\"flex-1\",\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"$L5\",null,{}],[\"$\",\"footer\",null,{\"className\":\"footer self-center justify-center gap-2 pt-4 items-center italic \",\"children\":[\"$\",\"p\",null,{\"children\":\"Built by Jasmine with NextJS, TailwindCSS, and a tonnn of loveee :)\"}]}]]}]}]]}],{\"children\":[\"posts\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"id\",\"what_after_kalei_location_debug\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$0:f:0:1:2:children:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L6\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/7ad14cf05ba66ef7.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L7\",null,{\"children\":\"$L8\"}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"VQ0BeMNNRoR_ej28wOrIl\",{\"children\":[[\"$\",\"$L9\",null,{\"children\":\"$La\"}],[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$d\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"e:Tf2cc,"])</script><script>self.__next_f.push([1,"\u003cnav class=\"toc\"\u003e\u003col class=\"toc-level toc-level-1\"\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#prologue\"\u003ePrologue\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#introduction\"\u003eIntroduction\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#location-reporter-locator-and-reporter\"\u003eLocation, Reporter, Locator and Reporter\u003c/a\u003e\u003col class=\"toc-level toc-level-2\"\u003e\u003cli class=\"toc-item toc-item-h4\"\u003e\u003ca class=\"toc-link toc-link-h4\" href=\"#the-location-class\"\u003eThe Location class\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h4\"\u003e\u003ca class=\"toc-link toc-link-h4\" href=\"#the-reportee-class\"\u003eThe Reportee class\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h4\"\u003e\u003ca class=\"toc-link toc-link-h4\" href=\"#the-reporter-class\"\u003eThe Reporter class\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h4\"\u003e\u003ca class=\"toc-link toc-link-h4\" href=\"#the-locator-class\"\u003eThe Locator class\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#tokens-and-the-lexer\"\u003eTokens (and the lexer)\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#ast-nodes-and-the-parser\"\u003eAST nodes (and the parser)\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#study-case-scope-checking-visitor\"\u003eStudy case: scope checking visitor\u003c/a\u003e\u003col class=\"toc-level toc-level-2\"\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#class-lexical-scope\"\u003eclass Lexical Scope\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#visiting\"\u003eVisiting\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#result\"\u003eResult\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#whats-next\"\u003eWhat's next?\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/nav\u003e\u003ch2 id=\"prologue\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#prologue\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003ePrologue\u003c/h2\u003e\n\u003cp\u003eHi everyone, wow, it's been a quick minute since I posted a new article. How's everyone doing :) I'm still trucking\naway at life applying to compiler jobs as well as schooling at Berk. Hope everybody's doing great :)\u003c/p\u003e\n\u003cp\u003eThis\narticle is for\npeople\nwho might be\nasking:\u003c/p\u003e\n\u003cp\u003e\"Ok, I've done the \u003ca href=\"https://llvm.org/docs/tutorial/MyFirstLanguageFrontend/index.html\" rel=\"nofollow\" target=\"_blank\"\u003ellvm tutorial\u003c/a\u003e already.\nWhat's next?\"\u003c/p\u003e\n\u003cp\u003eMore specifically, the article is about adding primitive support for error reporting to the\ntoy compiler. The article assumes some familiarity with lexer, parsing and the visitor pattern. Some familiarity with\nthe parser and its abstract syntax tree (\u003ca href=\"https://dev.to/balapriya/abstract-syntax-tree-ast-explained-in-plain-english-1h38\" rel=\"nofollow\" target=\"_blank\"\u003eAST\u003c/a\u003e) construction from the \u003ca href=\"https://llvm.org/docs/tutorial/MyFirstLanguageFrontend/index.html\" rel=\"nofollow\" target=\"_blank\"\u003ellvm tutorial\u003c/a\u003e\nis helpful\nbut not necessary.\u003c/p\u003e\n\u003cp\u003eBesides that, the article is also to share my software design decisions regarding my compiler's diagnostics and to\nimprove my technical writing ability.\u003c/p\u003e\n\u003cp\u003eAs is tradition :) I also wanna share some songs with you. The two songs are \u003ca href=\"https://www.youtube.com/watch?v=r-zubTTp8Tg\u0026#x26;ab_channel=COIN\" rel=\"nofollow\" target=\"_blank\"\u003eValentine\u003c/a\u003e and \u003ca href=\"https://www.youtube.com/watch?v=XvG12DVUCNg\u0026#x26;ab_channel=COIN\" rel=\"nofollow\" target=\"_blank\"\u003eInto my arms\u003c/a\u003e,\nboth by COIN, one of my fav bands :) To me, Valentine is this flirty and fun—like a rush of butterflies, you know?\nIt’s got that energetic, dreamy beat that feels like falling in love for the first time. But Into My Arms' this\npure intimacy, deep, and emotional calling. It's as if the singer knows what they really wants and they're just\npulling at the heartstrings and begging\nyou to just melt\ninto\nsomeone’s\nembrace.\u003c/p\u003e\n\u003cp\u003eSigh, at this point you might be thinking I must be writing blogs just to share and review music, huh? :) Smh\u003c/p\u003e\n\u003cp\u003eI hope you enjoy :) (both the songs and the blog hahah)\u003c/p\u003e\n\u003ch2 id=\"introduction\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#introduction\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eCompiler diagnostics is an important aspect in one's compiler. From erroring out on the programmer's mistake to\nproviding warnings or giving diagnostics, the ability to accurately locate the location of the pesky problems to said\nprogrammer is proven to be extremely valuable: only providing to the programmer the row and column number of where an error occurs is less helpful and more confusing than a compiler pointing, tracing and explaining an error to a programmer.\u003c/p\u003e\n\u003cp\u003eThe article then discusses a way to improve upon the llvm Kaleidoscope toy compiler in the diagnostic aspect for the\nuser. The picture below shows the difference between a primitive and a somewhat sophisticated\nerror\ndiagnostics scheme and is implemented as\npart of\nthe sammine\ncompiler.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/blogs/what_after_kalei_location_debug/comparison.png\" alt=\"comparison between\"\u003e\u003c/p\u003e\n\u003ch2 id=\"location-reporter-locator-and-reporter\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#location-reporter-locator-and-reporter\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eLocation, Reporter, Locator and Reporter\u003c/h2\u003e\n\u003cp\u003eLet's start with a simple description of the problem and a simple answer to the said problem.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eGiven a string (which is the input of the compiler), and a starting point index and an ending point index of said\nstring, indicate the component (either a token or a subpart of some AST) that is faulty.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eBelow shows a string of a \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003evariable definition \u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e and its corresponding starting and ending point in\nthe input\nstring:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003estart of decl\n|       end of decl\n|       |\n↓       ↓\n01234556789\nlet x = 1;\\eof\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHere, the starting point for the let expr has index 0 in\nthe string, and the ending point for the let expr has index 7 in the string (the semicolon at 8 is not counted).\u003c/p\u003e\n\u003cp\u003eFrom first principles, how can a compiler consolidate the location of these tokens: \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003elet\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e, \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003ex\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e, \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e, \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#EF9F76\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e\ntogether and understand that the declaration spans from 0 to 7?\u003c/p\u003e\n\u003cp\u003eLet us define the class \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eLocation\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e, \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eReportee\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e\nand \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eReporter\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e currently implemented as part of the compiler and see how all of these building blocks fit in together.\u003c/p\u003e\n\u003ch4 id=\"the-location-class\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#the-location-class\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eThe Location class\u003c/h4\u003e\n\u003cp\u003eThe \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eLocation\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e class is basically two indices, indicating the location of a construct in the\ninput string. The first index\n\u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_start\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e\nsignifies the\nstarting location of a component and vice versa for \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_end\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e. If a construct in the compiler (a token or an AST)\nonly occupies a single space, then \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_start\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e == \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_end\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e.\u003c/p\u003e\n\u003cp\u003eWhen two \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eLocation\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003es come together to form one singular \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eLocation\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e, we take the minimum of all\n\u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_start\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e and the maximum of all the \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_end\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e. This is implemented as the pipe operator \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#81C8BE\"\u003e|\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e for the class:\u003c/p\u003e\n\u003cpre class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e// Combine two locations\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003eLocation\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003e operator\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e Location\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#EA999C;font-style:italic\"\u003eother\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003e const\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    Location result\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    result\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_start \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003e std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003emin\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_start\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e other\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_start\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    result\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_end \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003e std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003emax\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_end\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e other\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_end\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e result\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003evoid\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003e operator\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e|=\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e Location\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#EA999C;font-style:italic\"\u003eother\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    source_start \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003e std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003emin\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_start\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e other\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_start\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    source_end \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003e std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003emax\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_end\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e other\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_end\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eLet's look at an example, given the string of a binary expression \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003ex\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003ey\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e, since \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003ex\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e takes the \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003eLocation\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#EF9F76\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#EF9F76\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e, \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003ey\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e\ntakes the \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003eLocation\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#EF9F76\"\u003e2\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#EF9F76\"\u003e2\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e. The location for the resulting binary expression is \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003eLocation\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003emin\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#EF9F76\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#EF9F76\"\u003e2\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e),\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003e max\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#EF9F76\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#EF9F76\"\u003e2\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e))\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003e Location\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#EF9F76\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#EF9F76\"\u003e 2\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e.\u003c/p\u003e\n\u003cp\u003eAnother thing to notice is that the Location class offers modifiers on \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_end\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e, this is mostly useful in the\ncase of lexing different token such as \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#81C8BE\"\u003e+\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e and \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#81C8BE\"\u003e+=\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e - often in sammine I have to backtrack and thus this is really\nhelpful.\u003c/p\u003e\n\u003ch4 id=\"the-reportee-class\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#the-reportee-class\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eThe Reportee class\u003c/h4\u003e\n\u003cp\u003eGiven a location, we need a message to be associated with it, together with the diagnostic kind: Is this message an\nerror? Is it a warning? Is this just to provide the programmer/compiler writer with some extra information for an\ninformed decision?\u003c/p\u003e\n\u003cp\u003eThe class that takes care of this is the \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eReportee\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e class. It defines different \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eReportKind\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e such as \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eerror\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e,\n\u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003ewarn\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e or \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003ediag\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e for error, warning or diagnostics respectively. It also provides abstraction such as \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003eadd_error\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e,\n\u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003eadd_warn\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e or \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eadd_diag\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e for said \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eReportKind\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003es. The input to these \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eadd_\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e call is a \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eReport\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e type, which is\njust a tuple of \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eReportKind\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e Location\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003e std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003estring\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e.\u003c/p\u003e\n\u003cp\u003eWho's calling \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003eadd_error\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e and \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003eadd_warn\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e? Whichever phase the compiler needs to communicate with the\nprogrammer\nabout, that phase will inherit from this \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eReportee\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e class and use these utilities functions. The sections on Lexer and\nParser will go over these finer details.\u003c/p\u003e\n\u003cp\u003eBesides this, the \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eReportee\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e class also carries \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003esize_t\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e of \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eerror_count\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e, \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003ewarn_count\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e and\n\u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003ediag_count\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e to be used as statistics for the \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eReporter\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e class, which is the topic of our next subsection.\u003c/p\u003e\n\u003ch4 id=\"the-reporter-class\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#the-reporter-class\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eThe Reporter class\u003c/h4\u003e\n\u003cp\u003eThe compiler\nneeds to 'report' messages coming from different stages (Reportee) such as lexing, parsing or type checking, of\nwhich the \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eReporter\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e class is in charge.\u003c/p\u003e\n\u003cp\u003eUpon construction, it takes in a file name, the source code string, and the context radius. For example, if the context\nradius is 2, then if we're reporting on 1 line of code at line 3, we would print out from line 1 to line 5 (via the\nLocator class).\u003c/p\u003e\n\u003cp\u003eThen it splits this source code string into different strings seperated by newlines, and constructs a \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E5C890\"\u003estd\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003evector\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e\nof pairs of the running sum lengths of all the strings up to the current string and the current\nstring. This is implemented as \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E5C890\"\u003eReporter\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eget_diagnostic_data\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e and the result is stored as an intermediary\ningredient for the \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eLocator\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e class:\u003c/p\u003e\n\u003cpre class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003eusing\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e DiagnosticData\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003e std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003evector\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003estd\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003epair\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003estd\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003esize_t\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003e std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003estring_view\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e\u003e\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003eDiagnosticData\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003e Reporter\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003eget_diagnostic_data\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003estd\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003estring_view\u003c/span\u003e\u003cspan style=\"color:#EA999C;font-style:italic\"\u003e str\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e  DiagnosticData result\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e  size_t\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e start \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#EF9F76\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e  while\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003estart \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e str\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003esize\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e())\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e    size_t\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e end \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e str\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003efind\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#A6D189\"\u003e'\u003c/span\u003e\u003cspan style=\"color:#F4B8E4\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#A6D189\"\u003e'\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e start\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eend \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e==\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003e std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003estring_view\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003enpos\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e      // Add the last substring if no more newlines are found\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e      result\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003epush_back\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e{start\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e str\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003esubstr\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003estart\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e      break\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e    // Add the substring excluding the newline character\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    result\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003epush_back\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e{start\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e str\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003esubstr\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003estart\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e end \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e start\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    start \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e end \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#EF9F76\"\u003e 1\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e  return\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e result\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThen, the \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eReporter\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e class takes in a \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eReport\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e, a tuple of \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eReportKind\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e Location\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003e std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003estring\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e and\nprint the message via stderr to the programmer; it also knows that for a specific\n\u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eReportKind\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e, which color should be printed.\u003c/p\u003e\n\u003ch4 id=\"the-locator-class\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#the-locator-class\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eThe Locator class\u003c/h4\u003e\n\u003cp\u003eYou must be wondering, just the linear \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_start\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e source_end\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e indices is not enough, this result is just\nthe\nbare\nminimum.\nSomehow the compiler needs to be able to map a location of \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_start\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e source_end\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e to the starting and ending rows and columns for easier visualization.\nWhat if we also want some lines of code before and\nafter the concerning line of code for more context, how would we do that?\nMaybe if the \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eLocation\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e needed to be\nreported is one,\nor two,\nor\nthree lines only, and it'd be very helpful to hone in and point out the mistake for the programmer.\u003c/p\u003e\n\u003cp\u003eTo do this, the \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eLocator\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e, with the \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_start\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e and \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_end\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e, consecutively performs binary search on the\n\u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eDiagnosticData\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e\ngiven by the \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eReporter\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e,\nand\nreturns the row and column needed for reporting.\u003c/p\u003e\n\u003cp\u003eThis is why we're making \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eDiagnosticData\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e to be a vector of\npairs where the first element is monotonically increasing: we can binary search on the first element of the pair to\nget out the index of the vector (which tells us what row it is), as well as the second element of said index (which\nallows us to print out the involving row). The reduction from \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eO\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eO(n)\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\"\u003eO\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003en\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e to \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eO\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003el\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eO(ln(n))\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\"\u003eO\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.01968em;\"\u003el\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003en\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003en\u003c/span\u003e\u003cspan class=\"mclose\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e is a much-needed break once the\ncompiler input exceeds 10,000 rows or more with multiple files.\u003c/p\u003e\n\u003cp\u003eIt then subtracts and adds, respectively on these rows obtained from\n\u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_start\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e and \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_end\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e, the provided \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003econtext_radius\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e to get the final rows and columns\nresult,\nusable by the \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eReporter\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e class.\u003c/p\u003e\n\u003ch2 id=\"tokens-and-the-lexer\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#tokens-and-the-lexer\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eTokens (and the lexer)\u003c/h2\u003e\n\u003cp\u003eWewwww....\nLet's talk about the tokens and the lexer. When given the source code as a string (maybe via a file), the lexer\nscans from left to right on that string, each time incrementing the index on the string and returning a token.\nThus, this is the basis of our class Location.\u003c/p\u003e\n\u003cp\u003eIn sammine, tokens are (loosely) modeled as:\u003c/p\u003e\n\u003cpre class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e Token\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003epublic\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    TokenType type\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E5C890\"\u003e    std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003estring lexeme\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    Location location\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003e    Token\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003eTokenType\u003c/span\u003e\u003cspan style=\"color:#EA999C;font-style:italic\"\u003e type\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003e std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#EA999C;font-style:italic\"\u003e lexeme\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e Location\u003c/span\u003e\u003cspan style=\"color:#EA999C;font-style:italic\"\u003e location\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e      :\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003e type\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e),\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003e lexeme\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003estd\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003emove\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003elexeme\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)),\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003e location\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003elocation\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e};\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eand for the lexer:\u003c/p\u003e\n\u003cpre class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e Lexer\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e :\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003e public\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003e sammine_util\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003eReportee\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003eprivate\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E5C890\"\u003e    sammine_util\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eLocation location\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E5C890\"\u003e    std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003evector\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eToken\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e tokStream\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    ...\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOne thing to note is after we've recognized a token together with its \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eLocation\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e, we update the Location of the\nLexer via \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003eupdate_location\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e.\u003c/p\u003e\n\u003cpre class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003evoid\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003e Lexer\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003eupdateLocation\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    location \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003e sammine_util\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003eLocation\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003elocation\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_end\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e location\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_end\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe reasoning for this is that if we don't do this, then in the following example, the\ntoken \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#81C8BE\"\u003e+=\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e as well as the token \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eb\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e will have inaccurate locations, spanning from the start of the input to the\ncurrent index.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eLocation a: (0, 0)\n| Location +=: (0, 3)\n| |  Location b: (0, 5)\n↓ ↓  ↓\n012345\na += b\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"ast-nodes-and-the-parser\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#ast-nodes-and-the-parser\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eAST nodes (and the parser)\u003c/h2\u003e\n\u003cp\u003eAfter we've produced our tokens, the parser takes in the stream of tokens and produces our ASTs. An AST is created\nafter identification for a specific ordering of some tokens.\u003c/p\u003e\n\u003cp\u003eFor this newly created AST, the simple thing to do is to combine all the AST's token's location into one. Below shows\npseudocode for that\u003c/p\u003e\n\u003cpre class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003eAST_construct\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eToken tok1\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e Token tok2\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e ...\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    AST\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eLocation \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e first token location of AST\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    For all tokens T that made up the AST\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e        AST\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eLocation \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e|=\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e T\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003elocation\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn AST construction, we follow quite literally what the parser is parsing, for the following example: there is an\nAST of function with an AST\nof expr being nested in it (as a list of expressions).\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003efn f(x : f64) {\n    let y = 0;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe code block then translates to this pseudocode c++ structure:\u003c/p\u003e\n\u003cpre class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e AST_Func\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e // this stands for fn f\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    AST_Prototype prototype \u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E5C890\"\u003e        std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003estring func_name\u003c/span\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e // stands for the name `f`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E5C890\"\u003e        std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003evector\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eAST_TypedVar\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e function_arguments\u003c/span\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e // this stands for `x : 64`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    AST_Block function_block \u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E5C890\"\u003e        std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003evector\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003eAST\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eExpr\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e statements\u003c/span\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e // this stands for a singular `let y = 0;`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"study-case-scope-checking-visitor\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#study-case-scope-checking-visitor\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eStudy case: scope checking visitor\u003c/h2\u003e\n\u003cp\u003eKnowing how a \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eLocation\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e plays out in a \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003elexer\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e's token and \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eparser\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e's AST is helpful, but so what? Operations on the\nAST such as scope checking or type checking also needs reporting on where a programmer went wrong, the responsibility\nis\nnot just within the lexer\nand the parser.\u003c/p\u003e\n\u003cp\u003eIn this case, let's see how we\ncan use\n\u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eLocation\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e to inform our programmers of some scope problem.\u003c/p\u003e\n\u003cp\u003eIn \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003esammine\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e, given a function, the compiler should error out if an unknown variable is referenced or if\na variable is defined twice (the language prevents shadowing variable).\u003c/p\u003e\n\u003cp\u003eGiven the following code:\u003c/p\u003e\n\u003cpre class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003efn\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003e f\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003ex\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e : \u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003ef64\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    let x \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#EF9F76\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ethe compiler should error out since we don't allow shadowing of a variable:\u003c/p\u003e\n\u003cp\u003eTo do this, we set up an AST visitor first, where each kind of visitor visits an outlying AST \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eout\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e first, perform\nsomething (walk) on that AST (\u003ca href=\"https://en.wikipedia.org/wiki/Tree_traversal#Pre-order_implementation\" rel=\"nofollow\" target=\"_blank\"\u003epreorder\u003c/a\u003e), then\nvisit its children AST, and then comes back and perform another action (walk) on the\nAST \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eout\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e (\u003ca href=\"https://en.wikipedia.org/wiki/Tree_traversal#Post-order_implementation\" rel=\"nofollow\" target=\"_blank\"\u003epostorder\u003c/a\u003e).\u003c/p\u003e\n\u003cp\u003eFor paraphrasing purposes, on how to \u003ca href=\"https://en.wikipedia.org/wiki/Visitor_pattern#Java_example\" rel=\"nofollow\" target=\"_blank\"\u003eset up\nthe AST visitor pattern\u003c/a\u003e, we\nseparate the step between visiting an AST and performing the pre- and post-ordering operation on said AST.\u003c/p\u003e\n\u003cp\u003eThe action of perform the pre- and post-ordering operation on an AST is called walking and is implemented as\n\u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003epre_order_walk\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e and \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003epost_order_walk\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e.\u003c/p\u003e\n\u003cp\u003eWithout specified otherwise, readers (and programmers) can assume that this is the execution ordering for a visitor:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eVisit(AST):\n    pre_order_walk(ast)\n    ~ recursively visit each element (sub AST) in the AST ~\n    post_order_walk(ast)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFollowing the assumption that a visit to AST will ultimately and recursively visit each element of the AST as well,\nthe following sections on scope checking\nwill only discuss the \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003epre_order_walk\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e and the \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003epost_order_walk\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e\u003c/p\u003e\n\u003ch3 id=\"class-lexical-scope\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#class-lexical-scope\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eclass Lexical Scope\u003c/h3\u003e\n\u003cp\u003eThe Lexical Scope class stores information about variable declarations and can be used to query whether a certain\nvariable (represented by a string) existed in a scope or not.\u003c/p\u003e\n\u003cp\u003eFor example, in a function \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003ef\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e, if we haven't defined a variable \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003ex\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e but we're using it, it is considered\nillegal in\n\u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003esammine\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e .\u003c/p\u003e\n\u003cp\u003eTo do this, the scope class consists of a mapping \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003esymbol_to_loc\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e between symbols to locations as well as a\nreference to\nthe parent\nscope (just in case we want to implement some kind of lambda).\u003c/p\u003e\n\u003cp\u003eThe reason to have a mapping between symbols and locations is when we have a clash of symbol, we can error out and\nreport on the location that is registered for the clashed symbol.\u003c/p\u003e\n\u003ch3 id=\"visiting\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#visiting\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eVisiting\u003c/h3\u003e\n\u003cp\u003eThe scope visitor will, of course, visit different ASTs at play. However, what we're concerned with is how these\norders affect what we want to do, in this case, scope checking. What we want to do next is to declare a few rules\nfor the scope visitor to register a scope and check for variable shadowing in a scope. Since we have seperated the\npattern into the visit step and the walk step.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003epre_order_walk\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eFunctionAST\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e: We push a newly created scope on the\nscope stack.\u003c/li\u003e\n\u003cli\u003e\u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003epost_order_walk\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eFunctionAST\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e: We pop that stack out of the scope stack\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eLet's talk about VarDefAST's walk first, after which the walk of PrototypeAST will make more sense. A VarDefAST\nbasically just contains a variable definition:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003epre_order_walk\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eVarDefAST\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e: We check if a variable named \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003evar\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e that we want to define has already been\ndefined or not.\nIf it has, then we query the location that previously defined \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003evar\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e via \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003esymbol_to_loc\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003evar\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e]\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e and \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003eadd_error\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e both\nthe previous location and the current \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eVarDefAST\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e's location.\u003c/li\u003e\n\u003cli\u003e\u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003epost_order_walk\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eVarDefAST\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e: Do nothing.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eSince \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003ePrototypeAST\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e, the definition of a \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eFunctionAST\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e, contains a vector of variable declaration, we apply the same\nprocedure that we have for \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eVarDefAST\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e on \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003ePrototypeAST\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003epre_order_walk\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003ePrototypeAST\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e : Same as \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003epre_order_walk\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eVarDefAST\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e for its vector of variable declaration.\u003c/li\u003e\n\u003cli\u003e\u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003epost_order_walk\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003ePrototypeAST\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e: Do nothing.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"result\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#result\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eResult\u003c/h3\u003e\n\u003cp\u003eYayyy! Now, if we call the scope checking visitor and let it recursively visit down to each function and\nconsequently to each variable definition, we'll get something like this to the terminal for the following program.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# this is a function\nfn f(x : f64) {\n    # Use `let{:cpp}` keyword\n    let x = 0;\n    3 + 1;\n    x + 2;\n    x - 2;\n    x = 2;\n}\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/blogs/what_after_kalei_location_debug/scopecheck_error.png\" alt=\"scope_check_demo\"\u003e\u003c/p\u003e\n\u003ch2 id=\"whats-next\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#whats-next\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eWhat's next?\u003c/h2\u003e\n\u003cp\u003eThat's it from me for now!\u003c/p\u003e\n\u003cp\u003eImplementing diagnostics for my compiler was really fun. I knew that being able to abstract and reuse code is a\ncrucial aspect of software engineering, and showcasing this in an actual project is a big deal for me. Different\nstages in a compiler needing diagnostics mean that unless I reuse code, repetitive concepts will keep popping up.\u003c/p\u003e\n\u003cp\u003eThere are still features to be desired and to be implemented. One of them is chaining diagnostic locations: figuring\nout a clean way to chain together multiple diagnostic would be really helpful for programmers. Another one is\npropagating the location info down to LLVM's codegen stage:\nthis means that we need to somehow conform the \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eLocation\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e class to LLVM's debugging location info class.\nInterested readers can read about the write up \u003ca href=\"https://llvm.org/docs/SourceLevelDebugging.html\" rel=\"nofollow\" target=\"_blank\"\u003ehere\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eAfter this quick demonstration, hopefully I have motivated you to now implement features like detecting the \u003cem\u003euse of\nnot-yet-defined\nvariables\u003c/em\u003e and \u003cem\u003euse of not-yet-defined functions\u003c/em\u003e.\u003c/p\u003e\n\u003cp\u003eI hope you enjoyed the blog! (And the music recommendations as well—heheh.)\u003c/p\u003e"])</script><script>self.__next_f.push([1,"6:[\"$\",\"div\",null,{\"className\":\"py-12 flex flex-col items-center  justify-items-start mx-auto \",\"children\":[[\"$\",\"$L2\",null,{\"href\":\"/blog\",\"className\":\"flex justify-center text-4xl\",\"children\":[\"$\",\"h2\",null,{\"children\":\"My blog\"}]}],[\"$\",\"article\",null,{\"className\":\"p-8 prose pt-0.5 max-w-none w-full lg:w-1/2 md:w-4/6 sm:w-5/6 prose-sky mx-auto\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex justify-center text-2xl font-bold \",\"children\":[\"$\",\"h2\",null,{\"children\":\"What after Kaleidoscope: Error location\"}]}],[\"$\",\"div\",null,{\"className\":\"flex justify-start text-xl font-bold underline\",\"children\":[\"$\",\"h4\",null,{\"children\":\"2025-02-27\"}]}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$e\"}}]]}]]}]\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"What after Kaleidoscope: Error location\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Jasmine discusses a simple error/warn/log method after Kaleidoscope.\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/_next/static/media/pfp5.0daa0f7d.jpeg\"}]]\n8:null\n"])</script></body></html>