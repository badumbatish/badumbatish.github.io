<!DOCTYPE html><html lang="en" class="px-4 py-4"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/7385e8d9d3c5518f-s.p.ttf" as="font" crossorigin="" type="font/ttf"/><link rel="stylesheet" href="/_next/static/css/c964a4de8175fdfc.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/7ad14cf05ba66ef7.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-a3e322df7e912d9b.js"/><script src="/_next/static/chunks/4bd1b696-cc921fdf64582ac2.js" async=""></script><script src="/_next/static/chunks/517-f9c47ac1c3159d98.js" async=""></script><script src="/_next/static/chunks/main-app-64657d68b3fa7103.js" async=""></script><script src="/_next/static/chunks/173-ad05a37061268ac6.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bid%5D/page-0a046863f2056281.js" async=""></script><script src="/_next/static/chunks/565-d3001cb0b7ac580c.js" async=""></script><script src="/_next/static/chunks/app/layout-23d97ae8d15fbd69.js" async=""></script><meta name="next-size-adjust" content=""/><title>[ONGOING] What after Kaleidoscope: Error location</title><meta name="description" content="Built with NextJS, TailwindCSS, and a tonnn of loveee :)"/><link rel="icon" href="/_next/static/media/pfp5.0daa0f7d.jpeg"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__className_d4e0c8 flex flex-col min-h-screen"><a href="/"><div class="flex justify-center items-center py-4 "><h1 class="text-4xl font-bold">Jasmine Tang</h1></div></a><div class="flex-1"><div class="py-12 flex flex-col items-center  justify-items-start mx-auto "><a class="flex justify-center text-4xl" href="/blog"><h2>My blog</h2></a><article class="p-8 prose pt-0.5 max-w-none w-full lg:w-1/2 md:w-4/6 sm:w-5/6 prose-sky mx-auto"><div class="flex justify-center text-2xl font-bold "><h2>[ONGOING] What after Kaleidoscope: Error location</h2></div><div class="flex justify-start text-xl font-bold underline"><h4>8888-08-08</h4></div><div class="flex font-bold">Edit:</div>My resume is <a href="https://www.overleaf.com/project/638120c30d0003f7bfe10360">here</a> (and downloadable <a href="https://badumbatish.github.io/about_me/Jasmine_Resume_Badumbatish.pdf">here</a>). If you know of a compiler related job posting, please feel free to contact me or refer me at either <a href="tanghocle456@gmail.com">tanghocle456@gmail.com</a> or <a href="jjasmine@berkeley.edu">jjasmine@berkeley.edu</a>.<hr/><div><nav class="toc"><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#prologue">Prologue</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#introduction">Introduction</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#location-reporter-locator-and-reporter">Location, Reporter, Locator and Reporter</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h4"><a class="toc-link toc-link-h4" href="#the-location-class">The Location class</a></li><li class="toc-item toc-item-h4"><a class="toc-link toc-link-h4" href="#the-reportee-class">The Reportee class</a></li><li class="toc-item toc-item-h4"><a class="toc-link toc-link-h4" href="#the-reporter-class">The Reporter class</a></li><li class="toc-item toc-item-h4"><a class="toc-link toc-link-h4" href="#the-locator-class">The Locator class</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#inferring-to-rows-and-columns">Inferring to rows and columns</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#tokens-and-the-lexer">Tokens (and the lexer)</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#ast-nodes-and-the-parser">AST nodes (and the parser)</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#study-case-scope-checking-visitor">Study case: scope checking visitor</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#ending-words">Ending words</a></li></ol></nav><h2 id="prologue"><a aria-hidden="true" tabindex="-1" href="#prologue"><span class="icon icon-link"></span></a>Prologue</h2>
<p>Hi everyone, wow, it's been a quick minute since I posted a new article. How's everyone doing :) I'm still trucking
away at life applying to compiler jobs as well as schooling at Berk. Hope everybody's doing great :)</p>
<p>The
article is for
people
who might be
asking:</p>
<p>"Ok, I've done the <a href="https://llvm.org/docs/tutorial/MyFirstLanguageFrontend/index.html" rel="nofollow" target="_blank">llvm tutorial</a> already.
What's next?"</p>
<p>More specifically, the article is about adding primitive support for error reporting to the
toy compiler.</p>
<p>Besides that, the article is also to share my software design decisions regarding my compiler's diagnostics.</p>
<p>As is tradition :) I also wanna share some songs with you. The two songs are <a href="">Valentine</a> and <a href="">Into my arms</a>,
both by COIN, one of my fav band. todo explain more about this.</p>
<p>I hope you enjoy :) (both the songs and the blog hahah)</p>
<h2 id="introduction"><a aria-hidden="true" tabindex="-1" href="#introduction"><span class="icon icon-link"></span></a>Introduction</h2>
<p>Compiler diagnostics is an important aspect in one's compiler. From erroring out on the programmer's mistake to
providing warnings or giving diagnostics, the ability to accurately locate the location of the pesky problems to said
programmer is proven to be extremely valuable: only providing to the programmer the row and column number of where an error occurs is less helpful and more confusing than a compiler pointing, tracing and explaining an error to a programmer.</p>
<p>The article then discusses a way to improve upon the llvm Kaleidoscope toy compiler in the diagnostic aspect for the
user. The result below shows the difference between a primitive and a somewhat sophisticated
error
diagnostics scheme and is are
implemented as
part of
the sammine
compiler.</p>
<p><img src="/blogs/what_after_kalei_location_debug/comparison.png" alt="comparison between"></p>
<h2 id="location-reporter-locator-and-reporter"><a aria-hidden="true" tabindex="-1" href="#location-reporter-locator-and-reporter"><span class="icon icon-link"></span></a>Location, Reporter, Locator and Reporter</h2>
<p>Let's start with a simple description of the problem and a simple answer to the said problem.</p>
<blockquote>
<p>Given a string (which is the input of the compiler), and a starting point index and an ending point index of said
string, indicating the component (either a token or a subpart of some AST) that is faulty.</p>
</blockquote>
<p>Below shows a string of a <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">let expression</span></span></code></span> and its corresponding starting and ending point in the input string.</p>
<pre><code>start of let expr
|       end of let expr
|       |
↓       ↓
01234556789
let x = 1;\eof
</code></pre>
<p>Here, the starting point for the let expr has index 0 in
the string, and the ending point for the let expr has index 7 in the string (the semicolon at 8 is not counted).</p>
<p>From first principles, how can a compiler consolidate the location of these tokens: <code>let</code>, <code>x</code>, <code>=</code>, <code>1</code>
together and understand that the <code>let expression</code> spans from 0 to 7?</p>
<p>Let us define the class <code>Location</code>, <code>Reportee</code>
and <code>Reporter</code> currently implemented as part of the compiler and see how all of these building blocks fit in together.</p>
<h4 id="the-location-class"><a aria-hidden="true" tabindex="-1" href="#the-location-class"><span class="icon icon-link"></span></a>The Location class</h4>
<p>The <code>Location</code> class is basically two indices, indicating the location of a construct in the
input string. The first index
<code>source_start</code>
signifies the
starting location of a component and vice versa for <code>source_end</code>. If a construct in the compiler (a token or an AST)
only occupies a single space, then <code>source_start == source_end</code>.</p>
<p>When two <code>Location</code>s come together to form one singular <code>Location</code>, we take the minimum of all
<code>source_start</code> and the maximum of all the <code>source_end</code>. This is implemented as the pipe operator <code>|</code> for the class:</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#737994;font-style:italic">// Combine two locations</span></span>
<span class="line"><span style="color:#E5C890;font-style:italic">Location</span><span style="color:#CA9EE6"> operator</span><span style="color:#C6D0F5">|</span><span style="color:#949CBB">(</span><span style="color:#CA9EE6">const</span><span style="color:#E5C890;font-style:italic"> Location</span><span style="color:#81C8BE"> &#x26;</span><span style="color:#EA999C;font-style:italic">other</span><span style="color:#949CBB">)</span><span style="color:#CA9EE6"> const</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#C6D0F5">    Location result</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#C6D0F5">    result</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">source_start </span><span style="color:#81C8BE">=</span><span style="color:#E5C890"> std</span><span style="color:#949CBB">::</span><span style="color:#8CAAEE;font-style:italic">min</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">source_start</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> other</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">source_start</span><span style="color:#949CBB">);</span></span>
<span class="line"><span style="color:#C6D0F5">    result</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">source_end </span><span style="color:#81C8BE">=</span><span style="color:#E5C890"> std</span><span style="color:#949CBB">::</span><span style="color:#8CAAEE;font-style:italic">max</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">source_end</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> other</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">source_end</span><span style="color:#949CBB">);</span></span>
<span class="line"><span style="color:#CA9EE6">    return</span><span style="color:#C6D0F5"> result</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#949CBB">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CA9EE6">void</span><span style="color:#CA9EE6"> operator</span><span style="color:#C6D0F5">|=</span><span style="color:#949CBB">(</span><span style="color:#CA9EE6">const</span><span style="color:#E5C890;font-style:italic"> Location</span><span style="color:#81C8BE"> &#x26;</span><span style="color:#EA999C;font-style:italic">other</span><span style="color:#949CBB">)</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#C6D0F5">    source_start </span><span style="color:#81C8BE">=</span><span style="color:#E5C890"> std</span><span style="color:#949CBB">::</span><span style="color:#8CAAEE;font-style:italic">min</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">source_start</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> other</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">source_start</span><span style="color:#949CBB">);</span></span>
<span class="line"><span style="color:#C6D0F5">    source_end </span><span style="color:#81C8BE">=</span><span style="color:#E5C890"> std</span><span style="color:#949CBB">::</span><span style="color:#8CAAEE;font-style:italic">max</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">source_end</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> other</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">source_end</span><span style="color:#949CBB">);</span></span>
<span class="line"><span style="color:#949CBB">}</span></span></code></pre>
<p>Let's look at an example, given the string of a binary expression <code>x+y</code>, since <code>x</code> takes the <code>Location(0,0)</code>, <code>y</code>
takes the <code>Location(2,2)</code>. The location for the resulting binary expression is <code>Location(min(0,2), max(0,2)) = Location(0, 2)</code>.</p>
<h4 id="the-reportee-class"><a aria-hidden="true" tabindex="-1" href="#the-reportee-class"><span class="icon icon-link"></span></a>The Reportee class</h4>
<p>Given a location, we need a message to be associated with it, together with the diagnostic kind: Is this message an
error? Is it a warning? Is this just to provide the programmer/compiler writer with some extra information for an
informed decision?</p>
<p>The class that takes care of this is the <code>Reportee</code> class. It defines different <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">ReportKind</span></span></code></span> such as <code>error</code>,
<code>warn</code> or <code>diag</code> for error, warning or diagnostics respectively. It also provides abstraction such as <code>add_error()</code>,
<code>add_warn()</code> or <code>add_diag</code> for said <code>ReportKind</code>s.</p>
<p>Who's calling <code>add_error()</code> and <code>add_warn()</code>? Whichever phase the compiler needs to communicate with the programmer
about, that phase will inherit from this <code>Reportee</code> class and use these utilities functions. The sections on Lexer and
Parser will go over these finer details.</p>
<p>Besides this, the <code>Reportee</code> class also carries <code>size_t</code> of <code>error_count</code>, <code>warn_count</code> and
<code>diag_count</code> to be used as statistics for the <code>Reporter</code> class, which is the topic of our next subsection.</p>
<h4 id="the-reporter-class"><a aria-hidden="true" tabindex="-1" href="#the-reporter-class"><span class="icon icon-link"></span></a>The Reporter class</h4>
<p>You must be wondering, just the <code>source_start, source_end</code> is not enough, this result is just the bare minimum.
Somehow the compiler needs to be able to map a location of <code> (source_start, source_end)</code> to the starting and ending rows and columns for easier visualization. The compiler also
needs to 'report' messages coming from different stages such as lexing, parsing or type checking. Keeping these
details in mind, let's look at the <code>Reporter</code> class, who's in charge of these functionalities.</p>
<p>The <code>Reporter</code> class is in charge of inputting</p>
<h4 id="the-locator-class"><a aria-hidden="true" tabindex="-1" href="#the-locator-class"><span class="icon icon-link"></span></a>The Locator class</h4>
<h3 id="inferring-to-rows-and-columns"><a aria-hidden="true" tabindex="-1" href="#inferring-to-rows-and-columns"><span class="icon icon-link"></span></a>Inferring to rows and columns</h3>
<h2 id="tokens-and-the-lexer"><a aria-hidden="true" tabindex="-1" href="#tokens-and-the-lexer"><span class="icon icon-link"></span></a>Tokens (and the lexer)</h2>
<p>Let's start with the tokens and the lexer. When given the source code as a string (maybe via a file), the lexer
scans from left to right on that string, each time updating the index on that input string and returning a token.
This is the basis of our class Location.</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#CA9EE6">class</span><span style="color:#E5C890;font-style:italic"> Location</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#CA9EE6">    size_t</span><span style="color:#C6D0F5"> internal_index </span><span style="color:#81C8BE">=</span><span style="color:#EF9F76"> 0</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#737994;font-style:italic">    // todo, Jasmine please doooo thissss</span></span>
<span class="line"><span style="color:#737994;font-style:italic">    // override ++ operator</span></span>
<span class="line"><span style="color:#737994;font-style:italic">    // override -- operator</span></span>
<span class="line"><span style="color:#737994;font-style:italic">    // override == operator</span></span>
<span class="line"></span>
<span class="line"><span style="color:#737994;font-style:italic">    // override | (to combine multiple Location)</span></span>
<span class="line"><span style="color:#737994;font-style:italic">    // int overload</span></span>
<span class="line"><span style="color:#949CBB">};</span></span></code></pre>
<p>Suppose our tokens are modeled as:</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#CA9EE6">class</span><span style="color:#E5C890;font-style:italic"> Token</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#CA9EE6">public</span><span style="color:#949CBB">:</span></span>
<span class="line"><span style="color:#C6D0F5">  TokenType type</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#E5C890">  std</span><span style="color:#949CBB">::</span><span style="color:#C6D0F5">string lexeme</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#C6D0F5">  Location location</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#8CAAEE;font-style:italic">  Token</span><span style="color:#949CBB">(</span><span style="color:#E5C890;font-style:italic">TokenType</span><span style="color:#EA999C;font-style:italic"> type</span><span style="color:#949CBB">,</span><span style="color:#E5C890"> std</span><span style="color:#949CBB">::</span><span style="color:#E5C890;font-style:italic">string</span><span style="color:#EA999C;font-style:italic"> lexeme</span><span style="color:#949CBB">,</span><span style="color:#E5C890;font-style:italic"> Location</span><span style="color:#EA999C;font-style:italic"> location</span><span style="color:#949CBB">)</span></span>
<span class="line"><span style="color:#949CBB">      :</span><span style="color:#8CAAEE;font-style:italic"> type</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">type</span><span style="color:#949CBB">),</span><span style="color:#8CAAEE;font-style:italic"> lexeme</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">std</span><span style="color:#949CBB">::</span><span style="color:#8CAAEE;font-style:italic">move</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">lexeme</span><span style="color:#949CBB">)),</span><span style="color:#8CAAEE;font-style:italic"> location</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">location</span><span style="color:#949CBB">)</span><span style="color:#949CBB"> {}</span></span>
<span class="line"><span style="color:#949CBB">};</span></span></code></pre>
<h2 id="ast-nodes-and-the-parser"><a aria-hidden="true" tabindex="-1" href="#ast-nodes-and-the-parser"><span class="icon icon-link"></span></a>AST nodes (and the parser)</h2>
<p>After we've produced our tokens, the parser takes in the stream of tokens and produces our AST. One of the question
is: "If something went wrong, how do we notify programmers?"</p>
<p>The simple thing to do is to combine all the AST's token's location into the AST's location. Below shows a pseudo
code for that</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">curr_tok_location </span><span style="color:#81C8BE">=</span><span style="color:#C6D0F5"> first token location of AST</span></span>
<span class="line"><span style="color:#C6D0F5">For all tokens T that made up the AST:</span></span>
<span class="line"><span style="color:#C6D0F5">    curr_tok_location </span><span style="color:#81C8BE">|=</span><span style="color:#C6D0F5"> T</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">location</span></span>
<span class="line"><span style="color:#C6D0F5">AST</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">Location </span><span style="color:#81C8BE">=</span><span style="color:#C6D0F5"> curr_tok_location</span></span></code></pre>
<h2 id="study-case-scope-checking-visitor"><a aria-hidden="true" tabindex="-1" href="#study-case-scope-checking-visitor"><span class="icon icon-link"></span></a>Study case: scope checking visitor</h2>
<h2 id="ending-words"><a aria-hidden="true" tabindex="-1" href="#ending-words"><span class="icon icon-link"></span></a>Ending words</h2>
<p>Implemented diagnostics for my compiler was really fun. I knew being able to abstract and reuse code is a really
important aspect in software engineering but it is especially essential in compiler. Different stages in a compiler
means that unless I reuse code, repetitive concepts will keep popping up again (hence the Reportee class).</p></div></article></div></div><button class="bottom-4 right-4 fixed"><div class="inline text-2xl font-bold border-black border-2 rounded  p-0 m-0 h-100 w-100">⇡⇡</div></button><footer class="footer self-center justify-center gap-2 pt-4 items-center italic "><p>I&#x27;m looking for new grad compiler work, please email at jjasmine@berkeley.edu</p><p>Built by Jasmine with NextJS, TailwindCSS, and a tonnn of loveee :)</p></footer><script src="/_next/static/chunks/webpack-a3e322df7e912d9b.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[8173,[\"173\",\"static/chunks/173-ad05a37061268ac6.js\",\"880\",\"static/chunks/app/posts/%5Bid%5D/page-0a046863f2056281.js\"],\"\"]\n3:I[5244,[],\"\"]\n4:I[3866,[],\"\"]\n5:I[1168,[\"173\",\"static/chunks/173-ad05a37061268ac6.js\",\"565\",\"static/chunks/565-d3001cb0b7ac580c.js\",\"177\",\"static/chunks/app/layout-23d97ae8d15fbd69.js\"],\"default\"]\n7:I[6213,[],\"OutletBoundary\"]\n9:I[6213,[],\"MetadataBoundary\"]\nb:I[6213,[],\"ViewportBoundary\"]\nd:I[4835,[],\"\"]\n:HL[\"/_next/static/media/7385e8d9d3c5518f-s.p.ttf\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/ttf\"}]\n:HL[\"/_next/static/css/c964a4de8175fdfc.css\",\"style\"]\n:HL[\"/_next/static/css/7ad14cf05ba66ef7.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"qwCmd79stvC19ypyM00Ef\",\"p\":\"\",\"c\":[\"\",\"posts\",\"what_after_kalei_location_debug\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"what_after_kalei_location_debug\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/c964a4de8175fdfc.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"px-4 py-4\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_d4e0c8 flex flex-col min-h-screen\",\"children\":[[\"$\",\"$L2\",null,{\"href\":\"/\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex justify-center items-center py-4 \",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-4xl font-bold\",\"children\":\"Jasmine Tang\"}]}]}],[\"$\",\"div\",null,{\"className\":\"flex-1\",\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"$L5\",null,{}],[\"$\",\"footer\",null,{\"className\":\"footer self-center justify-center gap-2 pt-4 items-center italic \",\"children\":[[\"$\",\"p\",null,{\"children\":\"I'm looking for new grad compiler work, please email at jjasmine@berkeley.edu\"}],[\"$\",\"p\",null,{\"children\":\"Built by Jasmine with NextJS, TailwindCSS, and a tonnn of loveee :)\"}]]}]]}]}]]}],{\"children\":[\"posts\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"id\",\"what_after_kalei_location_debug\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$0:f:0:1:2:children:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L6\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/7ad14cf05ba66ef7.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L7\",null,{\"children\":\"$L8\"}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"sgqSRFv1vUITURTOolS9z\",{\"children\":[[\"$\",\"$L9\",null,{\"children\":\"$La\"}],[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$d\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"e:T4a61,"])</script><script>self.__next_f.push([1,"\u003cnav class=\"toc\"\u003e\u003col class=\"toc-level toc-level-1\"\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#prologue\"\u003ePrologue\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#introduction\"\u003eIntroduction\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#location-reporter-locator-and-reporter\"\u003eLocation, Reporter, Locator and Reporter\u003c/a\u003e\u003col class=\"toc-level toc-level-2\"\u003e\u003cli class=\"toc-item toc-item-h4\"\u003e\u003ca class=\"toc-link toc-link-h4\" href=\"#the-location-class\"\u003eThe Location class\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h4\"\u003e\u003ca class=\"toc-link toc-link-h4\" href=\"#the-reportee-class\"\u003eThe Reportee class\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h4\"\u003e\u003ca class=\"toc-link toc-link-h4\" href=\"#the-reporter-class\"\u003eThe Reporter class\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h4\"\u003e\u003ca class=\"toc-link toc-link-h4\" href=\"#the-locator-class\"\u003eThe Locator class\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#inferring-to-rows-and-columns\"\u003eInferring to rows and columns\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#tokens-and-the-lexer\"\u003eTokens (and the lexer)\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#ast-nodes-and-the-parser\"\u003eAST nodes (and the parser)\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#study-case-scope-checking-visitor\"\u003eStudy case: scope checking visitor\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#ending-words\"\u003eEnding words\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/nav\u003e\u003ch2 id=\"prologue\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#prologue\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003ePrologue\u003c/h2\u003e\n\u003cp\u003eHi everyone, wow, it's been a quick minute since I posted a new article. How's everyone doing :) I'm still trucking\naway at life applying to compiler jobs as well as schooling at Berk. Hope everybody's doing great :)\u003c/p\u003e\n\u003cp\u003eThe\narticle is for\npeople\nwho might be\nasking:\u003c/p\u003e\n\u003cp\u003e\"Ok, I've done the \u003ca href=\"https://llvm.org/docs/tutorial/MyFirstLanguageFrontend/index.html\" rel=\"nofollow\" target=\"_blank\"\u003ellvm tutorial\u003c/a\u003e already.\nWhat's next?\"\u003c/p\u003e\n\u003cp\u003eMore specifically, the article is about adding primitive support for error reporting to the\ntoy compiler.\u003c/p\u003e\n\u003cp\u003eBesides that, the article is also to share my software design decisions regarding my compiler's diagnostics.\u003c/p\u003e\n\u003cp\u003eAs is tradition :) I also wanna share some songs with you. The two songs are \u003ca href=\"\"\u003eValentine\u003c/a\u003e and \u003ca href=\"\"\u003eInto my arms\u003c/a\u003e,\nboth by COIN, one of my fav band. todo explain more about this.\u003c/p\u003e\n\u003cp\u003eI hope you enjoy :) (both the songs and the blog hahah)\u003c/p\u003e\n\u003ch2 id=\"introduction\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#introduction\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eCompiler diagnostics is an important aspect in one's compiler. From erroring out on the programmer's mistake to\nproviding warnings or giving diagnostics, the ability to accurately locate the location of the pesky problems to said\nprogrammer is proven to be extremely valuable: only providing to the programmer the row and column number of where an error occurs is less helpful and more confusing than a compiler pointing, tracing and explaining an error to a programmer.\u003c/p\u003e\n\u003cp\u003eThe article then discusses a way to improve upon the llvm Kaleidoscope toy compiler in the diagnostic aspect for the\nuser. The result below shows the difference between a primitive and a somewhat sophisticated\nerror\ndiagnostics scheme and is are\nimplemented as\npart of\nthe sammine\ncompiler.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/blogs/what_after_kalei_location_debug/comparison.png\" alt=\"comparison between\"\u003e\u003c/p\u003e\n\u003ch2 id=\"location-reporter-locator-and-reporter\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#location-reporter-locator-and-reporter\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eLocation, Reporter, Locator and Reporter\u003c/h2\u003e\n\u003cp\u003eLet's start with a simple description of the problem and a simple answer to the said problem.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eGiven a string (which is the input of the compiler), and a starting point index and an ending point index of said\nstring, indicating the component (either a token or a subpart of some AST) that is faulty.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eBelow shows a string of a \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003elet expression\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e and its corresponding starting and ending point in the input string.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003estart of let expr\n|       end of let expr\n|       |\n↓       ↓\n01234556789\nlet x = 1;\\eof\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHere, the starting point for the let expr has index 0 in\nthe string, and the ending point for the let expr has index 7 in the string (the semicolon at 8 is not counted).\u003c/p\u003e\n\u003cp\u003eFrom first principles, how can a compiler consolidate the location of these tokens: \u003ccode\u003elet\u003c/code\u003e, \u003ccode\u003ex\u003c/code\u003e, \u003ccode\u003e=\u003c/code\u003e, \u003ccode\u003e1\u003c/code\u003e\ntogether and understand that the \u003ccode\u003elet expression\u003c/code\u003e spans from 0 to 7?\u003c/p\u003e\n\u003cp\u003eLet us define the class \u003ccode\u003eLocation\u003c/code\u003e, \u003ccode\u003eReportee\u003c/code\u003e\nand \u003ccode\u003eReporter\u003c/code\u003e currently implemented as part of the compiler and see how all of these building blocks fit in together.\u003c/p\u003e\n\u003ch4 id=\"the-location-class\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#the-location-class\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eThe Location class\u003c/h4\u003e\n\u003cp\u003eThe \u003ccode\u003eLocation\u003c/code\u003e class is basically two indices, indicating the location of a construct in the\ninput string. The first index\n\u003ccode\u003esource_start\u003c/code\u003e\nsignifies the\nstarting location of a component and vice versa for \u003ccode\u003esource_end\u003c/code\u003e. If a construct in the compiler (a token or an AST)\nonly occupies a single space, then \u003ccode\u003esource_start == source_end\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eWhen two \u003ccode\u003eLocation\u003c/code\u003es come together to form one singular \u003ccode\u003eLocation\u003c/code\u003e, we take the minimum of all\n\u003ccode\u003esource_start\u003c/code\u003e and the maximum of all the \u003ccode\u003esource_end\u003c/code\u003e. This is implemented as the pipe operator \u003ccode\u003e|\u003c/code\u003e for the class:\u003c/p\u003e\n\u003cpre class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e// Combine two locations\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003eLocation\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003e operator\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e Location\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#EA999C;font-style:italic\"\u003eother\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003e const\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    Location result\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    result\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_start \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003e std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003emin\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_start\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e other\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_start\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    result\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_end \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003e std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003emax\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_end\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e other\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_end\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e result\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003evoid\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003e operator\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e|=\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e Location\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#EA999C;font-style:italic\"\u003eother\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    source_start \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003e std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003emin\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_start\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e other\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_start\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    source_end \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003e std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003emax\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_end\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e other\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003esource_end\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eLet's look at an example, given the string of a binary expression \u003ccode\u003ex+y\u003c/code\u003e, since \u003ccode\u003ex\u003c/code\u003e takes the \u003ccode\u003eLocation(0,0)\u003c/code\u003e, \u003ccode\u003ey\u003c/code\u003e\ntakes the \u003ccode\u003eLocation(2,2)\u003c/code\u003e. The location for the resulting binary expression is \u003ccode\u003eLocation(min(0,2), max(0,2)) = Location(0, 2)\u003c/code\u003e.\u003c/p\u003e\n\u003ch4 id=\"the-reportee-class\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#the-reportee-class\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eThe Reportee class\u003c/h4\u003e\n\u003cp\u003eGiven a location, we need a message to be associated with it, together with the diagnostic kind: Is this message an\nerror? Is it a warning? Is this just to provide the programmer/compiler writer with some extra information for an\ninformed decision?\u003c/p\u003e\n\u003cp\u003eThe class that takes care of this is the \u003ccode\u003eReportee\u003c/code\u003e class. It defines different \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eReportKind\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e such as \u003ccode\u003eerror\u003c/code\u003e,\n\u003ccode\u003ewarn\u003c/code\u003e or \u003ccode\u003ediag\u003c/code\u003e for error, warning or diagnostics respectively. It also provides abstraction such as \u003ccode\u003eadd_error()\u003c/code\u003e,\n\u003ccode\u003eadd_warn()\u003c/code\u003e or \u003ccode\u003eadd_diag\u003c/code\u003e for said \u003ccode\u003eReportKind\u003c/code\u003es.\u003c/p\u003e\n\u003cp\u003eWho's calling \u003ccode\u003eadd_error()\u003c/code\u003e and \u003ccode\u003eadd_warn()\u003c/code\u003e? Whichever phase the compiler needs to communicate with the programmer\nabout, that phase will inherit from this \u003ccode\u003eReportee\u003c/code\u003e class and use these utilities functions. The sections on Lexer and\nParser will go over these finer details.\u003c/p\u003e\n\u003cp\u003eBesides this, the \u003ccode\u003eReportee\u003c/code\u003e class also carries \u003ccode\u003esize_t\u003c/code\u003e of \u003ccode\u003eerror_count\u003c/code\u003e, \u003ccode\u003ewarn_count\u003c/code\u003e and\n\u003ccode\u003ediag_count\u003c/code\u003e to be used as statistics for the \u003ccode\u003eReporter\u003c/code\u003e class, which is the topic of our next subsection.\u003c/p\u003e\n\u003ch4 id=\"the-reporter-class\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#the-reporter-class\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eThe Reporter class\u003c/h4\u003e\n\u003cp\u003eYou must be wondering, just the \u003ccode\u003esource_start, source_end\u003c/code\u003e is not enough, this result is just the bare minimum.\nSomehow the compiler needs to be able to map a location of \u003ccode\u003e (source_start, source_end)\u003c/code\u003e to the starting and ending rows and columns for easier visualization. The compiler also\nneeds to 'report' messages coming from different stages such as lexing, parsing or type checking. Keeping these\ndetails in mind, let's look at the \u003ccode\u003eReporter\u003c/code\u003e class, who's in charge of these functionalities.\u003c/p\u003e\n\u003cp\u003eThe \u003ccode\u003eReporter\u003c/code\u003e class is in charge of inputting\u003c/p\u003e\n\u003ch4 id=\"the-locator-class\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#the-locator-class\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eThe Locator class\u003c/h4\u003e\n\u003ch3 id=\"inferring-to-rows-and-columns\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#inferring-to-rows-and-columns\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eInferring to rows and columns\u003c/h3\u003e\n\u003ch2 id=\"tokens-and-the-lexer\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#tokens-and-the-lexer\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eTokens (and the lexer)\u003c/h2\u003e\n\u003cp\u003eLet's start with the tokens and the lexer. When given the source code as a string (maybe via a file), the lexer\nscans from left to right on that string, each time updating the index on that input string and returning a token.\nThis is the basis of our class Location.\u003c/p\u003e\n\u003cpre class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e Location\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e    size_t\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e internal_index \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#EF9F76\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e    // todo, Jasmine please doooo thissss\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e    // override ++ operator\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e    // override -- operator\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e    // override == operator\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e    // override | (to combine multiple Location)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e    // int overload\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e};\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSuppose our tokens are modeled as:\u003c/p\u003e\n\u003cpre class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e Token\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003epublic\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e  TokenType type\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E5C890\"\u003e  std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003estring lexeme\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e  Location location\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003e  Token\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003eTokenType\u003c/span\u003e\u003cspan style=\"color:#EA999C;font-style:italic\"\u003e type\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003e std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#EA999C;font-style:italic\"\u003e lexeme\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e Location\u003c/span\u003e\u003cspan style=\"color:#EA999C;font-style:italic\"\u003e location\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e      :\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003e type\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e),\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003e lexeme\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003estd\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003emove\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003elexeme\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)),\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003e location\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003elocation\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e};\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"ast-nodes-and-the-parser\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#ast-nodes-and-the-parser\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eAST nodes (and the parser)\u003c/h2\u003e\n\u003cp\u003eAfter we've produced our tokens, the parser takes in the stream of tokens and produces our AST. One of the question\nis: \"If something went wrong, how do we notify programmers?\"\u003c/p\u003e\n\u003cp\u003eThe simple thing to do is to combine all the AST's token's location into the AST's location. Below shows a pseudo\ncode for that\u003c/p\u003e\n\u003cpre class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003ecurr_tok_location \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e first token location of AST\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eFor all tokens T that made up the AST:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    curr_tok_location \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e|=\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e T\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003elocation\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003eAST\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eLocation \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e curr_tok_location\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"study-case-scope-checking-visitor\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#study-case-scope-checking-visitor\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eStudy case: scope checking visitor\u003c/h2\u003e\n\u003ch2 id=\"ending-words\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#ending-words\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eEnding words\u003c/h2\u003e\n\u003cp\u003eImplemented diagnostics for my compiler was really fun. I knew being able to abstract and reuse code is a really\nimportant aspect in software engineering but it is especially essential in compiler. Different stages in a compiler\nmeans that unless I reuse code, repetitive concepts will keep popping up again (hence the Reportee class).\u003c/p\u003e"])</script><script>self.__next_f.push([1,"6:[\"$\",\"div\",null,{\"className\":\"py-12 flex flex-col items-center  justify-items-start mx-auto \",\"children\":[[\"$\",\"$L2\",null,{\"href\":\"/blog\",\"className\":\"flex justify-center text-4xl\",\"children\":[\"$\",\"h2\",null,{\"children\":\"My blog\"}]}],[\"$\",\"article\",null,{\"className\":\"p-8 prose pt-0.5 max-w-none w-full lg:w-1/2 md:w-4/6 sm:w-5/6 prose-sky mx-auto\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex justify-center text-2xl font-bold \",\"children\":[\"$\",\"h2\",null,{\"children\":\"[ONGOING] What after Kaleidoscope: Error location\"}]}],[\"$\",\"div\",null,{\"className\":\"flex justify-start text-xl font-bold underline\",\"children\":[\"$\",\"h4\",null,{\"children\":\"8888-08-08\"}]}],[\"$\",\"div\",null,{\"className\":\"flex font-bold\",\"children\":\"Edit:\"}],\"My resume is \",[\"$\",\"a\",null,{\"href\":\"https://www.overleaf.com/project/638120c30d0003f7bfe10360\",\"children\":\"here\"}],\" (and downloadable \",[\"$\",\"a\",null,{\"href\":\"https://badumbatish.github.io/about_me/Jasmine_Resume_Badumbatish.pdf\",\"children\":\"here\"}],\"). If you know of a compiler related job posting, please feel free to contact me or refer me at either \",[\"$\",\"a\",null,{\"href\":\"tanghocle456@gmail.com\",\"children\":\"tanghocle456@gmail.com\"}],\" or \",[\"$\",\"a\",null,{\"href\":\"jjasmine@berkeley.edu\",\"children\":\"jjasmine@berkeley.edu\"}],\".\",[\"$\",\"hr\",null,{}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$e\"}}]]}]]}]\na:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"[ONGOING] What after Kaleidoscope: Error location\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Built with NextJS, TailwindCSS, and a tonnn of loveee :)\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/_next/static/media/pfp5.0daa0f7d.jpeg\"}]]\n8:null\n"])</script></body></html>