<!DOCTYPE html><html lang="en" class="px-4 py-4"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/7385e8d9d3c5518f-s.p.ttf" as="font" crossorigin="" type="font/ttf"/><link rel="stylesheet" href="/_next/static/css/c6922907e2c7234d.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/7ad14cf05ba66ef7.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-a3e322df7e912d9b.js"/><script src="/_next/static/chunks/4bd1b696-436c238309a8f4af.js" async=""></script><script src="/_next/static/chunks/517-2d9b4e2e142759c9.js" async=""></script><script src="/_next/static/chunks/main-app-c950134184dd4dae.js" async=""></script><script src="/_next/static/chunks/173-09f9817a8afa96b6.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bid%5D/page-e6fe5a7838cebbe2.js" async=""></script><script src="/_next/static/chunks/970-1bb5a11d460674d4.js" async=""></script><script src="/_next/static/chunks/app/layout-cbcb38714b860a54.js" async=""></script><meta name="next-size-adjust" content=""/><title>[ONGOING] Extending LLVM&#x27;s Kaleidoscope: Code-gen edition</title><meta name="description" content="Jasmine reports what she learned of LLVM basic codegen capabilities"/><link rel="icon" href="/_next/static/media/pfp5.0daa0f7d.jpeg"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__className_d4e0c8 flex flex-col min-h-screen"><a href="/"><div class="flex justify-center items-center py-4 "><h1 class="text-4xl font-bold">Jasmine Tang</h1></div></a><div class="flex-1"><div class="py-12 flex flex-col items-center  justify-items-start mx-auto "><a class="flex justify-center text-4xl" href="/blog"><h2>My blog</h2></a><article class="p-8 prose pt-0.5 max-w-none w-full lg:w-1/2 md:w-4/6 sm:w-5/6 prose-sky mx-auto"><div class="flex justify-center text-2xl font-bold "><h2>[ONGOING] Extending LLVM&#x27;s Kaleidoscope: Code-gen edition</h2></div><div class="flex font-bold">Edit:</div><p>Hi everyone! My friend <a href="https://www.linkedin.com/in/julius-alexandre/">Julius</a> is looking for compiler full time roles and/or internship opportunities for 2025/2026.</p><p>Julius is an undergrad at Western Governors University specializing in computer architecture and compilers.</p><p>He&#x27;s <a href="https://github.com/llvm/llvm-project/commits/main/?author=wizardengineer">contributed to LLVM</a> and is knowledgeable of the compiler architecture, as a result, he&#x27;s wellâ€‘versed in C, C++, Python, LLVM, and Assembly.</p><p>His impressive open source projects, which have a combined stars of 200+, range from developing OS kernels to writing hypervisors for AMD-v.</p><p>His resume is <a href="https://badumbatish.github.io/blogs/compiler_questions_where_to_find_them/Julius_Alexander_SWE_Compiler.pdf">here</a>. I hope everybody can give him a referral or reach out to him at his <a href="https://www.linkedin.com/in/julius-alexandre/">LinkedIn</a></p><div class="flex justify-start text-xl font-bold underline"><h4>2025-06-27</h4></div><div><nav class="toc"><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#prologue">Prologue</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#introduction">Introduction</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#on-the-side-of-coding">On the side of coding</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#a-few-brief-words-on-building-tools-and-ast-ir-inspection">A few brief words on building tools and ast-ir inspection</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#codegening">Codegening</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#allocation-of-the-stack-and-mem2reg">Alloca(tion of the stack) and mem2reg</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#variables">Variables</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#control-flow">Control flow</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#functions-and-extern-via-prototypeast">Functions and Extern (via PrototypeAST)</a><ol class="toc-level toc-level-3"><li class="toc-item toc-item-h4"><a class="toc-link toc-link-h4" href="#case-study-printf">Case study: printf</a></li></ol></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#garbage-collection">Garbage collection</a><ol class="toc-level toc-level-3"><li class="toc-item toc-item-h4"><a class="toc-link toc-link-h4" href="#case-study-malloc">Case study: malloc</a></li><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#epilogue">Epilogue</a></li></ol></li></ol></li></ol></nav><h2 id="prologue"><a aria-hidden="true" tabindex="-1" href="#prologue"><span class="icon icon-link"></span></a>Prologue</h2>
<p>Hey everyone, how everyone's doing? I've been back at my parents' place for a while now, getting ready to start
Igalia :)
I'm still doing good hahhaa :) Getting back to OC after being far far away in Berkeley wonderland means that I have to build back
as well as get in touch with old support network. I guess it's just takes a while to get used to. [TODO: talk about
health and personal issues persist, nanny]</p>
<p>This article documents what I've learned about the basics of LLVM's code generation process, self-contained in lowering from AST to LLVM-IR only :) More experience and time is needed to venture out further away to write more sophisticated articles. Oh well, maybe after I've been at Igalia for a while hahaha :)</p>
<p>As is tradition, here are three songs for you by Zedd: <a href="https://youtu.be/HwtljkGZJnI?si=6kS1eXfN3DS7TokP" rel="nofollow" target="_blank">Papercut</a>,
<a href="https://youtu.be/ZqJiXLJs_Pg?si=P8as3-nXevZ3BfuA" rel="nofollow" target="_blank">Addicted To A Memory</a>, and
<a href="https://youtu.be/BjsjIkSb0cM?si=rNyI9JeS6N5r1NFc" rel="nofollow" target="_blank">Done With Love</a>. All
three songs showcase extremely well the emotional depth of a person in and out of love.</p>
<p>I hope you enjoy the songs :)</p>
<h2 id="introduction"><a aria-hidden="true" tabindex="-1" href="#introduction"><span class="icon icon-link"></span></a>Introduction</h2>
<p>Codegen in LLVM is an extremely well-thought-out process. For a simple stack-centric codegen
process, the framework
users
can abstract away SSA form; the <strong>alloca</strong> process together with mem2reg allows an
extremely fast assembly generation even for primitive stack allocations.</p>
<p>In this article, I'll report on the codegen process of sammine-lang, an extension on the kaleidoscope tutorial.
Besides code generation for scalar values, funcitons and control flow, the article also touches on code gen for
aggregated data types such as structs :) I hope everyone enjoys :)</p>
<p>The below picture demonstrates sammine's ability to generate code for fibonacci, a classic mathematical problem :)
[TODO: show that sammine can indeed code fibonacci and output assembly for it]</p>
<p>Aggregated datatype's also generated with sammine:
[TODO: show that sammine can indeed code record]</p>
<h2 id="on-the-side-of-coding"><a aria-hidden="true" tabindex="-1" href="#on-the-side-of-coding"><span class="icon icon-link"></span></a>On the side of coding</h2>
<h3 id="a-few-brief-words-on-building-tools-and-ast-ir-inspection"><a aria-hidden="true" tabindex="-1" href="#a-few-brief-words-on-building-tools-and-ast-ir-inspection"><span class="icon icon-link"></span></a>A few brief words on building tools and ast-ir inspection</h3>
<p>A very, very smart CS person in my compiler class at UC Berkeley once told me something along
the line of "use/build your tool very well" and I feel like
I want to share it in this blog. The use case of when he told me might be different
, but the principle still remains the same: regardless if it's about the compiler, terminal tool, or
your IDE, it really pays off to learn how to use your tool so good that it
completely boosts your productivity into a different dimension.</p>
<p>After having to <code>cmake --build build -j</code> the compiler project for 50+ times a day, I built <a href="">brt.nvim</a> to shorten
the dev
cycle;
now I press
three keystrokes to build, run and test the compiler project (Hence the name BRT :)) :)</p>
<p>"But wait, how does this apply to the development of sammine?" - a reader asks.
The
same
applies for developing sammine itself :) There were a lot of frictions for different features. bla bla bla</p>
<h2 id="codegening"><a aria-hidden="true" tabindex="-1" href="#codegening"><span class="icon icon-link"></span></a>Codegening</h2>
<h3 id="allocation-of-the-stack-and-mem2reg"><a aria-hidden="true" tabindex="-1" href="#allocation-of-the-stack-and-mem2reg"><span class="icon icon-link"></span></a>Alloca(tion of the stack) and mem2reg</h3>
<p>todo talk about allocation of the stack, first draws out an example of the global var in llvm ir</p>
<h3 id="variables"><a aria-hidden="true" tabindex="-1" href="#variables"><span class="icon icon-link"></span></a>Variables</h3>
<p>discuss three modes:</p>
<ul>
<li>creation: in var def and the map that keeps it, this done using alloca</li>
<li>modification: in binary op =, this stores to address of alloca</li>
<li>read: this loads from address of alloca.</li>
</ul>
<p>todo: talks about in relation to the walk and visitor pattern</p>
<h3 id="control-flow"><a aria-hidden="true" tabindex="-1" href="#control-flow"><span class="icon icon-link"></span></a>Control flow</h3>
<p>discuss how alloca makes this easier.</p>
<h3 id="functions-and-extern-via-prototypeast"><a aria-hidden="true" tabindex="-1" href="#functions-and-extern-via-prototypeast"><span class="icon icon-link"></span></a>Functions and Extern (via PrototypeAST)</h3>
<p>todo: talk about a caveat that we need to allocate "alloca" addresses at the start of the function.
todo: relate to how strong the visitor pattern is</p>
<h4 id="case-study-printf"><a aria-hidden="true" tabindex="-1" href="#case-study-printf"><span class="icon icon-link"></span></a>Case study: printf</h4>
<p>Back in Berk, I sometimes would play <a href="https://www.factorio.com/" rel="nofollow" target="_blank">Factorio</a> in my free time. The game is intuitive
and interesting. But for some
reasons, the game really stresses me out. "Wait a minute, I love problem-solving, don't I? But I feel so stressed
trying to build the factory with these new science packs and these new different energy types." Now, in this summer
of 2025, when I'm writing my own compiler, I suddenly realize the reason. I love problem sovling, but I was solving
the wrong problems. I wasn't interested in trying to build and maintain factories. Rather, compiler always seems to have
a softer spot in my heart. That and blog writing, hence I'm writing this :)</p>
<p>Ah, I still don't know what I'm rambling
about. I guess what I'm trying to say is in that in my experience, while I enjoy problem-solving in general, it also
matters what type of problems I'm solving. Factorio, leaning hard into resource management and logistics, just isn't
my forte, which is creative expression (writing), coding and abstraction (compiler engineer). Maybe front-end
and/or back-end
development
isn't what you love,
then you
should consider switching to compiler engineering, ahhahahha :P</p>
<p>Anyways, let's now talk about the
lowering of printing..</p>
<p>Right now, in sammine, I'm adopting a python-esque way of printing:</p>
<pre><code>print(x);  # x and y are variables in this case
println(y);
println(2.4 + 5.3); # printing should also support expressions
</code></pre>
<p>With int and double powered by alloca, how should we go around lowering this?</p>
<p>We know that in libc, the signature for printf() is bla bla bla hahaha</p>
<ul>
<li>print(2)</li>
<li>print("x")</li>
<li>println(2.4)</li>
</ul>
<h3 id="garbage-collection"><a aria-hidden="true" tabindex="-1" href="#garbage-collection"><span class="icon icon-link"></span></a>Garbage collection</h3>
<h4 id="case-study-malloc"><a aria-hidden="true" tabindex="-1" href="#case-study-malloc"><span class="icon icon-link"></span></a>Case study: malloc</h4>
<h1 id="epilogue"><a aria-hidden="true" tabindex="-1" href="#epilogue"><span class="icon icon-link"></span></a>Epilogue</h1>
<p>The article, as you can tell, is directed towards new grads and/or beginners in LLVM. If you've benefited from the article
or if you'd like to support my writing these blogs, please consider <a href="">getting me a red bull</a> :)</p>
<p>I also want to extend my thanks to all the developers that helped contributed to the
Kaleidoscope. Without them, the journey to generate code, as well as the creation of this article, would be
ten-fold harder. I realize that we all stands on the shoulder of the previous generations and of giants and I would like to pay my tribute to them.</p></div></article></div></div><button class="bottom-4 right-4 fixed"><div class="inline text-2xl font-bold border-black border-2 rounded  p-0 m-0 h-100 w-100">â‡¡â‡¡</div></button><footer class="footer self-center justify-center gap-2 pt-4 items-center italic "><p>Built by Jasmine with NextJS, TailwindCSS, and a tonnn of loveee :)</p></footer><script src="/_next/static/chunks/webpack-a3e322df7e912d9b.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[8173,[\"173\",\"static/chunks/173-09f9817a8afa96b6.js\",\"880\",\"static/chunks/app/posts/%5Bid%5D/page-e6fe5a7838cebbe2.js\"],\"\"]\n3:I[5244,[],\"\"]\n4:I[3866,[],\"\"]\n5:I[1168,[\"173\",\"static/chunks/173-09f9817a8afa96b6.js\",\"970\",\"static/chunks/970-1bb5a11d460674d4.js\",\"177\",\"static/chunks/app/layout-cbcb38714b860a54.js\"],\"default\"]\n7:I[6213,[],\"OutletBoundary\"]\n9:I[6213,[],\"MetadataBoundary\"]\nb:I[6213,[],\"ViewportBoundary\"]\nd:I[4835,[],\"\"]\n:HL[\"/_next/static/media/7385e8d9d3c5518f-s.p.ttf\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/ttf\"}]\n:HL[\"/_next/static/css/c6922907e2c7234d.css\",\"style\"]\n:HL[\"/_next/static/css/7ad14cf05ba66ef7.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"tPwAinSy8sCGBbgcs4Y-w\",\"p\":\"\",\"c\":[\"\",\"posts\",\"codegen_extend_kalei\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"codegen_extend_kalei\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/c6922907e2c7234d.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"px-4 py-4\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_d4e0c8 flex flex-col min-h-screen\",\"children\":[[\"$\",\"$L2\",null,{\"href\":\"/\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex justify-center items-center py-4 \",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-4xl font-bold\",\"children\":\"Jasmine Tang\"}]}]}],[\"$\",\"div\",null,{\"className\":\"flex-1\",\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"$L5\",null,{}],[\"$\",\"footer\",null,{\"className\":\"footer self-center justify-center gap-2 pt-4 items-center italic \",\"children\":[\"$\",\"p\",null,{\"children\":\"Built by Jasmine with NextJS, TailwindCSS, and a tonnn of loveee :)\"}]}]]}]}]]}],{\"children\":[\"posts\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"id\",\"codegen_extend_kalei\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$0:f:0:1:2:children:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L6\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/7ad14cf05ba66ef7.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L7\",null,{\"children\":\"$L8\"}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"tUCXerxNBYNLaHtT7clWd\",{\"children\":[[\"$\",\"$L9\",null,{\"children\":\"$La\"}],[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$d\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"e:T271c,"])</script><script>self.__next_f.push([1,"\u003cnav class=\"toc\"\u003e\u003col class=\"toc-level toc-level-1\"\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#prologue\"\u003ePrologue\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#introduction\"\u003eIntroduction\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#on-the-side-of-coding\"\u003eOn the side of coding\u003c/a\u003e\u003col class=\"toc-level toc-level-2\"\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#a-few-brief-words-on-building-tools-and-ast-ir-inspection\"\u003eA few brief words on building tools and ast-ir inspection\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#codegening\"\u003eCodegening\u003c/a\u003e\u003col class=\"toc-level toc-level-2\"\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#allocation-of-the-stack-and-mem2reg\"\u003eAlloca(tion of the stack) and mem2reg\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#variables\"\u003eVariables\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#control-flow\"\u003eControl flow\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#functions-and-extern-via-prototypeast\"\u003eFunctions and Extern (via PrototypeAST)\u003c/a\u003e\u003col class=\"toc-level toc-level-3\"\u003e\u003cli class=\"toc-item toc-item-h4\"\u003e\u003ca class=\"toc-link toc-link-h4\" href=\"#case-study-printf\"\u003eCase study: printf\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#garbage-collection\"\u003eGarbage collection\u003c/a\u003e\u003col class=\"toc-level toc-level-3\"\u003e\u003cli class=\"toc-item toc-item-h4\"\u003e\u003ca class=\"toc-link toc-link-h4\" href=\"#case-study-malloc\"\u003eCase study: malloc\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h1\"\u003e\u003ca class=\"toc-link toc-link-h1\" href=\"#epilogue\"\u003eEpilogue\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/nav\u003e\u003ch2 id=\"prologue\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#prologue\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003ePrologue\u003c/h2\u003e\n\u003cp\u003eHey everyone, how everyone's doing? I've been back at my parents' place for a while now, getting ready to start\nIgalia :)\nI'm still doing good hahhaa :) Getting back to OC after being far far away in Berkeley wonderland means that I have to build back\nas well as get in touch with old support network. I guess it's just takes a while to get used to. [TODO: talk about\nhealth and personal issues persist, nanny]\u003c/p\u003e\n\u003cp\u003eThis article documents what I've learned about the basics of LLVM's code generation process, self-contained in lowering from AST to LLVM-IR only :) More experience and time is needed to venture out further away to write more sophisticated articles. Oh well, maybe after I've been at Igalia for a while hahaha :)\u003c/p\u003e\n\u003cp\u003eAs is tradition, here are three songs for you by Zedd: \u003ca href=\"https://youtu.be/HwtljkGZJnI?si=6kS1eXfN3DS7TokP\" rel=\"nofollow\" target=\"_blank\"\u003ePapercut\u003c/a\u003e,\n\u003ca href=\"https://youtu.be/ZqJiXLJs_Pg?si=P8as3-nXevZ3BfuA\" rel=\"nofollow\" target=\"_blank\"\u003eAddicted To A Memory\u003c/a\u003e, and\n\u003ca href=\"https://youtu.be/BjsjIkSb0cM?si=rNyI9JeS6N5r1NFc\" rel=\"nofollow\" target=\"_blank\"\u003eDone With Love\u003c/a\u003e. All\nthree songs showcase extremely well the emotional depth of a person in and out of love.\u003c/p\u003e\n\u003cp\u003eI hope you enjoy the songs :)\u003c/p\u003e\n\u003ch2 id=\"introduction\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#introduction\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eCodegen in LLVM is an extremely well-thought-out process. For a simple stack-centric codegen\nprocess, the framework\nusers\ncan abstract away SSA form; the \u003cstrong\u003ealloca\u003c/strong\u003e process together with mem2reg allows an\nextremely fast assembly generation even for primitive stack allocations.\u003c/p\u003e\n\u003cp\u003eIn this article, I'll report on the codegen process of sammine-lang, an extension on the kaleidoscope tutorial.\nBesides code generation for scalar values, funcitons and control flow, the article also touches on code gen for\naggregated data types such as structs :) I hope everyone enjoys :)\u003c/p\u003e\n\u003cp\u003eThe below picture demonstrates sammine's ability to generate code for fibonacci, a classic mathematical problem :)\n[TODO: show that sammine can indeed code fibonacci and output assembly for it]\u003c/p\u003e\n\u003cp\u003eAggregated datatype's also generated with sammine:\n[TODO: show that sammine can indeed code record]\u003c/p\u003e\n\u003ch2 id=\"on-the-side-of-coding\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#on-the-side-of-coding\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eOn the side of coding\u003c/h2\u003e\n\u003ch3 id=\"a-few-brief-words-on-building-tools-and-ast-ir-inspection\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#a-few-brief-words-on-building-tools-and-ast-ir-inspection\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eA few brief words on building tools and ast-ir inspection\u003c/h3\u003e\n\u003cp\u003eA very, very smart CS person in my compiler class at UC Berkeley once told me something along\nthe line of \"use/build your tool very well\" and I feel like\nI want to share it in this blog. The use case of when he told me might be different\n, but the principle still remains the same: regardless if it's about the compiler, terminal tool, or\nyour IDE, it really pays off to learn how to use your tool so good that it\ncompletely boosts your productivity into a different dimension.\u003c/p\u003e\n\u003cp\u003eAfter having to \u003ccode\u003ecmake --build build -j\u003c/code\u003e the compiler project for 50+ times a day, I built \u003ca href=\"\"\u003ebrt.nvim\u003c/a\u003e to shorten\nthe dev\ncycle;\nnow I press\nthree keystrokes to build, run and test the compiler project (Hence the name BRT :)) :)\u003c/p\u003e\n\u003cp\u003e\"But wait, how does this apply to the development of sammine?\" - a reader asks.\nThe\nsame\napplies for developing sammine itself :) There were a lot of frictions for different features. bla bla bla\u003c/p\u003e\n\u003ch2 id=\"codegening\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#codegening\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eCodegening\u003c/h2\u003e\n\u003ch3 id=\"allocation-of-the-stack-and-mem2reg\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#allocation-of-the-stack-and-mem2reg\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eAlloca(tion of the stack) and mem2reg\u003c/h3\u003e\n\u003cp\u003etodo talk about allocation of the stack, first draws out an example of the global var in llvm ir\u003c/p\u003e\n\u003ch3 id=\"variables\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#variables\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eVariables\u003c/h3\u003e\n\u003cp\u003ediscuss three modes:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ecreation: in var def and the map that keeps it, this done using alloca\u003c/li\u003e\n\u003cli\u003emodification: in binary op =, this stores to address of alloca\u003c/li\u003e\n\u003cli\u003eread: this loads from address of alloca.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003etodo: talks about in relation to the walk and visitor pattern\u003c/p\u003e\n\u003ch3 id=\"control-flow\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#control-flow\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eControl flow\u003c/h3\u003e\n\u003cp\u003ediscuss how alloca makes this easier.\u003c/p\u003e\n\u003ch3 id=\"functions-and-extern-via-prototypeast\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#functions-and-extern-via-prototypeast\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eFunctions and Extern (via PrototypeAST)\u003c/h3\u003e\n\u003cp\u003etodo: talk about a caveat that we need to allocate \"alloca\" addresses at the start of the function.\ntodo: relate to how strong the visitor pattern is\u003c/p\u003e\n\u003ch4 id=\"case-study-printf\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#case-study-printf\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eCase study: printf\u003c/h4\u003e\n\u003cp\u003eBack in Berk, I sometimes would play \u003ca href=\"https://www.factorio.com/\" rel=\"nofollow\" target=\"_blank\"\u003eFactorio\u003c/a\u003e in my free time. The game is intuitive\nand interesting. But for some\nreasons, the game really stresses me out. \"Wait a minute, I love problem-solving, don't I? But I feel so stressed\ntrying to build the factory with these new science packs and these new different energy types.\" Now, in this summer\nof 2025, when I'm writing my own compiler, I suddenly realize the reason. I love problem sovling, but I was solving\nthe wrong problems. I wasn't interested in trying to build and maintain factories. Rather, compiler always seems to have\na softer spot in my heart. That and blog writing, hence I'm writing this :)\u003c/p\u003e\n\u003cp\u003eAh, I still don't know what I'm rambling\nabout. I guess what I'm trying to say is in that in my experience, while I enjoy problem-solving in general, it also\nmatters what type of problems I'm solving. Factorio, leaning hard into resource management and logistics, just isn't\nmy forte, which is creative expression (writing), coding and abstraction (compiler engineer). Maybe front-end\nand/or back-end\ndevelopment\nisn't what you love,\nthen you\nshould consider switching to compiler engineering, ahhahahha :P\u003c/p\u003e\n\u003cp\u003eAnyways, let's now talk about the\nlowering of printing..\u003c/p\u003e\n\u003cp\u003eRight now, in sammine, I'm adopting a python-esque way of printing:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eprint(x);  # x and y are variables in this case\nprintln(y);\nprintln(2.4 + 5.3); # printing should also support expressions\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWith int and double powered by alloca, how should we go around lowering this?\u003c/p\u003e\n\u003cp\u003eWe know that in libc, the signature for printf() is bla bla bla hahaha\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eprint(2)\u003c/li\u003e\n\u003cli\u003eprint(\"x\")\u003c/li\u003e\n\u003cli\u003eprintln(2.4)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"garbage-collection\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#garbage-collection\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eGarbage collection\u003c/h3\u003e\n\u003ch4 id=\"case-study-malloc\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#case-study-malloc\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eCase study: malloc\u003c/h4\u003e\n\u003ch1 id=\"epilogue\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#epilogue\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eEpilogue\u003c/h1\u003e\n\u003cp\u003eThe article, as you can tell, is directed towards new grads and/or beginners in LLVM. If you've benefited from the article\nor if you'd like to support my writing these blogs, please consider \u003ca href=\"\"\u003egetting me a red bull\u003c/a\u003e :)\u003c/p\u003e\n\u003cp\u003eI also want to extend my thanks to all the developers that helped contributed to the\nKaleidoscope. Without them, the journey to generate code, as well as the creation of this article, would be\nten-fold harder. I realize that we all stands on the shoulder of the previous generations and of giants and I would like to pay my tribute to them.\u003c/p\u003e"])</script><script>self.__next_f.push([1,"6:[\"$\",\"div\",null,{\"className\":\"py-12 flex flex-col items-center  justify-items-start mx-auto \",\"children\":[[\"$\",\"$L2\",null,{\"href\":\"/blog\",\"className\":\"flex justify-center text-4xl\",\"children\":[\"$\",\"h2\",null,{\"children\":\"My blog\"}]}],[\"$\",\"article\",null,{\"className\":\"p-8 prose pt-0.5 max-w-none w-full lg:w-1/2 md:w-4/6 sm:w-5/6 prose-sky mx-auto\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex justify-center text-2xl font-bold \",\"children\":[\"$\",\"h2\",null,{\"children\":\"[ONGOING] Extending LLVM's Kaleidoscope: Code-gen edition\"}]}],[\"$\",\"div\",null,{\"className\":\"flex font-bold\",\"children\":\"Edit:\"}],[\"$\",\"p\",null,{\"children\":[\"Hi everyone! My friend \",[\"$\",\"a\",null,{\"href\":\"https://www.linkedin.com/in/julius-alexandre/\",\"children\":\"Julius\"}],\" is looking for compiler full time roles and/or internship opportunities for 2025/2026.\"]}],[\"$\",\"p\",null,{\"children\":\"Julius is an undergrad at Western Governors University specializing in computer architecture and compilers.\"}],[\"$\",\"p\",null,{\"children\":[\"He's \",[\"$\",\"a\",null,{\"href\":\"https://github.com/llvm/llvm-project/commits/main/?author=wizardengineer\",\"children\":\"contributed to LLVM\"}],\" and is knowledgeable of the compiler architecture, as a result, he's wellâ€‘versed in C, C++, Python, LLVM, and Assembly.\"]}],[\"$\",\"p\",null,{\"children\":\"His impressive open source projects, which have a combined stars of 200+, range from developing OS kernels to writing hypervisors for AMD-v.\"}],[\"$\",\"p\",null,{\"children\":[\"His resume is \",[\"$\",\"a\",null,{\"href\":\"https://badumbatish.github.io/blogs/compiler_questions_where_to_find_them/Julius_Alexander_SWE_Compiler.pdf\",\"children\":\"here\"}],\". I hope everybody can give him a referral or reach out to him at his \",[\"$\",\"a\",null,{\"href\":\"https://www.linkedin.com/in/julius-alexandre/\",\"children\":\"LinkedIn\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex justify-start text-xl font-bold underline\",\"children\":[\"$\",\"h4\",null,{\"children\":\"2025-06-27\"}]}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$e\"}}]]}]]}]\na:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}"])</script><script>self.__next_f.push([1,"],[\"$\",\"title\",\"1\",{\"children\":\"[ONGOING] Extending LLVM's Kaleidoscope: Code-gen edition\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Jasmine reports what she learned of LLVM basic codegen capabilities\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/_next/static/media/pfp5.0daa0f7d.jpeg\"}]]\n8:null\n"])</script></body></html>