<!DOCTYPE html><!--m44wlJPGeChQFGUZAkyzS--><html lang="en" class="px-4 py-4"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/7385e8d9d3c5518f-s.p.ttf" as="font" crossorigin="" type="font/ttf"/><link rel="stylesheet" href="/_next/static/css/f55f51dd62de488d.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/8a287c41de7a8698.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-b2488ded99eca76e.js"/><script src="/_next/static/chunks/4bd1b696-cf72ae8a39fa05aa.js" async=""></script><script src="/_next/static/chunks/964-05defa3e0b8af640.js" async=""></script><script src="/_next/static/chunks/main-app-98bd3314d8e089b7.js" async=""></script><script src="/_next/static/chunks/874-437a265a67d6cfee.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bid%5D/page-8778b7e42f8ceed2.js" async=""></script><script src="/_next/static/chunks/app/layout-6c77c7f0e287af25.js" async=""></script><meta name="next-size-adjust" content=""/><title>What I did for GSoc 2024</title><meta name="description" content="The article is a report of what Jasmine&#x27;s done for her Google Summer Of Code"/><link rel="icon" href="/_next/static/media/pfp6.723cdd8c.png"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__className_d4e0c8 flex flex-col min-h-screen"><div hidden=""><!--$--><!--/$--></div><a href="/"><div class="flex justify-center items-center py-4 "><h1 class="text-4xl font-bold">Jasmine Tang</h1></div></a><div class="flex-1"><div class="py-12 flex flex-col items-center  justify-items-start mx-auto "><a class="flex justify-center text-4xl" href="/blog"><h2>My blog</h2></a><article class="p-8 prose pt-0.5 max-w-none w-full lg:w-1/2 md:w-4/6 sm:w-5/6 prose-sky mx-auto"><div class="flex justify-center text-2xl font-bold "><h2>What I did for GSoc 2024</h2></div><div class="flex justify-start text-xl font-bold underline"><h4>2024-08-22</h4></div><div><nav class="toc"><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#introduction">Introduction</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#main-contribution-aspects">Main contribution aspects</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#issues-and-prs">Issues and PRs</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#issues">Issues</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#prs">PRs</a></li><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#gccrs-inline-assembly">GCCRS Inline Assembly</a><ol class="toc-level toc-level-3"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#purpose">Purpose</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#syntax">Syntax</a><ol class="toc-level toc-level-4"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#grammar">Grammar</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#syntax-example">Syntax example</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#overall-architecture">Overall architecture</a><ol class="toc-level toc-level-4"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#definition">Definition</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#architecture">Architecture</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#related-files">Related files</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#architecture-visualization">Architecture visualization</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#ast">AST</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#parser">Parser</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#ast-to-hir">AST to HIR</a><ol class="toc-level toc-level-4"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#hir-creation">HIR Creation</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#unsafe-gating">Unsafe gating</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#type-checking">Type checking</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#resolution">Resolution</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#tree-generic">TREE (GENERIC)</a><ol class="toc-level toc-level-4"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#overall">Overall</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#anatomy">Anatomy</a><ol class="toc-level toc-level-5"><li class="toc-item toc-item-h4"><a class="toc-link toc-link-h4" href="#tree_list">TREE_LIST</a></li><li class="toc-item toc-item-h4"><a class="toc-link toc-link-h4" href="#string_cst">STRING_CST</a></li><li class="toc-item toc-item-h4"><a class="toc-link toc-link-h4" href="#asm_expr">ASM_EXPR</a></li></ol></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#tree-usage">TREE USAGE</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#results">Results</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#end-words">End words</a></li></ol></li></ol></li></ol></nav><p>Hi everyone, this article is a requirement for my GSoc Final Submission, linking directly to the submission.</p>
<p>This article will include the summary of my contribution, where you can find all my filed issues and PRs.</p>
<h2 id="introduction"><a aria-hidden="true" tabindex="-1" href="#introduction"><span class="icon icon-link"></span></a>Introduction</h2>
<p>This summer I worked on the <a href="https://github.com/Rust-GCC/gccrs" rel="nofollow" target="_blank">gccrs</a> project, a GCC Front-end for Rust.</p>
<p>gccrs is a project to implement the Rust programming languages from scratch in the GCC codebase in order for rust to be able to be compiled to a wider amount of targets. It currently targets the version 1.49 of Rust and is supported by Open Source Security and Embecosm.</p>
<p>By doing this, it helps with a couple things:</p>
<ul>
<li>Targets architecture not available with rustc due to the use of LLVM. (SuperH for example, which powers the Dreamcast!)</li>
<li>Benefit from the existing GCC ecosystem.</li>
<li>Help with acceptance of Rust in the Linux kernel</li>
<li>Help with acceptance of Rust in other fields, where having multiple compilers helps.</li>
<li>Enable building Rust on targets with very old C++ compilers! (Targets with at least GCC version 4.8 (which released March 22, 2013) can build Rust)</li>
</ul>
<h2 id="main-contribution-aspects"><a aria-hidden="true" tabindex="-1" href="#main-contribution-aspects"><span class="icon icon-link"></span></a>Main contribution aspects</h2>
<p>Overall, I contributed in 3 main aspects:</p>
<ul>
<li>
<p><strong>My main project</strong> - Inline Assembly in rust: I programmed the parser, set up the code infrastructure for TREE IR generation in the backend, along with AST, HIR lowering and typechecking.</p>
</li>
<li>
<p><strong>CI/CD</strong>: I helped maintain and improve the CI/CD pipeline. This includes resolving dependency issues in GitHub Actions, adding support for 32 bit CI and glibc compliance CI.
I also created a docker-compose dev environment for MacOS-based contributors, with all libraries and dependency installed; this helps us bypass MacOS's annoying build and link issues.</p>
</li>
<li>
<p><strong>Code maintainance/Bug Fixes/Code Review</strong>: I maintained the code base via issues filed by my mentor and other contributors. I also helped fix some minor bugs in IR lowering and typechecking. I also help review some new, simple PRs for contributors.</p>
</li>
</ul>
<h2 id="issues-and-prs"><a aria-hidden="true" tabindex="-1" href="#issues-and-prs"><span class="icon icon-link"></span></a>Issues and PRs</h2>
<p>Below is all the issues, PRs and commits I've made to the <a href="https://github.com/Rust-GCC/gccrs" rel="nofollow" target="_blank">gccrs</a> repository, up to Aug 22 2024, after producing this I ended up closing some resolved issues that has been silently addressed in some PRs.</p>
<p>The tables are produced via <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>gh</span></span><button type="button" title="Copy code" aria-label="Copy code" data="gh" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> cli tool and some <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>I use nvim btw</span></span><button type="button" title="Copy code" aria-label="Copy code" data="I use nvim btw" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> love :)</p>
<h3 id="issues"><a aria-hidden="true" tabindex="-1" href="#issues"><span class="icon icon-link"></span></a>Issues</h3>
<p>Here's a formatted version of all my issues, up to Aug 22 2024, procured via <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>gh issue list -A badumbatish --state all</span></span><button type="button" title="Copy code" aria-label="Copy code" data="gh issue list -A badumbatish --state all" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span>:</p>
































































































<table><thead><tr><th>Issue Number</th><th>Issue Status</th><th>Issue Title</th><th>Labels</th><th>Filed Date</th></tr></thead><tbody><tr><td><a href="https://github.com/Rust-GCC/gccrs/issues/3102" rel="nofollow" target="_blank">3102</a></td><td><strong>OPEN</strong></td><td>Set up the rest of HIR pipeline in InlineAsm</td><td></td><td>2024-07-27T03:20:50Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/issues/3099" rel="nofollow" target="_blank">3099</a></td><td><strong>OPEN</strong></td><td>parse_expr not stopping on =></td><td></td><td>2024-07-25T19:41:07Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/issues/3072" rel="nofollow" target="_blank">3072</a></td><td><strong>OPEN</strong></td><td>asm parser lacking <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>label</span></span><button type="button" title="Copy code" aria-label="Copy code" data="label" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> parse functionality</td><td></td><td>2024-07-01T08:54:12Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/issues/3069" rel="nofollow" target="_blank">3069</a></td><td><strong>OPEN</strong></td><td>Make asm parser stores parse result</td><td></td><td>2024-06-25T16:12:44Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/issues/3062" rel="nofollow" target="_blank">3062</a></td><td><strong>CLOSED</strong></td><td>Add ExprType::InlineAsm variant to ExprType enum</td><td></td><td>2024-06-24T13:23:55Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/issues/3061" rel="nofollow" target="_blank">3061</a></td><td><strong>OPEN</strong></td><td>Typechecking of asm! failed in <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>let _</span></span><button type="button" title="Copy code" aria-label="Copy code" data="let _" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span></td><td>bug</td><td>2024-06-24T13:24:07Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/issues/3057" rel="nofollow" target="_blank">3057</a></td><td><strong>OPEN</strong></td><td>asm! macro failed to exhaustively parse all of options(), clobber_abis(), and register operands</td><td>bug, expansion</td><td>2024-06-18T13:32:24Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/issues/3052" rel="nofollow" target="_blank">3052</a></td><td><strong>OPEN</strong></td><td>Fully incorporate tl::expected into InlineAsm parsing</td><td></td><td>2024-06-14T09:54:17Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/issues/3051" rel="nofollow" target="_blank">3051</a></td><td><strong>CLOSED</strong></td><td>Remove unnecessary #include from rust-expr.h</td><td>good-first-pr, cleanup</td><td>2024-07-11T09:23:53Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/issues/3050" rel="nofollow" target="_blank">3050</a></td><td><strong>CLOSED</strong></td><td>Safe guard InlineAsm-related structs</td><td></td><td>2024-07-03T09:58:52Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/issues/3048" rel="nofollow" target="_blank">3048</a></td><td><strong>OPEN</strong></td><td>Handle outer attributes properly for inline assembly</td><td></td><td>2024-06-14T09:55:37Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/issues/2937" rel="nofollow" target="_blank">2937</a></td><td><strong>CLOSED</strong></td><td>Docker image and container for Mac</td><td></td><td>2024-05-10T14:53:25Z</td></tr></tbody></table>
<p>The closed/filed rate is 4/8, which is not high. Through out writing the parser and the backend infra, I realized that there are these little issues that's just easier to just fix and not necessary filed. There is also issues that are discussed via <a href="https://gist.github.com/badumbatish/9823719ef359a58b131220d9d79d2aec" rel="nofollow" target="_blank">hackmd notes</a> between me and my mentor that are not necessarily filed via GitHub.</p>
<h3 id="prs"><a aria-hidden="true" tabindex="-1" href="#prs"><span class="icon icon-link"></span></a>PRs</h3>
<p>Here's a formatted version of all my pull requests, up to Aug 22 2024, procured via <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>gh pr list -A badumbatish --state all</span></span><button type="button" title="Copy code" aria-label="Copy code" data="gh pr list -A badumbatish --state all" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span>:</p>



























































































































































<table><thead><tr><th>PR Number</th><th>PR Status</th><th>PR Title</th><th>Filed Date</th></tr></thead><tbody><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/3133" rel="nofollow" target="_blank">3133</a></td><td><strong>MERGED</strong></td><td>Fix the disorder struct and class in inline asm</td><td>2024-08-20T07:41:34Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/3119" rel="nofollow" target="_blank">3119</a></td><td><strong>OPEN</strong></td><td>Add running cicd 32bit</td><td>2024-08-04T19:47:37Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/3109" rel="nofollow" target="_blank">3109</a></td><td><strong>MERGED</strong></td><td>Inline asm resolve expr</td><td>2024-07-31T03:41:32Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/3103" rel="nofollow" target="_blank">3103</a></td><td><strong>MERGED</strong></td><td>Inline asm hir pipeline</td><td>2024-07-27T08:22:57Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/3098" rel="nofollow" target="_blank">3098</a></td><td><strong>MERGED</strong></td><td>Fix the parser's operand and flags storage</td><td>2024-07-25T16:38:11Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/3093" rel="nofollow" target="_blank">3093</a></td><td><strong>MERGED</strong></td><td>Change assertion of asm operand constructor</td><td>2024-07-21T22:46:28Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/3090" rel="nofollow" target="_blank">3090</a></td><td><strong>MERGED</strong></td><td>Added options for ParseMode</td><td>2024-07-20T07:48:51Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/3081" rel="nofollow" target="_blank">3081</a></td><td><strong>MERGED</strong></td><td>Pin node16 by allowing old version</td><td>2024-07-10T02:32:08Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/3074" rel="nofollow" target="_blank">3074</a></td><td><strong>MERGED</strong></td><td>Safe-guard InlineAsm structs</td><td>2024-07-01T00:43:59Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/3073" rel="nofollow" target="_blank">3073</a></td><td><strong>MERGED</strong></td><td>Store parse result of parse_format_string(s)</td><td>2024-07-01T00:24:42Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/3063" rel="nofollow" target="_blank">3063</a></td><td><strong>MERGED</strong></td><td>Added ExprType::InlineAsm</td><td>2024-06-23T18:06:02Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/3060" rel="nofollow" target="_blank">3060</a></td><td><strong>DRAFT</strong></td><td>Asm generic il codegen</td><td>2024-06-23T14:11:44Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/3059" rel="nofollow" target="_blank">3059</a></td><td><strong>MERGED</strong></td><td>Add test case for using asm! outside of unsafe </td><td>2024-06-22T06:40:27Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/3053" rel="nofollow" target="_blank">3053</a></td><td><strong>MERGED</strong></td><td>incorporate tl::expected into InlineAsm parsing</td><td>2024-06-14T06:08:01Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/3011" rel="nofollow" target="_blank">3011</a></td><td><strong>MERGED</strong></td><td>Remove cstddef header from rust-fmt</td><td>2024-05-19T03:03:05Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/3002" rel="nofollow" target="_blank">3002</a></td><td><strong>MERGED</strong></td><td>Make gccrs recognize negative_impls</td><td>2024-05-15T22:06:45Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/2982" rel="nofollow" target="_blank">2982</a></td><td><strong>MERGED</strong></td><td>Inline asm</td><td>2024-05-08T19:41:27Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/2981" rel="nofollow" target="_blank">2981</a></td><td><strong>OPEN</strong></td><td>Cleanup macro invoc</td><td>2024-05-08T17:47:46Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/2980" rel="nofollow" target="_blank">2980</a></td><td><strong>MERGED</strong></td><td>Fix all tests in execute to be \r\n</td><td>2024-05-08T06:47:12Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/2941" rel="nofollow" target="_blank">2941</a></td><td><strong>MERGED</strong></td><td>Add an alternative solution on MacOS</td><td>2024-04-05T03:10:57Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/2911" rel="nofollow" target="_blank">2911</a></td><td><strong>MERGED</strong></td><td>Store visibility properly in ExternalTypeItem: Fixes #2897</td><td>2024-03-09T22:46:59Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/2895" rel="nofollow" target="_blank">2895</a></td><td><strong>MERGED</strong></td><td>Add error emitting when we can't resolve id expr</td><td>2024-03-01T10:40:34Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/2874" rel="nofollow" target="_blank">2874</a></td><td><strong>MERGED</strong></td><td>First stab at issue 2855 by splitting the two maps</td><td>2024-02-25T21:13:02Z</td></tr><tr><td><a href="https://github.com/Rust-GCC/gccrs/pull/2871" rel="nofollow" target="_blank">2871</a></td><td><strong>MERGED</strong></td><td>Fix FixMe in changing return type of builtin_macro_from_string() from BuiltinMacro to tl::optional/<div></div></td><td>2024-02-23T21:22:58Z</td></tr></tbody></table>
<p>The merged/filed rate is 22/25. Half of the PRs are easy to fix / fixable within a short amount of time (Code maintanence aspect). The other half is medium in difficulty, related to my summer project (Project aspect).</p>
<h1 id="gccrs-inline-assembly"><a aria-hidden="true" tabindex="-1" href="#gccrs-inline-assembly"><span class="icon icon-link"></span></a>GCCRS Inline Assembly</h1>
<p>Alright, let's try to understand what I did this summer in greater detail.</p>
<p>This write up will try to avoid lower level, implementation-based details but will let you walk away knowing what I, <a href="https://badumbatish.github.io/" rel="nofollow" target="_blank">badumbatish</a> did this summer :)</p>
<p>Although I won't post much code, I'll still provide links to my PRs for interested readers. Inspirations  includes contributors from the rust codebase and gccrs codebase. More specifically, <a href="https://github.com/rust-lang/rust/blob/master/compiler/rustc_builtin_macros/src/asm.rs" rel="nofollow" target="_blank">asm.rs</a> from rustc, Arthur, Pierre-Emmanuel and Mahad from gccrs.</p>
<h2 id="purpose"><a aria-hidden="true" tabindex="-1" href="#purpose"><span class="icon icon-link"></span></a>Purpose</h2>
<p>Assembly are often used by programmers as a precise instrument in case that compiler's high level constructs are too coarse for the programmers' intent. With the advent of inline  assembly, you can do this without having to create a seperate assembly file, maintaining the stackframe, register invariants, juggling different platforms and different calling conventions by yourself, etc...</p>
<p>The purpose of my project is to provide support for inline assembly in gccrs. With respect to Rust's memory safety guarantees as well as the context of assembly languages usages in today's modern era, the project aims to alleviate the complexity from the programmmers while providing precautions and safeguards with unsafe blocks requirements and higher level constructs such as register operands, compared to raw hardware registers.</p>
<h2 id="syntax"><a aria-hidden="true" tabindex="-1" href="#syntax"><span class="icon icon-link"></span></a>Syntax</h2>
<p>In this section we'll take a look at the syntax of inline assembly, as well as dissecting some examples.</p>
<h3 id="grammar"><a aria-hidden="true" tabindex="-1" href="#grammar"><span class="icon icon-link"></span></a>Grammar</h3>
<p>The syntax for inline assembly is quite simple. This is taken from the <a href="https://doc.rust-lang.org/reference/inline-assembly.html" rel="nofollow" target="_blank">Rust Reference website</a> :</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="plaintext" data-theme="github-dark-dimmed"><code data-language="plaintext" data-theme="github-dark-dimmed" style="display: grid;"><span data-line=""><span>format_string := STRING_LITERAL / RAW_STRING_LITERAL</span></span>
<span data-line=""><span>dir_spec := "in" / "out" / "lateout" / "inout" / "inlateout"</span></span>
<span data-line=""><span>reg_spec := &#x3C;register class> / "\"" &#x3C;explicit register> "\""</span></span>
<span data-line=""><span>operand_expr := expr / "_" / expr "=>" expr / expr "=>" "_"</span></span>
<span data-line=""><span>reg_operand := [ident "="] dir_spec "(" reg_spec ")" operand_expr</span></span>
<span data-line=""><span>clobber_abi := "clobber_abi(" &#x3C;abi> *("," &#x3C;abi>) [","] ")"</span></span>
<span data-line=""><span>option := "pure" / "nomem" / "readonly" / "preserves_flags" / "noreturn" / "nostack" / "att_syntax" / "raw"</span></span>
<span data-line=""><span>options := "options(" option *("," option) [","] ")"</span></span>
<span data-line=""><span>operand := reg_operand / clobber_abi / options</span></span>
<span data-line=""><span>asm := "asm!(" format_string *("," format_string) *("," operand) [","] ")"</span></span>
<span data-line=""><span>global_asm := "global_asm!(" format_string *("," format_string) *("," operand) [","] ")"</span></span><button type="button" title="Copy code" aria-label="Copy code" data="format_string := STRING_LITERAL / RAW_STRING_LITERAL
dir_spec := &#x22;in&#x22; / &#x22;out&#x22; / &#x22;lateout&#x22; / &#x22;inout&#x22; / &#x22;inlateout&#x22;
reg_spec := <register class> / &#x22;\&#x22;&#x22; <explicit register> &#x22;\&#x22;&#x22;
operand_expr := expr / &#x22;_&#x22; / expr &#x22;=>&#x22; expr / expr &#x22;=>&#x22; &#x22;_&#x22;
reg_operand := [ident &#x22;=&#x22;] dir_spec &#x22;(&#x22; reg_spec &#x22;)&#x22; operand_expr
clobber_abi := &#x22;clobber_abi(&#x22; <abi> *(&#x22;,&#x22; <abi>) [&#x22;,&#x22;] &#x22;)&#x22;
option := &#x22;pure&#x22; / &#x22;nomem&#x22; / &#x22;readonly&#x22; / &#x22;preserves_flags&#x22; / &#x22;noreturn&#x22; / &#x22;nostack&#x22; / &#x22;att_syntax&#x22; / &#x22;raw&#x22;
options := &#x22;options(&#x22; option *(&#x22;,&#x22; option) [&#x22;,&#x22;] &#x22;)&#x22;
operand := reg_operand / clobber_abi / options
asm := &#x22;asm!(&#x22; format_string *(&#x22;,&#x22; format_string) *(&#x22;,&#x22; operand) [&#x22;,&#x22;] &#x22;)&#x22;
global_asm := &#x22;global_asm!(&#x22; format_string *(&#x22;,&#x22; format_string) *(&#x22;,&#x22; operand) [&#x22;,&#x22;] &#x22;)&#x22;" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></pre></figure>
<p>The topmost level, or the start of the parse rule is either <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>asm</span></span><button type="button" title="Copy code" aria-label="Copy code" data="asm" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> or <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>global_asm</span></span><button type="button" title="Copy code" aria-label="Copy code" data="global_asm" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span>.</p>
<p>The inline assembly code is represented by <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>format_string</span></span><button type="button" title="Copy code" aria-label="Copy code" data="format_string" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span>. The other aspect is <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>operand</span></span><button type="button" title="Copy code" aria-label="Copy code" data="operand" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span>, which includes <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>reg_operand</span></span><button type="button" title="Copy code" aria-label="Copy code" data="reg_operand" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span>, <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>clobber_abi</span></span><button type="button" title="Copy code" aria-label="Copy code" data="clobber_abi" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span>, and <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>options</span></span><button type="button" title="Copy code" aria-label="Copy code" data="options" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span>.</p>
<p>More information about different types of operand can be referred to from <a href="https://doc.rust-lang.org/reference/inline-assembly.html" rel="nofollow" target="_blank">the reference</a>.</p>
<p>Keep in mind that the way we see this division of the grammar is how we'll construct our AST subsequently, our parser.</p>
<h3 id="syntax-example"><a aria-hidden="true" tabindex="-1" href="#syntax-example"><span class="icon icon-link"></span></a>Syntax example</h3>
<p>Let's look at some inline assembly examples pulled from the <a href="https://doc.rust-lang.org/rust-by-example/unsafe/asm.html" rel="nofollow" target="_blank">Rust by example website</a>.</p>
<ul>
<li>This is the simplest form, only including a no-op instruction</li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="rust" data-theme="github-dark-dimmed"><code data-language="rust" data-theme="github-dark-dimmed" style="display: grid;"><span data-line=""><span style="color:#F47067">use</span><span style="color:#F69D50"> std</span><span style="color:#F47067">::</span><span style="color:#F69D50">arch</span><span style="color:#F47067">::</span><span style="color:#ADBAC7">asm;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#F47067">unsafe</span><span style="color:#ADBAC7"> </span><span style="color:#6cb6ff">{</span></span>
<span data-line=""><span style="color:#DCBDFB">    asm!</span><span style="color:#6bc46d">(</span><span style="color:#96D0FF">"nop"</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#6cb6ff">}</span></span><button type="button" title="Copy code" aria-label="Copy code" data="use std::arch::asm;

unsafe {
    asm!(&#x22;nop&#x22;);
}" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></pre></figure>
<ul>
<li>Of course, more complex (non-simple) form of inline assembly requires some extra functionality:</li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="rust" data-theme="github-dark-dimmed"><code data-language="rust" data-theme="github-dark-dimmed" style="display: grid;"><span data-line=""><span style="color:#F47067">use</span><span style="color:#F69D50"> std</span><span style="color:#F47067">::</span><span style="color:#F69D50">arch</span><span style="color:#F47067">::</span><span style="color:#ADBAC7">asm;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#F47067">let</span><span style="color:#ADBAC7"> x</span><span style="color:#F47067">:</span><span style="color:#F69D50"> u64</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#F47067">unsafe</span><span style="color:#ADBAC7"> </span><span style="color:#6cb6ff">{</span></span>
<span data-line=""><span style="color:#DCBDFB">    asm!</span><span style="color:#6bc46d">(</span><span style="color:#96D0FF">"mov {}, 5"</span><span style="color:#ADBAC7">, </span><span style="color:#DCBDFB">out</span><span style="color:#daaa3f">(</span><span style="color:#ADBAC7">reg</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7"> x</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#6cb6ff">}</span></span>
<span data-line=""><span style="color:#DCBDFB">assert_eq!</span><span style="color:#6cb6ff">(</span><span style="color:#ADBAC7">x, </span><span style="color:#6CB6FF">5</span><span style="color:#6cb6ff">)</span><span style="color:#ADBAC7">;</span></span><button type="button" title="Copy code" aria-label="Copy code" data="use std::arch::asm;

let x: u64;
unsafe {
    asm!(&#x22;mov {}, 5&#x22;, out(reg) x);
}
assert_eq!(x, 5);" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></pre></figure>
<p>This requires the operand functionality, more specifically the reg_operand category. In simple terms, the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>{}</span></span><button type="button" title="Copy code" aria-label="Copy code" data="{}" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> in the format string (template string) (designated by the double quote symbol) refers to the variable x. The out(reg) asks the compiler to substitute the  by the register used to store x and to assume the inline assembly will only write to this register and not expect any particular initial value. On the ARM platform architecture, in the raw assembly, the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>{}</span></span><button type="button" title="Copy code" aria-label="Copy code" data="{}" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> in the formatted string would be replaced with a  register allocated to <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>x</span></span><button type="button" title="Copy code" aria-label="Copy code" data="x" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span>, such as the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>x0</span></span><button type="button" title="Copy code" aria-label="Copy code" data="x0" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> register.</p>
<p>An as a demonstrate, in the following code, <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>move {}, 5</span></span><button type="button" title="Copy code" aria-label="Copy code" data="move {}, 5" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> is transformed into <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>mov x0, 5</span></span><button type="button" title="Copy code" aria-label="Copy code" data="mov x0, 5" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span></p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="asm" data-theme="github-dark-dimmed"><code data-language="asm" data-theme="github-dark-dimmed" style="display: grid;"><span data-line=""><span style="color:#ADBAC7">    .cfi_def_cfa_offset </span><span style="color:#6CB6FF">32</span></span>
<span data-line=""><span style="color:#ADBAC7">    .cfi_offset </span><span style="color:#6CB6FF">29</span><span style="color:#ADBAC7">, -</span><span style="color:#6CB6FF">32</span></span>
<span data-line=""><span style="color:#ADBAC7">    .cfi_offset </span><span style="color:#6CB6FF">30</span><span style="color:#ADBAC7">, -</span><span style="color:#6CB6FF">24</span></span>
<span data-line=""><span style="color:#ADBAC7">    ...</span></span>
<span data-line=""><span style="color:#ADBAC7">#APP</span></span>
<span data-line=""><span style="color:#ADBAC7">// </span><span style="color:#6CB6FF">6</span><span style="color:#ADBAC7"> "asm_mov.rs" </span><span style="color:#6CB6FF">1</span></span>
<span data-line=""><span style="color:#F47067">    mov</span><span style="color:#ADBAC7"> x0, </span><span style="color:#6CB6FF">5</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#ADBAC7">// </span><span style="color:#6CB6FF">0</span><span style="color:#ADBAC7"> "" </span><span style="color:#6CB6FF">2</span></span>
<span data-line=""><span style="color:#ADBAC7">#NO_APP</span></span>
<span data-line=""><span style="color:#ADBAC7">    ...</span></span><button type="button" title="Copy code" aria-label="Copy code" data="    .cfi_def_cfa_offset 32
    .cfi_offset 29, -32
    .cfi_offset 30, -24
    ...
#APP
// 6 &#x22;asm_mov.rs&#x22; 1
    mov x0, 5

// 0 &#x22;&#x22; 2
#NO_APP
    ..." class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></pre></figure>
<h2 id="overall-architecture"><a aria-hidden="true" tabindex="-1" href="#overall-architecture"><span class="icon icon-link"></span></a>Overall architecture</h2>
<p>In this section we provide common compiler norms, discuss the overall architecture of the project as well as some of the most relevant files to the project.</p>
<p>The end of this section provides a high level graph for readers to visualize the architecture.</p>
<h3 id="definition"><a aria-hidden="true" tabindex="-1" href="#definition"><span class="icon icon-link"></span></a>Definition</h3>
<p>Before giving an overview of the architecture of the project, it's necessary to give context to common compiler norms:</p>
<ul>
<li>Type checking: The process of ensuring that variables and expressions have types that align with the expected types (explicitly or implicitly) defined in the code, preventing type errors.</li>
<li>Name resolution: The process of matching names (such as variables, functions, and types) in the code with their corresponding declarations to ensure correct scoping and accessibility.</li>
<li>Unsafe gating: The mechanism that restricts certain operations (e.g., raw pointer casting, inline assembly) to unsafe blocks, indicating that the programmer takes responsibility for upholding safety guarantees.</li>
<li>AST: Stands for Abstract syntax tree and is used to represent a program or a code snippet. Usually in a compiler, this data structure is the product of a parser. The compiler can then lower this data structure into a different data structure called HIR, which will be defined in the next sentence.</li>
<li>HIR: High Level Intermediate Representation. After AST, the compiler lowers the AST into a different representation. In gccrs, this is where different validations such as type checking, name resolution and unsafe gating happens. The compiler then lower this IR into what's known as GENERIC IL</li>
<li>TREE (GENERIC IL): GENERIC Intermediate Language. gcc's language-independent way of representing different constructs in trees.</li>
<li>GIMPLE: (From gcc:) is a three-address representation derived from GENERIC by breaking down GENERIC expressions into tuples of no more than 3 operands (with some exceptions like function calls).</li>
<li>GCC Backend: where gcc starts to generate archiecture-dependent code.</li>
</ul>
<h3 id="architecture"><a aria-hidden="true" tabindex="-1" href="#architecture"><span class="icon icon-link"></span></a>Architecture</h3>
<p>I haven't talked about how we should handle this. Obviously the plan is to have the compiler recognize the syntax so a parser is required, but what happens after that?</p>
<p>Well, like our cousin (or sibling?) rustc, the gccrs compiler itself has the AST, and then HIR. After that, gccrs converts its HIR into gcc's TREE (GENERIC IL) format. At this stage, gcc handles the conversion from inline assembly tree to gimple and then eventually raw architecture-dependent assembly code via gcc's backend.</p>
<p>We need to also set up other stuff such as inline assembly validation, type checking, name resolution, etc etc. This will be mention in passing as it is relevant to Rust's safety feature.</p>
<h3 id="related-files"><a aria-hidden="true" tabindex="-1" href="#related-files"><span class="icon icon-link"></span></a>Related files</h3>
<p>The related files for this issue includes</p>
<ul>
<li><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>gcc/rust/expand/rust-macrobuiltins-asm.h/cc</span></span><button type="button" title="Copy code" aria-label="Copy code" data="gcc/rust/expand/rust-macrobuiltins-asm.h/cc" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span>: Where the parsing of an <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>asm!()</span></span><button type="button" title="Copy code" aria-label="Copy code" data="asm!()" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> happens.</li>
<li><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>gcc/rust/ast/rust-expr.h</span></span><button type="button" title="Copy code" aria-label="Copy code" data="gcc/rust/ast/rust-expr.h" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span>: Where the ast of an inline asm is defined.</li>
<li><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>gcc/rust/hir/tree/rust-hir-expr.h</span></span><button type="button" title="Copy code" aria-label="Copy code" data="gcc/rust/hir/tree/rust-hir-expr.h" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span>: Where the HIR (high level ir) of an inline asm is defined.</li>
<li><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>gcc/rust/backend/rust-compile-asm.h/cc</span></span><button type="button" title="Copy code" aria-label="Copy code" data="gcc/rust/backend/rust-compile-asm.h/cc" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span>: where the backend of inline asm starts processing.</li>
</ul>
<h3 id="architecture-visualization"><a aria-hidden="true" tabindex="-1" href="#architecture-visualization"><span class="icon icon-link"></span></a>Architecture visualization</h3>
<p>The picture below depicts the project's pipeline.
<img src="/blogs/mermaid_gsoc_arch1.svg" alt="mermaid_gsoc_arch"></p>
<h2 id="ast"><a aria-hidden="true" tabindex="-1" href="#ast"><span class="icon icon-link"></span></a>AST</h2>
<p>The AST follows the structure that the syntax provides.</p>
<p>At the end of PR <a href="https://github.com/Rust-GCC/gccrs/pull/3060" rel="nofollow" target="_blank">3060</a>, it takes its structure from <a href="https://github.com/rust-lang/rust/blob/master/compiler/rustc_builtin_macros/src/asm.rs" rel="nofollow" target="_blank">asm.rs</a>. It inherits from the ExprWithoutBlock, which inherits from Expr, indicating that an asm! call is an expr.</p>
<p>Here, I give the high level structure of the AST related to inline assembly. In the gccrs codebase, the AST are represented with classes and structs.</p>
<ul>
<li>InlineAsm: this class inherits from ExprWithoutBlock, and contains containers for templated strings, operands, named arguments, register arguments, clobber abi, and options.</li>
<li>TupleTemplateStr: stands for a templated string where we store a location as well as the internet string</li>
<li>InlineAsmOperand: represents an operand in inline assembly, which can be a register operand (class InlineAsmRegOrRegClass) or some non-register operands such as a Sym or a Label.</li>
</ul>
<p>By having a close mapping between the three things: Syntax, AST, and parsing, we lower our mental capacity in implementing them, maintaining a clear mental model if ever in need of debugging.</p>
<h2 id="parser"><a aria-hidden="true" tabindex="-1" href="#parser"><span class="icon icon-link"></span></a>Parser</h2>
<p>Nice, now let's talk about the parser :)</p>
<p>We'll be writing a simple recursive descent parser as described by our syntax section.</p>
<p>As referenced above in the syntax section, the parser consists of 4 levels, 0 to 3, maintaining a clear and simple mapping between the parser and the syntax:</p>
<ul>
<li>The first level (0), shows the entrance of the parser.</li>
<li>The second level (1) describes the main loop of the parser, where we repeatedly parse all the formatted strings first, then operands then perform AST validation.</li>
<li>The third and fourth level goes into the subcategory of each aspect of the second level and so on: parsing formatted strings means repeatedly parsing <em>a</em> formatted string and parsing options means repeatedly parsing <em>an</em> option, etc etc.</li>
</ul>
<p>The diagram below shows the totality of the parser architecture, where the two greenish block in level 0 represents the starting point and the ending point of the parser.
<img src="https://hackmd.io/_uploads/r1tIddrhR.svg" alt="Untitled diagram-2024-09-04-060350"></p>
<p>Interested readers can look into the master branch, in the file <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>gcc/rust/expand/rust-macro-builtins-asm.h/cc</span></span><button type="button" title="Copy code" aria-label="Copy code" data="gcc/rust/expand/rust-macro-builtins-asm.h/cc" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> for the implementation detail of the parser.</p>
<h2 id="ast-to-hir"><a aria-hidden="true" tabindex="-1" href="#ast-to-hir"><span class="icon icon-link"></span></a>AST to HIR</h2>
<p>After we have gotten our AST, the next step is lowering it into HIR.</p>
<p>Since the inline assembly ASTs doesn't undergo much change in structure from AST to HIR, the HIRs representation inherits almost everything from the ASTs structure.</p>
<p>Despite similarity in structure, the HIR lowering is a necessary step in the pipeline where we get to inherit all of gccrs' necessary name resolution, unsafe gating and type checking.</p>
<h3 id="hir-creation"><a aria-hidden="true" tabindex="-1" href="#hir-creation"><span class="icon icon-link"></span></a>HIR Creation</h3>
<p>There must be an automatic way to do this. After all, the call <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>asm!</span></span><button type="button" title="Copy code" aria-label="Copy code" data="asm!" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> will appear everywhere, maybe in a block, maybe in another AST; how do we make sure that we can reach it and lower it correctly?</p>
<p>The answer is the visitor pattern, here are <a href="https://en.wikipedia.org/wiki/Visitor_pattern" rel="nofollow" target="_blank">some</a> of <a href="https://refactoring.guru/design-patterns/visitor" rel="nofollow" target="_blank">the</a> references to <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" rel="nofollow" target="_blank">look into</a> if you're new to this pattern.</p>
<p>In short: The visitor pattern separate algorithms from the objects which they operate on.</p>
<p>In my opinion, this is where the visitor pattern shines the brightest: you only have to worry about your part. Let's get into the nitty gritty.</p>
<p>In the gccrs codebase, more specifically, the visitor class responsible for lowering AST to HIR is of the name <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>ASTLowering*</span></span><button type="button" title="Copy code" aria-label="Copy code" data="ASTLowering*" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span>.</p>
<p>The most general AST lowering class is <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>ASTLoweringBase</span></span><button type="button" title="Copy code" aria-label="Copy code" data="ASTLoweringBase" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> where all other AST lowering class inherits from to overload as needed.</p>
<p>Since our AST inherits from ExprWithoutBlock, which is a type of Expr, we implement our lowering from <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>ASTLoweringExpr</span></span><button type="button" title="Copy code" aria-label="Copy code" data="ASTLoweringExpr" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span>. The following code block highlights the fact that we need to lower all of AST::Expr in our AST::InlineAsm, primarily in our AST::InlineAsmOperand; I show the pattern for the first two lowering of AST::InlineAsmOperand, as well as the method to create the HIR::InlineAsm.</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="cpp" data-theme="github-dark-dimmed"><code data-language="cpp" data-theme="github-dark-dimmed" style="display: grid;"><span data-line=""><span style="color:#F69D50">HIR</span><span style="color:#ADBAC7">::InlineAsmOperand</span></span>
<span data-line=""><span style="color:#DCBDFB">translate_operand_in</span><span style="color:#ADBAC7"> </span><span style="color:#6cb6ff">(</span><span style="color:#F47067">const</span><span style="color:#F69D50"> AST</span><span style="color:#ADBAC7">::InlineAsmOperand </span><span style="color:#F47067">&#x26;</span><span style="color:#ADBAC7">operand</span><span style="color:#6cb6ff">)</span></span>
<span data-line=""><span style="color:#6cb6ff">{</span></span>
<span data-line=""><span style="color:#F47067">  auto</span><span style="color:#ADBAC7"> in_value </span><span style="color:#F47067">=</span><span style="color:#ADBAC7"> operand.</span><span style="color:#DCBDFB">get_in</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#F47067">  struct</span><span style="color:#F69D50"> HIR</span><span style="color:#ADBAC7">::</span><span style="color:#F69D50">InlineAsmOperand</span><span style="color:#ADBAC7">::</span><span style="color:#F69D50">In</span><span style="color:#ADBAC7"> in </span><span style="color:#6bc46d">(</span></span>
<span data-line=""><span style="color:#ADBAC7">    in_value.reg,</span></span>
<span data-line=""><span style="color:#ADBAC7">    std::</span><span style="color:#F69D50">unique_ptr</span><span style="color:#ADBAC7">&#x3C;</span><span style="color:#F69D50">Expr</span><span style="color:#ADBAC7">></span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#ADBAC7">ASTLoweringExpr::</span><span style="color:#F69D50">translate</span><span style="color:#ADBAC7"> </span><span style="color:#ff938a">(</span><span style="color:#ADBAC7">*in_value.expr.get </span><span style="color:#fc8dc7">(</span><span style="color:#fc8dc7">)</span><span style="color:#ff938a">)</span><span style="color:#daaa3f">)</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#F47067">  return</span><span style="color:#ADBAC7"> in;</span></span>
<span data-line=""><span style="color:#6cb6ff">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#F69D50">HIR</span><span style="color:#ADBAC7">::InlineAsmOperand</span></span>
<span data-line=""><span style="color:#DCBDFB">translate_operand_out</span><span style="color:#ADBAC7"> </span><span style="color:#6cb6ff">(</span><span style="color:#F47067">const</span><span style="color:#F69D50"> AST</span><span style="color:#ADBAC7">::InlineAsmOperand </span><span style="color:#F47067">&#x26;</span><span style="color:#ADBAC7">operand</span><span style="color:#6cb6ff">)</span></span>
<span data-line=""><span style="color:#6cb6ff">{</span></span>
<span data-line=""><span style="color:#F47067">  auto</span><span style="color:#ADBAC7"> out_value </span><span style="color:#F47067">=</span><span style="color:#ADBAC7"> operand.</span><span style="color:#DCBDFB">get_out</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#F47067">  struct</span><span style="color:#F69D50"> HIR</span><span style="color:#ADBAC7">::</span><span style="color:#F69D50">InlineAsmOperand</span><span style="color:#ADBAC7">::</span><span style="color:#F69D50">Out</span><span style="color:#ADBAC7"> out </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">out_value.reg, out_value.late,</span></span>
<span data-line=""><span style="color:#ADBAC7">					 std::</span><span style="color:#F69D50">unique_ptr</span><span style="color:#ADBAC7">&#x3C;</span><span style="color:#F69D50">Expr</span><span style="color:#ADBAC7">></span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span></span>
<span data-line=""><span style="color:#ADBAC7">					   ASTLoweringExpr::</span><span style="color:#F69D50">translate</span><span style="color:#ADBAC7"> </span><span style="color:#ff938a">(</span></span>
<span data-line=""><span style="color:#ADBAC7">					     *out_value.expr.get </span><span style="color:#fc8dc7">(</span><span style="color:#fc8dc7">)</span><span style="color:#ff938a">)</span><span style="color:#daaa3f">)</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#F47067">  return</span><span style="color:#ADBAC7"> out;</span></span>
<span data-line=""><span style="color:#6cb6ff">}</span></span>
<span data-line=""><span style="color:#768390">// [...]</span></span>
<span data-line=""><span style="color:#768390">// We omit translate_operand_inout, translate_operand_split_in_out,</span></span>
<span data-line=""><span style="color:#768390">// translate_operand_const, translate_operand_sym,</span></span>
<span data-line=""><span style="color:#768390">// translate_operand_label for clarity</span></span>
<span data-line=""><span style="color:#DCBDFB">from_operand</span><span style="color:#ADBAC7"> </span><span style="color:#6cb6ff">(</span><span style="color:#F47067">const</span><span style="color:#F69D50"> AST</span><span style="color:#ADBAC7">::InlineAsmOperand </span><span style="color:#F47067">&#x26;</span><span style="color:#ADBAC7">operand</span><span style="color:#6cb6ff">)</span></span>
<span data-line=""><span style="color:#6cb6ff">{</span></span>
<span data-line=""><span style="color:#F47067">  using</span><span style="color:#F69D50"> RegisterType</span><span style="color:#F47067"> =</span><span style="color:#F69D50"> AST</span><span style="color:#ADBAC7">::</span><span style="color:#F69D50">InlineAsmOperand</span><span style="color:#ADBAC7">::</span><span style="color:#F69D50">RegisterType</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#F47067">  auto</span><span style="color:#ADBAC7"> type </span><span style="color:#F47067">=</span><span style="color:#ADBAC7"> operand.</span><span style="color:#DCBDFB">get_register_type</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#F47067">  switch</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">type</span><span style="color:#6bc46d">)</span></span>
<span data-line=""><span style="color:#ADBAC7">    </span><span style="color:#6bc46d">{</span></span>
<span data-line=""><span style="color:#F47067">    case</span><span style="color:#F69D50"> RegisterType</span><span style="color:#ADBAC7">::In:</span></span>
<span data-line=""><span style="color:#F47067">      return</span><span style="color:#DCBDFB"> translate_operand_in</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#ADBAC7">operand</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#F47067">    case</span><span style="color:#F69D50"> RegisterType</span><span style="color:#ADBAC7">::Out:</span></span>
<span data-line=""><span style="color:#F47067">      return</span><span style="color:#DCBDFB"> translate_operand_out</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#ADBAC7">operand</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#F47067">    case</span><span style="color:#F69D50"> RegisterType</span><span style="color:#ADBAC7">::InOut:</span></span>
<span data-line=""><span style="color:#F47067">      return</span><span style="color:#DCBDFB"> translate_operand_inout</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#ADBAC7">operand</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#F47067">    case</span><span style="color:#F69D50"> RegisterType</span><span style="color:#ADBAC7">::SplitInOut:</span></span>
<span data-line=""><span style="color:#F47067">      return</span><span style="color:#DCBDFB"> translate_operand_split_in_out</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#ADBAC7">operand</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#F47067">    case</span><span style="color:#F69D50"> RegisterType</span><span style="color:#ADBAC7">::Const:</span></span>
<span data-line=""><span style="color:#F47067">      return</span><span style="color:#DCBDFB"> translate_operand_const</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#ADBAC7">operand</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#F47067">    case</span><span style="color:#F69D50"> RegisterType</span><span style="color:#ADBAC7">::Sym:</span></span>
<span data-line=""><span style="color:#F47067">      return</span><span style="color:#DCBDFB"> translate_operand_sym</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#ADBAC7">operand</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#F47067">    case</span><span style="color:#F69D50"> RegisterType</span><span style="color:#ADBAC7">::Label:</span></span>
<span data-line=""><span style="color:#F47067">      return</span><span style="color:#DCBDFB"> translate_operand_label</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#ADBAC7">operand</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#F47067">    default</span><span style="color:#ADBAC7">:</span></span>
<span data-line=""><span style="color:#DCBDFB">      rust_unreachable</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#ADBAC7">    </span><span style="color:#6bc46d">}</span></span>
<span data-line=""><span style="color:#6cb6ff">}</span></span>
<span data-line=""><span style="color:#F47067">void</span></span>
<span data-line=""><span style="color:#F69D50">ASTLoweringExpr</span><span style="color:#ADBAC7">::</span><span style="color:#DCBDFB">visit</span><span style="color:#ADBAC7"> </span><span style="color:#6cb6ff">(</span><span style="color:#F69D50">AST</span><span style="color:#ADBAC7">::InlineAsm </span><span style="color:#F47067">&#x26;</span><span style="color:#ADBAC7">expr</span><span style="color:#6cb6ff">)</span></span>
<span data-line=""><span style="color:#6cb6ff">{</span></span>
<span data-line=""><span style="color:#F47067">  auto</span><span style="color:#ADBAC7"> crate_num </span><span style="color:#F47067">=</span><span style="color:#ADBAC7"> mappings.</span><span style="color:#DCBDFB">get_current_crate</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#F69D50">  Analysis</span><span style="color:#ADBAC7">::NodeMapping </span><span style="color:#DCBDFB">mapping</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">crate_num, expr.</span><span style="color:#DCBDFB">get_node_id</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">,</span></span>
<span data-line=""><span style="color:#ADBAC7">				 mappings.</span><span style="color:#DCBDFB">get_next_hir_id</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#ADBAC7">crate_num</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">,</span></span>
<span data-line=""><span style="color:#ADBAC7">				 mappings.</span><span style="color:#DCBDFB">get_next_localdef_id</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#ADBAC7">crate_num</span><span style="color:#daaa3f">)</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#F69D50">  std</span><span style="color:#ADBAC7">::vector</span><span style="color:#F47067">&#x3C;</span><span style="color:#F69D50">HIR</span><span style="color:#ADBAC7">::InlineAsmOperand</span><span style="color:#F47067">></span><span style="color:#ADBAC7"> hir_operands;</span></span>
<span data-line=""><span style="color:#F47067">  const</span><span style="color:#F69D50"> std</span><span style="color:#ADBAC7">::vector</span><span style="color:#F47067">&#x3C;</span><span style="color:#F69D50">AST</span><span style="color:#ADBAC7">::InlineAsmOperand</span><span style="color:#F47067">></span><span style="color:#F47067"> &#x26;</span><span style="color:#ADBAC7">ast_operands </span><span style="color:#F47067">=</span><span style="color:#ADBAC7"> expr.</span><span style="color:#DCBDFB">get_operands</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#F47067">  for</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#F47067">auto</span><span style="color:#F47067"> &#x26;</span><span style="color:#ADBAC7">operand : ast_operands</span><span style="color:#6bc46d">)</span></span>
<span data-line=""><span style="color:#ADBAC7">      hir_operands.</span><span style="color:#DCBDFB">push_back</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#DCBDFB">from_operand</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#ADBAC7">operand</span><span style="color:#daaa3f">)</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""> </span>
<span data-line=""> </span>
<span data-line=""><span style="color:#ADBAC7">  translated</span></span>
<span data-line=""><span style="color:#F47067">    =</span><span style="color:#F47067"> new</span><span style="color:#F69D50"> HIR</span><span style="color:#ADBAC7">::</span><span style="color:#DCBDFB">InlineAsm</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">expr.</span><span style="color:#DCBDFB">get_locus</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">, expr.is_global_asm,</span></span>
<span data-line=""><span style="color:#ADBAC7">			  expr.</span><span style="color:#DCBDFB">get_template_</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">, expr.</span><span style="color:#DCBDFB">get_template_strs</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">,</span></span>
<span data-line=""><span style="color:#ADBAC7">			  hir_operands, expr.</span><span style="color:#DCBDFB">get_clobber_abi</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">,</span></span>
<span data-line=""><span style="color:#ADBAC7">			  expr.</span><span style="color:#DCBDFB">get_options</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">, mapping</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#6cb6ff">}</span></span>
<span data-line=""> </span>
<span data-line=""> </span><button type="button" title="Copy code" aria-label="Copy code" data="HIR::InlineAsmOperand
translate_operand_in (const AST::InlineAsmOperand &#x26;operand)
{
  auto in_value = operand.get_in ();

  struct HIR::InlineAsmOperand::In in (
    in_value.reg,
    std::unique_ptr<Expr> (ASTLoweringExpr::translate (*in_value.expr.get ())));
  return in;
}

HIR::InlineAsmOperand
translate_operand_out (const AST::InlineAsmOperand &#x26;operand)
{
  auto out_value = operand.get_out ();
  struct HIR::InlineAsmOperand::Out out (out_value.reg, out_value.late,
					 std::unique_ptr<Expr> (
					   ASTLoweringExpr::translate (
					     *out_value.expr.get ())));
  return out;
}
// [...]
// We omit translate_operand_inout, translate_operand_split_in_out,
// translate_operand_const, translate_operand_sym,
// translate_operand_label for clarity
from_operand (const AST::InlineAsmOperand &#x26;operand)
{
  using RegisterType = AST::InlineAsmOperand::RegisterType;
  auto type = operand.get_register_type ();

  switch (type)
    {
    case RegisterType::In:
      return translate_operand_in (operand);
    case RegisterType::Out:
      return translate_operand_out (operand);
    case RegisterType::InOut:
      return translate_operand_inout (operand);
    case RegisterType::SplitInOut:
      return translate_operand_split_in_out (operand);
    case RegisterType::Const:
      return translate_operand_const (operand);
    case RegisterType::Sym:
      return translate_operand_sym (operand);
    case RegisterType::Label:
      return translate_operand_label (operand);
    default:
      rust_unreachable ();
    }
}
void
ASTLoweringExpr::visit (AST::InlineAsm &#x26;expr)
{
  auto crate_num = mappings.get_current_crate ();
  Analysis::NodeMapping mapping (crate_num, expr.get_node_id (),
				 mappings.get_next_hir_id (crate_num),
				 mappings.get_next_localdef_id (crate_num));

  std::vector<HIR::InlineAsmOperand> hir_operands;
  const std::vector<AST::InlineAsmOperand> &#x26;ast_operands = expr.get_operands ();

  for (auto &#x26;operand : ast_operands)
      hir_operands.push_back (from_operand (operand));


  translated
    = new HIR::InlineAsm (expr.get_locus (), expr.is_global_asm,
			  expr.get_template_ (), expr.get_template_strs (),
			  hir_operands, expr.get_clobber_abi (),
			  expr.get_options (), mapping);
}

" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></pre></figure>
<h3 id="unsafe-gating"><a aria-hidden="true" tabindex="-1" href="#unsafe-gating"><span class="icon icon-link"></span></a>Unsafe gating</h3>
<p>Since <span data-rehype-pretty-code-figure=""><code data-language="rust" data-theme="github-dark-dimmed"><span data-line=""><span style="color:#DCBDFB">asm!</span></span><button type="button" title="Copy code" aria-label="Copy code" data="asm!" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> is platform dependent and is inherently unsafe, i.e "you would get a <a href="https://en.wikipedia.org/wiki/Segmentation_fault" rel="nofollow" target="_blank">segmentation fault</a> with no probable stacktrace whatsoever", rust requires asm! to be in an unsafe block.</p>
<p>In the gccrs codebase, this <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>unsafe gating</span></span><button type="button" title="Copy code" aria-label="Copy code" data="unsafe gating" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> is handled via <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>gcc/rust/checks/rust-unsafe-checker.h/cc</span></span><button type="button" title="Copy code" aria-label="Copy code" data="gcc/rust/checks/rust-unsafe-checker.h/cc" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span>, again, employing the <a href="https://stackoverflow.com/questions/6762256/how-does-double-dispatch-work-in-visitor-pattern" rel="nofollow" target="_blank">double dispatch</a> functionality of the visitor pattern.</p>
<p>In our implementation, the unsafe checker maintains a stack of contexts named <span data-rehype-pretty-code-figure=""><code data-language="cpp" data-theme="github-dark-dimmed"><span data-line=""><span style="color:#ADBAC7">unsafe_context</span></span><button type="button" title="Copy code" aria-label="Copy code" data="unsafe_context" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> with a convenient boolean function <span data-rehype-pretty-code-figure=""><code data-language="cpp" data-theme="github-dark-dimmed"><span data-line=""><span style="color:#DCBDFB">is_in_context</span><span style="color:#6cb6ff">(</span><span style="color:#6cb6ff">)</span></span><button type="button" title="Copy code" aria-label="Copy code" data="is_in_context()" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span>. At the time of our visit, we check if it is an unsafe context or not.</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="cpp" data-theme="github-dark-dimmed"><code data-language="cpp" data-theme="github-dark-dimmed" style="display: grid;"><span data-line=""><span style="color:#F47067">void</span></span>
<span data-line=""><span style="color:#F69D50">UnsafeChecker</span><span style="color:#ADBAC7">::</span><span style="color:#DCBDFB">visit</span><span style="color:#ADBAC7"> </span><span style="color:#6cb6ff">(</span><span style="color:#ADBAC7">InlineAsm </span><span style="color:#F47067">&#x26;</span><span style="color:#ADBAC7">expr</span><span style="color:#6cb6ff">)</span></span>
<span data-line=""><span style="color:#6cb6ff">{</span></span>
<span data-line=""><span style="color:#F47067">  if</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">unsafe_context.</span><span style="color:#DCBDFB">is_in_context</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#daaa3f">)</span><span style="color:#6bc46d">)</span></span>
<span data-line=""><span style="color:#F47067">    return</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#DCBDFB">  rust_error_at</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span></span>
<span data-line=""><span style="color:#ADBAC7">    expr.</span><span style="color:#DCBDFB">get_locus</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">, </span><span style="color:#F69D50">ErrorCode</span><span style="color:#ADBAC7">::E0133,</span></span>
<span data-line=""><span style="color:#96D0FF">    "use of inline assembly is unsafe and requires unsafe function or block"</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#6cb6ff">}</span></span><button type="button" title="Copy code" aria-label="Copy code" data="void
UnsafeChecker::visit (InlineAsm &#x26;expr)
{
  if (unsafe_context.is_in_context ())
    return;

  rust_error_at (
    expr.get_locus (), ErrorCode::E0133,
    &#x22;use of inline assembly is unsafe and requires unsafe function or block&#x22;);
}" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></pre></figure>
<blockquote>
<p>But Jas, why we wouldn't want the UnsafeChecker to just maintain a boolean <span data-rehype-pretty-code-figure=""><code data-language="cpp" data-theme="github-dark-dimmed"><span data-line=""><span style="color:#ADBAC7">is_unsafe</span></span><button type="button" title="Copy code" aria-label="Copy code" data="is_unsafe" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span>, and once UnsafeChecker visit an unsafe block, we set the boolean <span data-rehype-pretty-code-figure=""><code data-language="cpp" data-theme="github-dark-dimmed"><span data-line=""><span style="color:#ADBAC7">is_unsafe</span></span><button type="button" title="Copy code" aria-label="Copy code" data="is_unsafe" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> to true and consequently false after the UnsafeChecker finishes visiting?</p>
</blockquote>
<p>This won't work if we are traversing an AST where we have nested unsafe block, thus a <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>template &#x3C;typename T> class StackedContexts</span></span><button type="button" title="Copy code" aria-label="Copy code" data="template <typename T> class StackedContexts" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> is needed. Let's examine an example where a single boolean failed and why we would need to use a stack.</p>
<p>In this example, there is only 1 unsafe context; the boolean implementation satisfies the unsafe requirement.</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="diff" data-theme="github-dark-dimmed"><code data-language="diff" data-theme="github-dark-dimmed" style="display: grid;"><span data-line=""><span style="color:#ADBAC7">let a = 15;</span></span>
<span data-line=""><span style="color:#ADBAC7">unsafe </span><span style="color:#6cb6ff">{</span><span style="color:#ADBAC7"> // we set the boolean to true</span></span>
<span data-line=""><span style="color:#ADBAC7">      // Now unsafe operations are allowed!</span></span>
<span data-line=""><span style="color:#ADBAC7">      let b = *</span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">&#x26;a as *const i32</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#ADBAC7">      let c = std::mem::transmute</span><span style="color:#ADBAC7">&#x3C;</span><span style="color:#ADBAC7">i32, f32</span><span style="color:#ADBAC7">></span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">b</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#6cb6ff">}</span><span style="color:#ADBAC7"> // we set it to false</span></span>
<span data-line=""><span style="color:#ADBAC7">// Yay me!!!</span></span><button type="button" title="Copy code" aria-label="Copy code" data="let a = 15;
unsafe { // we set the boolean to true
      // Now unsafe operations are allowed!
      let b = *(&#x26;a as *const i32);
      let c = std::mem::transmute<i32, f32>(b);
} // we set it to false
// Yay me!!!" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></pre></figure>
<p>But in the following case, where we have nested unsafe context, the boolean fails to recognize that we are still "unsafe"; thus needing a stack.</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="diff" data-theme="github-dark-dimmed"><code data-language="diff" data-theme="github-dark-dimmed" style="display: grid;"><span data-line=""><span style="color:#8DDB8C">+unsafe </span><span style="color:#6cb6ff">{</span><span style="color:#8DDB8C"> // wraps the above unsafe context inside another unsafe context</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#ADBAC7">    let a = 15;</span></span>
<span data-line=""><span style="color:#ADBAC7">    unsafe </span><span style="color:#6bc46d">{</span><span style="color:#ADBAC7"> // we set the boolean to true</span></span>
<span data-line=""><span style="color:#ADBAC7">         let b = *</span><span style="color:#daaa3f">(</span><span style="color:#ADBAC7">&#x26;a as *const i32</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#ADBAC7">         let c = std::mem::transmute</span><span style="color:#ADBAC7">&#x3C;</span><span style="color:#ADBAC7">i32, f32</span><span style="color:#ADBAC7">></span><span style="color:#daaa3f">(</span><span style="color:#ADBAC7">b</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#ADBAC7">    </span><span style="color:#6bc46d">}</span><span style="color:#ADBAC7"> // we set it to false</span></span>
<span data-line=""><span style="color:#ADBAC7">    // Yay me!!!</span></span>
<span data-line=""><span style="color:#8DDB8C">+ </span><span style="color:#6cb6ff">}</span></span>
<span data-line=""><span style="color:#8DDB8C">+ // Now unsafe operations are forbidden again, but the boolean is false</span></span>
<span data-line=""><span style="color:#8DDB8C">+ let f = std::mem::transmute</span><span style="color:#8DDB8C">&#x3C;</span><span style="color:#8DDB8C">i32, f32</span><span style="color:#8DDB8C">></span><span style="color:#6cb6ff">(</span><span style="color:#8DDB8C">15</span><span style="color:#6cb6ff">)</span><span style="color:#8DDB8C">; // Uh-oh!</span></span><button type="button" title="Copy code" aria-label="Copy code" data="+unsafe { // wraps the above unsafe context inside another unsafe context

    let a = 15;
    unsafe { // we set the boolean to true
         let b = *(&#x26;a as *const i32);
         let c = std::mem::transmute<i32, f32>(b);
    } // we set it to false
    // Yay me!!!
+ }
+ // Now unsafe operations are forbidden again, but the boolean is false
+ let f = std::mem::transmute<i32, f32>(15); // Uh-oh!" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></pre></figure>
<p>Before every visit to an unsafe context, the unsafe checker inserts a context into the stack and after every visit, it pops that context out. A check to see if we are still unsafe checks if the stack is empty.
Readers interested in implementation details can check <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>gcc/rust/checks/errors/rust-unsafe-checker.h/cc</span></span><button type="button" title="Copy code" aria-label="Copy code" data="gcc/rust/checks/errors/rust-unsafe-checker.h/cc" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> and <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>gcc/rust/util/rust-stacked-contexts.h</span></span><button type="button" title="Copy code" aria-label="Copy code" data="gcc/rust/util/rust-stacked-contexts.h" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span></p>
<h3 id="type-checking"><a aria-hidden="true" tabindex="-1" href="#type-checking"><span class="icon icon-link"></span></a>Type checking</h3>
<p>From the rust compiler dev references:</p>
<blockquote>
<p>"The only ones that are of particular interest to rustc are NORETURN which makes asm! return ! instead of ()".</p>
</blockquote>
<p>We minimally represent this situation with the following implementation in <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>gcc/rust/typecheck/rust-hir-typecheck-expr.h/cc</span></span><button type="button" title="Copy code" aria-label="Copy code" data="gcc/rust/typecheck/rust-hir-typecheck-expr.h/cc" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span></p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="cpp" data-theme="github-dark-dimmed"><code data-language="cpp" data-theme="github-dark-dimmed" style="display: grid;"><span data-line=""><span style="color:#F47067">void</span></span>
<span data-line=""><span style="color:#F69D50">TypeCheckExpr</span><span style="color:#ADBAC7">::</span><span style="color:#DCBDFB">visit</span><span style="color:#ADBAC7"> </span><span style="color:#6cb6ff">(</span><span style="color:#F69D50">HIR</span><span style="color:#ADBAC7">::InlineAsm </span><span style="color:#F47067">&#x26;</span><span style="color:#ADBAC7">expr</span><span style="color:#6cb6ff">)</span></span>
<span data-line=""><span style="color:#6cb6ff">{</span></span>
<span data-line=""><span style="color:#768390">  // We recursively typechecks its operands.</span></span>
<span data-line=""><span style="color:#DCBDFB">  typecheck_inline_asm_operand</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">expr</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""> </span>
<span data-line=""> </span>
<span data-line=""><span style="color:#F47067">  if</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">expr.options.</span><span style="color:#DCBDFB">count</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#F69D50">AST</span><span style="color:#ADBAC7">::</span><span style="color:#F69D50">InlineAsmOption</span><span style="color:#ADBAC7">::NORETURN</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7"> </span><span style="color:#F47067">==</span><span style="color:#6CB6FF"> 1</span><span style="color:#6bc46d">)</span></span>
<span data-line=""><span style="color:#ADBAC7">    infered </span><span style="color:#F47067">=</span><span style="color:#F47067"> new</span><span style="color:#F69D50"> TyTy</span><span style="color:#ADBAC7">::</span><span style="color:#DCBDFB">NeverType</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">expr.</span><span style="color:#DCBDFB">get_mappings</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">.</span><span style="color:#DCBDFB">get_hirid</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#daaa3f">)</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#F47067">  else</span></span>
<span data-line=""><span style="color:#ADBAC7">    infered</span></span>
<span data-line=""><span style="color:#F47067">      =</span><span style="color:#F69D50"> TyTy</span><span style="color:#ADBAC7">::</span><span style="color:#F69D50">TupleType</span><span style="color:#ADBAC7">::</span><span style="color:#DCBDFB">get_unit_type</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">expr.</span><span style="color:#DCBDFB">get_mappings</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">.</span><span style="color:#DCBDFB">get_hirid</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#daaa3f">)</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#6cb6ff">}</span></span><button type="button" title="Copy code" aria-label="Copy code" data="void
TypeCheckExpr::visit (HIR::InlineAsm &#x26;expr)
{
  // We recursively typechecks its operands.
  typecheck_inline_asm_operand (expr);


  if (expr.options.count (AST::InlineAsmOption::NORETURN) == 1)
    infered = new TyTy::NeverType (expr.get_mappings ().get_hirid ());
  else
    infered
      = TyTy::TupleType::get_unit_type (expr.get_mappings ().get_hirid ());
}" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></pre></figure>
<p>I omit the part where we also recursive typecheck and infer each expr in each operand for the next part</p>
<h3 id="resolution"><a aria-hidden="true" tabindex="-1" href="#resolution"><span class="icon icon-link"></span></a>Resolution</h3>
<p>Given an example that is part of <a href="https://github.com/Rust-GCC/gccrs/pull/3060/files#diff-693188f770da1bcaab140cfa09a7df64b510f5b17f21d9dc7627fc401776086a" rel="nofollow" target="_blank">inline_asm_mov_x86_rs</a> test case, where we refers to _x as a potential output:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="rust" data-theme="github-dark-dimmed"><code data-language="rust" data-theme="github-dark-dimmed" style="display: grid;"><span data-line=""><span style="color:#F47067">let</span><span style="color:#F47067"> mut</span><span style="color:#ADBAC7"> _x</span><span style="color:#F47067">:</span><span style="color:#F69D50"> i32</span><span style="color:#F47067"> =</span><span style="color:#6CB6FF"> 0</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#F47067">unsafe</span><span style="color:#ADBAC7"> </span><span style="color:#6cb6ff">{</span></span>
<span data-line=""><span style="color:#DCBDFB">    asm!</span><span style="color:#6bc46d">(</span></span>
<span data-line=""><span style="color:#96D0FF">        "mov $5, {}"</span><span style="color:#ADBAC7">,</span></span>
<span data-line=""><span style="color:#DCBDFB">        out</span><span style="color:#daaa3f">(</span><span style="color:#ADBAC7">reg</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7"> _x</span></span>
<span data-line=""><span style="color:#ADBAC7">    </span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#6cb6ff">}</span></span><button type="button" title="Copy code" aria-label="Copy code" data="let mut _x: i32 = 0;
unsafe {
    asm!(
        &#x22;mov $5, {}&#x22;,
        out(reg) _x
    );
}" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></pre></figure>
<p>We need a way to somehow link the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>_x</span></span><button type="button" title="Copy code" aria-label="Copy code" data="_x" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> that we refers inside the asm!, inside the unsafe block to the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>_x</span></span><button type="button" title="Copy code" aria-label="Copy code" data="_x" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> outside of the unsafe block.</p>
<p>The part that handles this is called name resolution. The <a href="https://rustc-dev-guide.rust-lang.org/name-resolution.html#:~:text=The%20name%20resolution%20in%20Rust,other%20via%20the%20ResolverAstLoweringExt%20trait." rel="nofollow" target="_blank">Rust Compiler Dev Reference</a> goes into much details for this part.</p>
<p>Here I provide some implementation details for gccrs.</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="cpp" data-theme="github-dark-dimmed"><code data-language="cpp" data-theme="github-dark-dimmed" style="display: grid;"><span data-line=""><span style="color:#768390">// Perform type checking on expr. Also runs type unification algorithm.</span></span>
<span data-line=""><span style="color:#768390">// Returns the unified type of expr</span></span>
<span data-line=""><span style="color:#F69D50">TyTy</span><span style="color:#ADBAC7">::BaseType </span><span style="color:#F47067">*</span></span>
<span data-line=""><span style="color:#F69D50">TypeCheckExpr</span><span style="color:#ADBAC7">::</span><span style="color:#DCBDFB">Resolve</span><span style="color:#ADBAC7"> </span><span style="color:#6cb6ff">(</span><span style="color:#F69D50">HIR</span><span style="color:#ADBAC7">::Expr </span><span style="color:#F47067">*</span><span style="color:#ADBAC7">expr</span><span style="color:#6cb6ff">)</span></span>
<span data-line=""><span style="color:#6cb6ff">{</span></span>
<span data-line=""><span style="color:#ADBAC7">  TypeCheckExpr resolver;</span></span>
<span data-line=""><span style="color:#ADBAC7">  expr-</span><span style="color:#ADBAC7">></span><span style="color:#DCBDFB">accept_vis</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">resolver</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#F47067">  if</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">resolver.infered </span><span style="color:#F47067">==</span><span style="color:#6CB6FF"> nullptr</span><span style="color:#6bc46d">)</span></span>
<span data-line=""><span style="color:#F47067">    return</span><span style="color:#F47067"> new</span><span style="color:#F69D50"> TyTy</span><span style="color:#ADBAC7">::</span><span style="color:#DCBDFB">ErrorType</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">expr-</span><span style="color:#ADBAC7">></span><span style="color:#DCBDFB">get_mappings</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">.</span><span style="color:#DCBDFB">get_hirid</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#daaa3f">)</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#F47067">  auto</span><span style="color:#ADBAC7"> ref </span><span style="color:#F47067">=</span><span style="color:#ADBAC7"> expr-</span><span style="color:#ADBAC7">></span><span style="color:#DCBDFB">get_mappings</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">.</span><span style="color:#DCBDFB">get_hirid</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#ADBAC7">  resolver.infered-</span><span style="color:#ADBAC7">></span><span style="color:#DCBDFB">set_ref</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">ref</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#ADBAC7">  resolver.context-</span><span style="color:#ADBAC7">></span><span style="color:#DCBDFB">insert_type</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">expr-</span><span style="color:#ADBAC7">></span><span style="color:#DCBDFB">get_mappings</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">, resolver.infered</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#F47067">  return</span><span style="color:#ADBAC7"> resolver.infered;</span></span>
<span data-line=""><span style="color:#6cb6ff">}</span></span><button type="button" title="Copy code" aria-label="Copy code" data="// Perform type checking on expr. Also runs type unification algorithm.
// Returns the unified type of expr
TyTy::BaseType *
TypeCheckExpr::Resolve (HIR::Expr *expr)
{
  TypeCheckExpr resolver;
  expr->accept_vis (resolver);

  if (resolver.infered == nullptr)
    return new TyTy::ErrorType (expr->get_mappings ().get_hirid ());

  auto ref = expr->get_mappings ().get_hirid ();
  resolver.infered->set_ref (ref);
  resolver.context->insert_type (expr->get_mappings (), resolver.infered);

  return resolver.infered;
}" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></pre></figure>
<h2 id="tree-generic"><a aria-hidden="true" tabindex="-1" href="#tree-generic"><span class="icon icon-link"></span></a>TREE (GENERIC)</h2>
<p>After we have finished setting up the AST and the HIR, we'll set up the TREE (GENERIC IR) infrastructure for our asm! node and after that, this IR will be lowered by gcc itself (GIMPLE IR), relieving us from duty.</p>
<p>The most central data structure used in the IR is <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>tree</span></span><button type="button" title="Copy code" aria-label="Copy code" data="tree" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span>, thus the name. From now, we'll refer to TREE IR as GENERIC IR.</p>
<p>The knowledge I learned about GENERIC is through this documentation <a href="https://gcc.gnu.org/onlinedocs/gccint/GENERIC.html" rel="nofollow" target="_blank">https://gcc.gnu.org/onlinedocs/gccint/GENERIC.html</a></p>
<h3 id="overall"><a aria-hidden="true" tabindex="-1" href="#overall"><span class="icon icon-link"></span></a>Overall</h3>
<p>Let's look at the definition and explore the tree code structures</p>
<p>From the GCC GENERIC:</p>
<blockquote>
<p>The purpose of GENERIC is simply to provide a language-independent way of representing an entire function in trees... If you can express it with the codes in gcc/tree.def, it’s GENERIC.</p>
</blockquote>
<p>Needless to say, we are to obtain a working knowledge of trees and tree codes :)</p>
<p>In the tree.def file, the tree codes are defined with the following structure:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="plaintext" data-theme="github-dark-dimmed"><code data-language="plaintext" data-theme="github-dark-dimmed" style="display: grid;"><span data-line=""><span>DEFTREECODE (name, string_name, class, operand_count)</span></span><button type="button" title="Copy code" aria-label="Copy code" data="DEFTREECODE (name, string_name, class, operand_count)" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></pre></figure>
<p>where:</p>
<ul>
<li>name: The symbolic name of the tree node.</li>
<li>string_name: The human-readable string representing the node.</li>
<li>class: A classification for the nodes to follow a specific structure/functionality.</li>
<li>operand_count: The number of fields it takes to make the tree of this type.</li>
</ul>
<p>Let's give an example of some of the tree codes we're sure to use:</p>

























<table><thead><tr><th>Tree code definition</th><th>definition location in tree.def</th><th>Usage in our backend</th></tr></thead><tbody><tr><td>DEFTREECOE(TREE_LIST, "tree_list", tcc_exceptional, 0)</td><td>Line 54</td><td>Construction of operands</td></tr><tr><td>DEFTREECODE(STRING_CST, "string_cst", tcc_constant, 0)</td><td>Line 310</td><td>Construction of templated assembly code</td></tr><tr><td>DEFTREECODE(ASM_EXPR, "asm_expr", tcc_statement, 5)</td><td>Line 1008</td><td>Construction of inline assembly node</td></tr></tbody></table>
<h3 id="anatomy"><a aria-hidden="true" tabindex="-1" href="#anatomy"><span class="icon icon-link"></span></a>Anatomy</h3>
<p>I'll give a detailed look of the ones that are needed for the project.</p>
<h4 id="tree_list"><a aria-hidden="true" tabindex="-1" href="#tree_list"><span class="icon icon-link"></span></a>TREE_LIST</h4>
<p>TREE_LIST is ... just a list of trees... It has a TREE_VALUE, TREE_PURPOSE and TREE_CHAIN.</p>
<p>For the first two values, TREE_VALUE holds the element while TREE_PURPOSE gives a directive to later stages on what to do with this TREE_VALUE. In our tree usage section, we'll see that a tree list of register operands contains a TREE_VALUE of variables and a TREE_PURPOSE of register type, denoting if it's input or output register operands.</p>
<p>The TREE_CHAIN node points to the next element in the tree list, which is also a TREE_LIST.</p>
<p>In <a href="https://github.com/Rust-GCC/gccrs/blob/master/gcc/tree.cc" rel="nofollow" target="_blank">gcc/tree.cc</a>, a way to construct a tree list is</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="cpp" data-theme="github-dark-dimmed"><code data-language="cpp" data-theme="github-dark-dimmed" style="display: grid;"><span data-line=""><span style="color:#768390">/* Return a newly created TREE_LIST node whose</span></span>
<span data-line=""><span style="color:#768390">   purpose and value fields are PARM and VALUE.  */</span></span>
<span data-line=""><span style="color:#ADBAC7">tree</span></span>
<span data-line=""><span style="color:#DCBDFB">build_tree_list</span><span style="color:#ADBAC7"> </span><span style="color:#6cb6ff">(</span><span style="color:#ADBAC7">tree parm, tree value MEM_STAT_DECL</span><span style="color:#6cb6ff">)</span></span>
<span data-line=""><span style="color:#6cb6ff">{</span></span>
<span data-line=""><span style="color:#ADBAC7">  tree t </span><span style="color:#F47067">=</span><span style="color:#DCBDFB"> make_node</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">TREE_LIST PASS_MEM_STAT</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#DCBDFB">  TREE_PURPOSE</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">t</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7"> </span><span style="color:#F47067">=</span><span style="color:#ADBAC7"> parm;</span></span>
<span data-line=""><span style="color:#DCBDFB">  TREE_VALUE</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">t</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7"> </span><span style="color:#F47067">=</span><span style="color:#ADBAC7"> value;</span></span>
<span data-line=""><span style="color:#F47067">  return</span><span style="color:#ADBAC7"> t;</span></span>
<span data-line=""><span style="color:#6cb6ff">}</span></span><button type="button" title="Copy code" aria-label="Copy code" data="/* Return a newly created TREE_LIST node whose
   purpose and value fields are PARM and VALUE.  */
tree
build_tree_list (tree parm, tree value MEM_STAT_DECL)
{
  tree t = make_node (TREE_LIST PASS_MEM_STAT);
  TREE_PURPOSE (t) = parm;
  TREE_VALUE (t) = value;
  return t;
}" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></pre></figure>
<p>A trend you'll see is that these underlying wrapper methods that construct our trees is that they'll start with a <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>tree t = make node(...)</span></span><button type="button" title="Copy code" aria-label="Copy code" data="tree t = make node(...)" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> or something that allocates memory for a tree, and then some  more <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>UPPER_CASE_SETTER_GETTER_METHOD(t) = ...</span></span><button type="button" title="Copy code" aria-label="Copy code" data="UPPER_CASE_SETTER_GETTER_METHOD(t) = ..." class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> that follows.</p>
<h4 id="string_cst"><a aria-hidden="true" tabindex="-1" href="#string_cst"><span class="icon icon-link"></span></a>STRING_CST</h4>
<p>The STRING_CST is a tree constant of string. We'll use this type of TREE in a lot of places. For example, TREE_PURPOSE in the above TREE_LIST often uses some form of STRING_CST as a directive for later stages. We can also use it as a way to encode our unprocessed/templated inline assembly code as STRING_CST.</p>
<p>Sometimes, our strings can also be represented not by a STRING_CST but by ARRAY of type CHAR, and this is also acceptable. An example of this is in <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>cc</span></span><button type="button" title="Copy code" aria-label="Copy code" data="cc" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> for the inline assembly code.</p>
<p>A call to construct STRING_CST: <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>build_string</span></span><button type="button" title="Copy code" aria-label="Copy code" data="build_string" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span>, takes two parameters: a length of cstr, including the NULL delimiter and the cstr itself.</p>
<h4 id="asm_expr"><a aria-hidden="true" tabindex="-1" href="#asm_expr"><span class="icon icon-link"></span></a>ASM_EXPR</h4>
<p>An ASM_EXPR has 5 parameters it needs passing.</p>
<ul>
<li>An ASM_STRING of treecode STRING_CST</li>
<li>An ASM_OUTPUTS of treecode TREE_LIST</li>
<li>An ASM_INPUTS of treecode TREE_LIST</li>
<li>An ASM_CLOBBERS</li>
<li>An ASM_LABELS</li>
</ul>
<p>I omit the last two treecodes simply because the project hasn't had the capacity to explore the clobber and label functionality.</p>
<h3 id="tree-usage"><a aria-hidden="true" tabindex="-1" href="#tree-usage"><span class="icon icon-link"></span></a>TREE USAGE</h3>
<p>In constructing the tree representation of our inline assembly, we combine the existing infrastructure as well as our knowledge of tree codes.</p>
<p>More specifically, we rely on existing tree generation of our variables and raw c strings. We build ourselves a list of input and output registers to make up the ASM_EXPR tree.</p>
<p>The process of building our ASM_EXPR is as follow:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="cpp" data-theme="github-dark-dimmed"><code data-language="cpp" data-theme="github-dark-dimmed" style="display: grid;"><span data-line=""><span style="color:#ADBAC7">tree</span></span>
<span data-line=""><span style="color:#F69D50">CompileAsm</span><span style="color:#ADBAC7">::</span><span style="color:#DCBDFB">tree_codegen_asm</span><span style="color:#ADBAC7"> </span><span style="color:#6cb6ff">(</span><span style="color:#F69D50">HIR</span><span style="color:#ADBAC7">::InlineAsm </span><span style="color:#F47067">&#x26;</span><span style="color:#ADBAC7">expr</span><span style="color:#6cb6ff">)</span></span>
<span data-line=""><span style="color:#6cb6ff">{</span></span>
<span data-line=""><span style="color:#F47067">  auto</span><span style="color:#ADBAC7"> asm_expr</span></span>
<span data-line=""><span style="color:#F47067">    =</span><span style="color:#DCBDFB"> asm_build_stmt</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">expr.</span><span style="color:#DCBDFB">get_locus</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">, </span><span style="color:#daaa3f">{</span><span style="color:#DCBDFB">asm_construct_string_tree</span><span style="color:#ADBAC7"> </span><span style="color:#ff938a">(</span><span style="color:#ADBAC7">expr</span><span style="color:#ff938a">)</span><span style="color:#ADBAC7">,</span></span>
<span data-line=""><span style="color:#DCBDFB">					  asm_construct_outputs</span><span style="color:#ADBAC7"> </span><span style="color:#ff938a">(</span><span style="color:#ADBAC7">expr</span><span style="color:#ff938a">)</span><span style="color:#ADBAC7">,</span></span>
<span data-line=""><span style="color:#DCBDFB">					  asm_construct_inputs</span><span style="color:#ADBAC7"> </span><span style="color:#ff938a">(</span><span style="color:#ADBAC7">expr</span><span style="color:#ff938a">)</span><span style="color:#ADBAC7">,</span></span>
<span data-line=""><span style="color:#DCBDFB">					  asm_construct_clobber_tree</span><span style="color:#ADBAC7"> </span><span style="color:#ff938a">(</span><span style="color:#ADBAC7">expr</span><span style="color:#ff938a">)</span><span style="color:#ADBAC7">,</span></span>
<span data-line=""><span style="color:#DCBDFB">					  asm_construct_label_tree</span><span style="color:#ADBAC7"> </span><span style="color:#ff938a">(</span><span style="color:#ADBAC7">expr</span><span style="color:#ff938a">)</span><span style="color:#daaa3f">}</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#DCBDFB">  ASM_INPUT_P</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">asm_expr</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7"> </span><span style="color:#F47067">=</span><span style="color:#ADBAC7"> expr.</span><span style="color:#DCBDFB">is_simple_asm</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#DCBDFB">  ASM_VOLATILE_P</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">asm_expr</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7"> </span><span style="color:#F47067">=</span><span style="color:#6CB6FF"> false</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#DCBDFB">  ASM_INLINE_P</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">asm_expr</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7"> </span><span style="color:#F47067">=</span><span style="color:#ADBAC7"> expr.</span><span style="color:#DCBDFB">is_inline_asm</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#F47067">  return</span><span style="color:#ADBAC7"> asm_expr;</span></span>
<span data-line=""><span style="color:#6cb6ff">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#ADBAC7">tree</span></span>
<span data-line=""><span style="color:#F69D50">CompileAsm</span><span style="color:#ADBAC7">::</span><span style="color:#DCBDFB">asm_build_stmt</span><span style="color:#ADBAC7"> </span><span style="color:#6cb6ff">(</span></span>
<span data-line=""><span style="color:#6CB6FF">  location_t</span><span style="color:#ADBAC7"> loc,</span></span>
<span data-line=""><span style="color:#F47067">  const</span><span style="color:#F69D50"> std</span><span style="color:#ADBAC7">::array</span><span style="color:#F47067">&#x3C;</span><span style="color:#ADBAC7">tree, </span><span style="color:#F69D50">CompileAsm</span><span style="color:#ADBAC7">::ASM_TREE_ARRAY_LENGTH</span><span style="color:#F47067">></span><span style="color:#F47067"> &#x26;</span><span style="color:#ADBAC7">trees</span><span style="color:#6cb6ff">)</span></span>
<span data-line=""><span style="color:#6cb6ff">{</span></span>
<span data-line=""><span style="color:#768390">  // Prototype functiion for building an ASM_EXPR tree.</span></span>
<span data-line=""><span style="color:#ADBAC7">  tree ret;</span></span>
<span data-line=""><span style="color:#F47067">  bool</span><span style="color:#ADBAC7"> side_effects;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#ADBAC7">  ret </span><span style="color:#F47067">=</span><span style="color:#DCBDFB"> make_node</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">ASM_EXPR</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#DCBDFB">  TREE_TYPE</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">ret</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7"> </span><span style="color:#F47067">=</span><span style="color:#ADBAC7"> void_type_node;</span></span>
<span data-line=""><span style="color:#DCBDFB">  SET_EXPR_LOCATION</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">ret, loc</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""> </span>
<span data-line=""> </span>
<span data-line=""><span style="color:#ADBAC7">  side_effects </span><span style="color:#F47067">=</span><span style="color:#6CB6FF"> false</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#F47067">  for</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#F47067">size_t</span><span style="color:#ADBAC7"> i </span><span style="color:#F47067">=</span><span style="color:#6CB6FF"> 0</span><span style="color:#ADBAC7">; i </span><span style="color:#F47067">&#x3C;</span><span style="color:#ADBAC7"> trees.</span><span style="color:#DCBDFB">size</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">; i</span><span style="color:#F47067">++</span><span style="color:#6bc46d">)</span></span>
<span data-line=""><span style="color:#ADBAC7">    </span><span style="color:#6bc46d">{</span></span>
<span data-line=""><span style="color:#ADBAC7">      tree t </span><span style="color:#F47067">=</span><span style="color:#ADBAC7"> trees</span><span style="color:#daaa3f">[</span><span style="color:#ADBAC7">i</span><span style="color:#daaa3f">]</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#F47067">      if</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#ADBAC7">t </span><span style="color:#F47067">&#x26;&#x26;</span><span style="color:#F47067"> !</span><span style="color:#DCBDFB">TYPE_P</span><span style="color:#ADBAC7"> </span><span style="color:#ff938a">(</span><span style="color:#ADBAC7">t</span><span style="color:#ff938a">)</span><span style="color:#daaa3f">)</span></span>
<span data-line=""><span style="color:#ADBAC7">	side_effects </span><span style="color:#F47067">|=</span><span style="color:#DCBDFB"> TREE_SIDE_EFFECTS</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#ADBAC7">t</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#DCBDFB">      TREE_OPERAND</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#ADBAC7">ret, i</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7"> </span><span style="color:#F47067">=</span><span style="color:#ADBAC7"> t;</span></span>
<span data-line=""><span style="color:#ADBAC7">    </span><span style="color:#6bc46d">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#DCBDFB">  TREE_SIDE_EFFECTS</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">ret</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7"> </span><span style="color:#F47067">|=</span><span style="color:#ADBAC7"> side_effects;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#F47067">  return</span><span style="color:#ADBAC7"> ret;</span></span>
<span data-line=""><span style="color:#6cb6ff">}</span></span><button type="button" title="Copy code" aria-label="Copy code" data="tree
CompileAsm::tree_codegen_asm (HIR::InlineAsm &#x26;expr)
{
  auto asm_expr
    = asm_build_stmt (expr.get_locus (), {asm_construct_string_tree (expr),
					  asm_construct_outputs (expr),
					  asm_construct_inputs (expr),
					  asm_construct_clobber_tree (expr),
					  asm_construct_label_tree (expr)});

  ASM_INPUT_P (asm_expr) = expr.is_simple_asm ();
  ASM_VOLATILE_P (asm_expr) = false;
  ASM_INLINE_P (asm_expr) = expr.is_inline_asm ();

  return asm_expr;
}

tree
CompileAsm::asm_build_stmt (
  location_t loc,
  const std::array<tree, CompileAsm::ASM_TREE_ARRAY_LENGTH> &#x26;trees)
{
  // Prototype functiion for building an ASM_EXPR tree.
  tree ret;
  bool side_effects;

  ret = make_node (ASM_EXPR);
  TREE_TYPE (ret) = void_type_node;
  SET_EXPR_LOCATION (ret, loc);


  side_effects = false;
  for (size_t i = 0; i < trees.size (); i++)
    {
      tree t = trees[i];
      if (t &#x26;&#x26; !TYPE_P (t))
	side_effects |= TREE_SIDE_EFFECTS (t);
      TREE_OPERAND (ret, i) = t;
    }

  TREE_SIDE_EFFECTS (ret) |= side_effects;

  return ret;
}" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></pre></figure>
<p>In the end, we add the tree to a list of statements in the following fashion:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="cpp" data-theme="github-dark-dimmed"><code data-language="cpp" data-theme="github-dark-dimmed" style="display: grid;"><span data-line=""><span style="color:#F47067">void</span></span>
<span data-line=""><span style="color:#F69D50">CompileExpr</span><span style="color:#ADBAC7">::</span><span style="color:#DCBDFB">visit</span><span style="color:#ADBAC7"> </span><span style="color:#6cb6ff">(</span><span style="color:#F69D50">HIR</span><span style="color:#ADBAC7">::InlineAsm </span><span style="color:#F47067">&#x26;</span><span style="color:#ADBAC7">expr</span><span style="color:#6cb6ff">)</span></span>
<span data-line=""><span style="color:#6cb6ff">{</span></span>
<span data-line=""><span style="color:#ADBAC7">  CompileAsm </span><span style="color:#DCBDFB">asm_codegen</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">ctx</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#ADBAC7">  ctx-</span><span style="color:#ADBAC7">></span><span style="color:#DCBDFB">add_statement</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">asm_codegen.</span><span style="color:#DCBDFB">tree_codegen_asm</span><span style="color:#ADBAC7"> </span><span style="color:#daaa3f">(</span><span style="color:#ADBAC7">expr</span><span style="color:#daaa3f">)</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6cb6ff">}</span></span><button type="button" title="Copy code" aria-label="Copy code" data="void
CompileExpr::visit (HIR::InlineAsm &#x26;expr)
{
  CompileAsm asm_codegen (ctx);
  ctx->add_statement (asm_codegen.tree_codegen_asm (expr));

}" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></pre></figure>
<p>Readers interested in the implementation details can refer to
<span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>gcc/rust/backend/rust-compile-asm.h/cc</span></span><button type="button" title="Copy code" aria-label="Copy code" data="gcc/rust/backend/rust-compile-asm.h/cc" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span> and <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>gcc/rust/backend/rust-compile-expr.h/cc</span></span><button type="button" title="Copy code" aria-label="Copy code" data="gcc/rust/backend/rust-compile-expr.h/cc" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></span></p>
<h2 id="results"><a aria-hidden="true" tabindex="-1" href="#results"><span class="icon icon-link"></span></a>Results</h2>
<p>Yayyy, we've finally relieved ourselves of code generation responsibilities, leaving the rest to GIMPLE, RTL, and gcc backend. The gccrs compiler can now generate correct instructions using the in and out register operands.</p>
<p>Below shows a few test cases that gccrs can now pass:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="rust" data-theme="github-dark-dimmed"><code data-language="rust" data-theme="github-dark-dimmed" style="display: grid;"><span data-line=""><span style="color:#768390">/* { dg-do run { target arm*-*-* } } */</span></span>
<span data-line=""><span style="color:#768390">/* { dg-output "5\r*\n9\r*\n" }*/</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#ADBAC7">#!</span><span style="color:#6cb6ff">[</span><span style="color:#ADBAC7">feature</span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">rustc_attrs</span><span style="color:#6bc46d">)</span><span style="color:#6cb6ff">]</span></span>
<span data-line=""><span style="color:#ADBAC7">#</span><span style="color:#6cb6ff">[</span><span style="color:#ADBAC7">rustc_builtin_macro</span><span style="color:#6cb6ff">]</span></span>
<span data-line=""><span style="color:#DCBDFB">macro_rules!</span><span style="color:#DCBDFB"> asm</span><span style="color:#ADBAC7"> </span><span style="color:#6cb6ff">{</span></span>
<span data-line=""><span style="color:#ADBAC7">    </span><span style="color:#6bc46d">(</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7"> </span><span style="color:#F47067">=</span><span style="color:#F47067">></span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">{</span><span style="color:#6bc46d">}</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#6cb6ff">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#F47067">extern</span><span style="color:#96D0FF"> "C"</span><span style="color:#ADBAC7"> </span><span style="color:#6cb6ff">{</span></span>
<span data-line=""><span style="color:#F47067">    fn</span><span style="color:#DCBDFB"> printf</span><span style="color:#6bc46d">(</span><span style="color:#ADBAC7">s</span><span style="color:#F47067">:</span><span style="color:#F47067"> *const</span><span style="color:#F69D50"> i8</span><span style="color:#ADBAC7">, </span><span style="color:#F47067">...</span><span style="color:#6bc46d">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#6cb6ff">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#F47067">fn</span><span style="color:#DCBDFB"> main</span><span style="color:#6cb6ff">(</span><span style="color:#6cb6ff">)</span><span style="color:#ADBAC7"> </span><span style="color:#F47067">-</span><span style="color:#F47067">></span><span style="color:#F69D50"> i32</span><span style="color:#ADBAC7"> </span><span style="color:#6cb6ff">{</span></span>
<span data-line=""><span style="color:#F47067">    let</span><span style="color:#F47067"> mut</span><span style="color:#ADBAC7"> x</span><span style="color:#F47067">:</span><span style="color:#F69D50"> i32</span><span style="color:#F47067"> =</span><span style="color:#6CB6FF"> 0</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#F47067">    let</span><span style="color:#F47067"> mut</span><span style="color:#ADBAC7"> _y</span><span style="color:#F47067">:</span><span style="color:#F69D50"> i32</span><span style="color:#F47067"> =</span><span style="color:#6CB6FF"> 9</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#F47067">    unsafe</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">{</span></span>
<span data-line=""><span style="color:#DCBDFB">        asm!</span><span style="color:#daaa3f">(</span></span>
<span data-line=""><span style="color:#96D0FF">            "mov {}, 5"</span><span style="color:#ADBAC7">,</span></span>
<span data-line=""><span style="color:#DCBDFB">            out</span><span style="color:#ff938a">(</span><span style="color:#ADBAC7">reg</span><span style="color:#ff938a">)</span><span style="color:#ADBAC7"> x</span></span>
<span data-line=""><span style="color:#ADBAC7">        </span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#DCBDFB">        printf</span><span style="color:#daaa3f">(</span><span style="color:#96D0FF">"%d</span><span style="color:#F47067">\n\0</span><span style="color:#96D0FF">"</span><span style="color:#F47067"> as</span><span style="color:#F47067"> *const</span><span style="color:#F69D50"> str</span><span style="color:#F47067"> as</span><span style="color:#F47067"> *const</span><span style="color:#F69D50"> i8</span><span style="color:#ADBAC7">, x</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#ADBAC7">    </span><span style="color:#6bc46d">}</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#F47067">    unsafe</span><span style="color:#ADBAC7"> </span><span style="color:#6bc46d">{</span></span>
<span data-line=""><span style="color:#DCBDFB">        asm!</span><span style="color:#daaa3f">(</span></span>
<span data-line=""><span style="color:#96D0FF">            "mov {}, {}"</span><span style="color:#ADBAC7">,</span></span>
<span data-line=""><span style="color:#DCBDFB">            in</span><span style="color:#ff938a">(</span><span style="color:#ADBAC7">reg</span><span style="color:#ff938a">)</span><span style="color:#ADBAC7"> _y,</span></span>
<span data-line=""><span style="color:#DCBDFB">            out</span><span style="color:#ff938a">(</span><span style="color:#ADBAC7">reg</span><span style="color:#ff938a">)</span><span style="color:#ADBAC7"> x</span></span>
<span data-line=""><span style="color:#ADBAC7">        </span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#DCBDFB">        printf</span><span style="color:#daaa3f">(</span><span style="color:#96D0FF">"%d</span><span style="color:#F47067">\n\0</span><span style="color:#96D0FF">"</span><span style="color:#F47067"> as</span><span style="color:#F47067"> *const</span><span style="color:#F69D50"> str</span><span style="color:#F47067"> as</span><span style="color:#F47067"> *const</span><span style="color:#F69D50"> i8</span><span style="color:#ADBAC7">, x</span><span style="color:#daaa3f">)</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#ADBAC7">    </span><span style="color:#6bc46d">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6CB6FF">    0</span></span>
<span data-line=""><span style="color:#6cb6ff">}</span></span><button type="button" title="Copy code" aria-label="Copy code" data="/* { dg-do run { target arm*-*-* } } */
/* { dg-output &#x22;5\r*\n9\r*\n&#x22; }*/

#![feature(rustc_attrs)]
#[rustc_builtin_macro]
macro_rules! asm {
    () => {};
}

extern &#x22;C&#x22; {
    fn printf(s: *const i8, ...);
}

fn main() -> i32 {
    let mut x: i32 = 0;
    let mut _y: i32 = 9;

    unsafe {
        asm!(
            &#x22;mov {}, 5&#x22;,
            out(reg) x
        );
        printf(&#x22;%d\n\0&#x22; as *const str as *const i8, x);
    };

    unsafe {
        asm!(
            &#x22;mov {}, {}&#x22;,
            in(reg) _y,
            out(reg) x
        );
        printf(&#x22;%d\n\0&#x22; as *const str as *const i8, x);
    }

    0
}" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></pre></figure>
<h2 id="end-words"><a aria-hidden="true" tabindex="-1" href="#end-words"><span class="icon icon-link"></span></a>End words</h2>
<p>Participating in Google Summer of Code for gccrs  (and get paid for it hehe) has been my most gratifying and meaningful experience in software development. I am mentored by Arthur Cohen and Pierre-Emmanuel "PEP" Patry; Arthur helped me with the direction of the project and code reviews while Pierre-Emmanuel provided me with code infrastructure navigation and PR code-reviews, both of which are much needed.</p>
<p>The main struggles for me in this internship is three fold:</p>
<ul>
<li>Around designing the code infrastructure to support inline assembly.</li>
<li>Around constructing new AST/HIR/ Tree IR via inheritance.</li>
<li>In general, navigating around documentation and codebase.</li>
</ul>
<p>There wasn't much in terms of inline assembly related work before the summer of my internship in gccrs. This means that I need also to decide how to
create and structure my code in a way that fits into the codebase itself. At that moment, there was just this fear of not knowing what to do, not knowing what to code.
That's the thing I love about software engineering in general and compiler more specifically.
The concept is akin to create something out of thin air: you made up a class and named it AST, inherited this class from another AST and trust that the visitor
pattern will come to save you once you have also created your made-up parser to produce this made-up AST; and the pattern continues on.
Looking back, I think given the time, I should have done more. Put in more PRs and contribute more test cases; sadly, I’ve let my indecisiveness and fear of the unknown consume me.</p>
<p>Documentation, I've learned, is a some-what of dire thing in the compiler world. I'm now, in retrospect, extra grateful for Arthur when he wrote
up a whole docs detailing each step for me when I attempted a hard PR. Thank you Arthur moah moah moah I love you.</p>
<p>I am taking a graduate course in compiler right now (Compiler optimization) (beaten to a pulp) and will try to get into another graduate compiler class next semester (Implementation of PL) and work in the industry in 2025.</p>
<p>Thank you for reading :)</p></div></article></div><!--$--><!--/$--></div><div class="bottom-4 right-4 fixed flex flex-col gap-2"><button class="shadow-md"><div class="inline text-xl font-bold border-black border-2 rounded p-2 bg-white">⇣⇣</div></button></div><footer class="footer self-center justify-center gap-2 pt-4 items-center italic "><p>Built by Jasmine with NextJS, TailwindCSS, and a tonnn of loveee :)</p></footer><script src="/_next/static/chunks/webpack-b2488ded99eca76e.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[6874,[\"874\",\"static/chunks/874-437a265a67d6cfee.js\",\"880\",\"static/chunks/app/posts/%5Bid%5D/page-8778b7e42f8ceed2.js\"],\"\"]\n3:I[7555,[],\"\"]\n4:I[1295,[],\"\"]\n5:I[7921,[\"874\",\"static/chunks/874-437a265a67d6cfee.js\",\"177\",\"static/chunks/app/layout-6c77c7f0e287af25.js\"],\"default\"]\n7:I[9665,[],\"OutletBoundary\"]\n9:I[4911,[],\"AsyncMetadataOutlet\"]\nb:I[9665,[],\"ViewportBoundary\"]\nd:I[9665,[],\"MetadataBoundary\"]\ne:\"$Sreact.suspense\"\n10:I[8393,[],\"\"]\n:HL[\"/_next/static/media/7385e8d9d3c5518f-s.p.ttf\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/ttf\"}]\n:HL[\"/_next/static/css/f55f51dd62de488d.css\",\"style\"]\n:HL[\"/_next/static/css/8a287c41de7a8698.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"m44wlJPGeChQFGUZAkyzS\",\"p\":\"\",\"c\":[\"\",\"posts\",\"what_I_did_for_gsoc_2024\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"what_I_did_for_gsoc_2024\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f55f51dd62de488d.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"px-4 py-4\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_d4e0c8 flex flex-col min-h-screen\",\"children\":[[\"$\",\"$L2\",null,{\"href\":\"/\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex justify-center items-center py-4 \",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-4xl font-bold\",\"children\":\"Jasmine Tang\"}]}]}],[\"$\",\"div\",null,{\"className\":\"flex-1\",\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"$L5\",null,{}],[\"$\",\"footer\",null,{\"className\":\"footer self-center justify-center gap-2 pt-4 items-center italic \",\"children\":[\"$\",\"p\",null,{\"children\":\"Built by Jasmine with NextJS, TailwindCSS, and a tonnn of loveee :)\"}]}]]}]}]]}],{\"children\":[\"posts\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"id\",\"what_I_did_for_gsoc_2024\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L6\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/8a287c41de7a8698.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L7\",null,{\"children\":[\"$L8\",[\"$\",\"$L9\",null,{\"promise\":\"$@a\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]],[\"$\",\"$Ld\",null,{\"children\":[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$e\",null,{\"fallback\":null,\"children\":\"$Lf\"}]}]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$10\",[]],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n8:null\n"])</script><script>self.__next_f.push([1,"12:I[8175,[],\"IconMark\"]\n11:T39c89,"])</script><script>self.__next_f.push([1,"\u003cnav class=\"toc\"\u003e\u003col class=\"toc-level toc-level-1\"\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#introduction\"\u003eIntroduction\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#main-contribution-aspects\"\u003eMain contribution aspects\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#issues-and-prs\"\u003eIssues and PRs\u003c/a\u003e\u003col class=\"toc-level toc-level-2\"\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#issues\"\u003eIssues\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#prs\"\u003ePRs\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h1\"\u003e\u003ca class=\"toc-link toc-link-h1\" href=\"#gccrs-inline-assembly\"\u003eGCCRS Inline Assembly\u003c/a\u003e\u003col class=\"toc-level toc-level-3\"\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#purpose\"\u003ePurpose\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#syntax\"\u003eSyntax\u003c/a\u003e\u003col class=\"toc-level toc-level-4\"\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#grammar\"\u003eGrammar\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#syntax-example\"\u003eSyntax example\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#overall-architecture\"\u003eOverall architecture\u003c/a\u003e\u003col class=\"toc-level toc-level-4\"\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#definition\"\u003eDefinition\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#architecture\"\u003eArchitecture\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#related-files\"\u003eRelated files\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#architecture-visualization\"\u003eArchitecture visualization\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#ast\"\u003eAST\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#parser\"\u003eParser\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#ast-to-hir\"\u003eAST to HIR\u003c/a\u003e\u003col class=\"toc-level toc-level-4\"\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#hir-creation\"\u003eHIR Creation\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#unsafe-gating\"\u003eUnsafe gating\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#type-checking\"\u003eType checking\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#resolution\"\u003eResolution\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#tree-generic\"\u003eTREE (GENERIC)\u003c/a\u003e\u003col class=\"toc-level toc-level-4\"\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#overall\"\u003eOverall\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#anatomy\"\u003eAnatomy\u003c/a\u003e\u003col class=\"toc-level toc-level-5\"\u003e\u003cli class=\"toc-item toc-item-h4\"\u003e\u003ca class=\"toc-link toc-link-h4\" href=\"#tree_list\"\u003eTREE_LIST\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h4\"\u003e\u003ca class=\"toc-link toc-link-h4\" href=\"#string_cst\"\u003eSTRING_CST\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h4\"\u003e\u003ca class=\"toc-link toc-link-h4\" href=\"#asm_expr\"\u003eASM_EXPR\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#tree-usage\"\u003eTREE USAGE\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#results\"\u003eResults\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#end-words\"\u003eEnd words\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/nav\u003e\u003cp\u003eHi everyone, this article is a requirement for my GSoc Final Submission, linking directly to the submission.\u003c/p\u003e\n\u003cp\u003eThis article will include the summary of my contribution, where you can find all my filed issues and PRs.\u003c/p\u003e\n\u003ch2 id=\"introduction\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#introduction\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eThis summer I worked on the \u003ca href=\"https://github.com/Rust-GCC/gccrs\" rel=\"nofollow\" target=\"_blank\"\u003egccrs\u003c/a\u003e project, a GCC Front-end for Rust.\u003c/p\u003e\n\u003cp\u003egccrs is a project to implement the Rust programming languages from scratch in the GCC codebase in order for rust to be able to be compiled to a wider amount of targets. It currently targets the version 1.49 of Rust and is supported by Open Source Security and Embecosm.\u003c/p\u003e\n\u003cp\u003eBy doing this, it helps with a couple things:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eTargets architecture not available with rustc due to the use of LLVM. (SuperH for example, which powers the Dreamcast!)\u003c/li\u003e\n\u003cli\u003eBenefit from the existing GCC ecosystem.\u003c/li\u003e\n\u003cli\u003eHelp with acceptance of Rust in the Linux kernel\u003c/li\u003e\n\u003cli\u003eHelp with acceptance of Rust in other fields, where having multiple compilers helps.\u003c/li\u003e\n\u003cli\u003eEnable building Rust on targets with very old C++ compilers! (Targets with at least GCC version 4.8 (which released March 22, 2013) can build Rust)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"main-contribution-aspects\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#main-contribution-aspects\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eMain contribution aspects\u003c/h2\u003e\n\u003cp\u003eOverall, I contributed in 3 main aspects:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eMy main project\u003c/strong\u003e - Inline Assembly in rust: I programmed the parser, set up the code infrastructure for TREE IR generation in the backend, along with AST, HIR lowering and typechecking.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eCI/CD\u003c/strong\u003e: I helped maintain and improve the CI/CD pipeline. This includes resolving dependency issues in GitHub Actions, adding support for 32 bit CI and glibc compliance CI.\nI also created a docker-compose dev environment for MacOS-based contributors, with all libraries and dependency installed; this helps us bypass MacOS's annoying build and link issues.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eCode maintainance/Bug Fixes/Code Review\u003c/strong\u003e: I maintained the code base via issues filed by my mentor and other contributors. I also helped fix some minor bugs in IR lowering and typechecking. I also help review some new, simple PRs for contributors.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"issues-and-prs\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#issues-and-prs\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eIssues and PRs\u003c/h2\u003e\n\u003cp\u003eBelow is all the issues, PRs and commits I've made to the \u003ca href=\"https://github.com/Rust-GCC/gccrs\" rel=\"nofollow\" target=\"_blank\"\u003egccrs\u003c/a\u003e repository, up to Aug 22 2024, after producing this I ended up closing some resolved issues that has been silently addressed in some PRs.\u003c/p\u003e\n\u003cp\u003eThe tables are produced via \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003egh\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"gh\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e cli tool and some \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003eI use nvim btw\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"I use nvim btw\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e love :)\u003c/p\u003e\n\u003ch3 id=\"issues\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#issues\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eIssues\u003c/h3\u003e\n\u003cp\u003eHere's a formatted version of all my issues, up to Aug 22 2024, procured via \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003egh issue list -A badumbatish --state all\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"gh issue list -A badumbatish --state all\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e:\u003c/p\u003e\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003ctable\u003e\u003cthead\u003e\u003ctr\u003e\u003cth\u003eIssue Number\u003c/th\u003e\u003cth\u003eIssue Status\u003c/th\u003e\u003cth\u003eIssue Title\u003c/th\u003e\u003cth\u003eLabels\u003c/th\u003e\u003cth\u003eFiled Date\u003c/th\u003e\u003c/tr\u003e\u003c/thead\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/issues/3102\" rel=\"nofollow\" target=\"_blank\"\u003e3102\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eOPEN\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eSet up the rest of HIR pipeline in InlineAsm\u003c/td\u003e\u003ctd\u003e\u003c/td\u003e\u003ctd\u003e2024-07-27T03:20:50Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/issues/3099\" rel=\"nofollow\" target=\"_blank\"\u003e3099\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eOPEN\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eparse_expr not stopping on =\u003e\u003c/td\u003e\u003ctd\u003e\u003c/td\u003e\u003ctd\u003e2024-07-25T19:41:07Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/issues/3072\" rel=\"nofollow\" target=\"_blank\"\u003e3072\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eOPEN\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003easm parser lacking \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003elabel\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"label\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e parse functionality\u003c/td\u003e\u003ctd\u003e\u003c/td\u003e\u003ctd\u003e2024-07-01T08:54:12Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/issues/3069\" rel=\"nofollow\" target=\"_blank\"\u003e3069\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eOPEN\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eMake asm parser stores parse result\u003c/td\u003e\u003ctd\u003e\u003c/td\u003e\u003ctd\u003e2024-06-25T16:12:44Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/issues/3062\" rel=\"nofollow\" target=\"_blank\"\u003e3062\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eCLOSED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eAdd ExprType::InlineAsm variant to ExprType enum\u003c/td\u003e\u003ctd\u003e\u003c/td\u003e\u003ctd\u003e2024-06-24T13:23:55Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/issues/3061\" rel=\"nofollow\" target=\"_blank\"\u003e3061\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eOPEN\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eTypechecking of asm! failed in \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003elet _\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"let _\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e\u003c/td\u003e\u003ctd\u003ebug\u003c/td\u003e\u003ctd\u003e2024-06-24T13:24:07Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/issues/3057\" rel=\"nofollow\" target=\"_blank\"\u003e3057\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eOPEN\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003easm! macro failed to exhaustively parse all of options(), clobber_abis(), and register operands\u003c/td\u003e\u003ctd\u003ebug, expansion\u003c/td\u003e\u003ctd\u003e2024-06-18T13:32:24Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/issues/3052\" rel=\"nofollow\" target=\"_blank\"\u003e3052\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eOPEN\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eFully incorporate tl::expected into InlineAsm parsing\u003c/td\u003e\u003ctd\u003e\u003c/td\u003e\u003ctd\u003e2024-06-14T09:54:17Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/issues/3051\" rel=\"nofollow\" target=\"_blank\"\u003e3051\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eCLOSED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eRemove unnecessary #include from rust-expr.h\u003c/td\u003e\u003ctd\u003egood-first-pr, cleanup\u003c/td\u003e\u003ctd\u003e2024-07-11T09:23:53Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/issues/3050\" rel=\"nofollow\" target=\"_blank\"\u003e3050\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eCLOSED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eSafe guard InlineAsm-related structs\u003c/td\u003e\u003ctd\u003e\u003c/td\u003e\u003ctd\u003e2024-07-03T09:58:52Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/issues/3048\" rel=\"nofollow\" target=\"_blank\"\u003e3048\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eOPEN\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eHandle outer attributes properly for inline assembly\u003c/td\u003e\u003ctd\u003e\u003c/td\u003e\u003ctd\u003e2024-06-14T09:55:37Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/issues/2937\" rel=\"nofollow\" target=\"_blank\"\u003e2937\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eCLOSED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eDocker image and container for Mac\u003c/td\u003e\u003ctd\u003e\u003c/td\u003e\u003ctd\u003e2024-05-10T14:53:25Z\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\n\u003cp\u003eThe closed/filed rate is 4/8, which is not high. Through out writing the parser and the backend infra, I realized that there are these little issues that's just easier to just fix and not necessary filed. There is also issues that are discussed via \u003ca href=\"https://gist.github.com/badumbatish/9823719ef359a58b131220d9d79d2aec\" rel=\"nofollow\" target=\"_blank\"\u003ehackmd notes\u003c/a\u003e between me and my mentor that are not necessarily filed via GitHub.\u003c/p\u003e\n\u003ch3 id=\"prs\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#prs\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003ePRs\u003c/h3\u003e\n\u003cp\u003eHere's a formatted version of all my pull requests, up to Aug 22 2024, procured via \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003egh pr list -A badumbatish --state all\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"gh pr list -A badumbatish --state all\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e:\u003c/p\u003e\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003ctable\u003e\u003cthead\u003e\u003ctr\u003e\u003cth\u003ePR Number\u003c/th\u003e\u003cth\u003ePR Status\u003c/th\u003e\u003cth\u003ePR Title\u003c/th\u003e\u003cth\u003eFiled Date\u003c/th\u003e\u003c/tr\u003e\u003c/thead\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/3133\" rel=\"nofollow\" target=\"_blank\"\u003e3133\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eMERGED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eFix the disorder struct and class in inline asm\u003c/td\u003e\u003ctd\u003e2024-08-20T07:41:34Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/3119\" rel=\"nofollow\" target=\"_blank\"\u003e3119\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eOPEN\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eAdd running cicd 32bit\u003c/td\u003e\u003ctd\u003e2024-08-04T19:47:37Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/3109\" rel=\"nofollow\" target=\"_blank\"\u003e3109\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eMERGED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eInline asm resolve expr\u003c/td\u003e\u003ctd\u003e2024-07-31T03:41:32Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/3103\" rel=\"nofollow\" target=\"_blank\"\u003e3103\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eMERGED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eInline asm hir pipeline\u003c/td\u003e\u003ctd\u003e2024-07-27T08:22:57Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/3098\" rel=\"nofollow\" target=\"_blank\"\u003e3098\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eMERGED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eFix the parser's operand and flags storage\u003c/td\u003e\u003ctd\u003e2024-07-25T16:38:11Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/3093\" rel=\"nofollow\" target=\"_blank\"\u003e3093\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eMERGED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eChange assertion of asm operand constructor\u003c/td\u003e\u003ctd\u003e2024-07-21T22:46:28Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/3090\" rel=\"nofollow\" target=\"_blank\"\u003e3090\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eMERGED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eAdded options for ParseMode\u003c/td\u003e\u003ctd\u003e2024-07-20T07:48:51Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/3081\" rel=\"nofollow\" target=\"_blank\"\u003e3081\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eMERGED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003ePin node16 by allowing old version\u003c/td\u003e\u003ctd\u003e2024-07-10T02:32:08Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/3074\" rel=\"nofollow\" target=\"_blank\"\u003e3074\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eMERGED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eSafe-guard InlineAsm structs\u003c/td\u003e\u003ctd\u003e2024-07-01T00:43:59Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/3073\" rel=\"nofollow\" target=\"_blank\"\u003e3073\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eMERGED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eStore parse result of parse_format_string(s)\u003c/td\u003e\u003ctd\u003e2024-07-01T00:24:42Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/3063\" rel=\"nofollow\" target=\"_blank\"\u003e3063\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eMERGED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eAdded ExprType::InlineAsm\u003c/td\u003e\u003ctd\u003e2024-06-23T18:06:02Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/3060\" rel=\"nofollow\" target=\"_blank\"\u003e3060\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eDRAFT\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eAsm generic il codegen\u003c/td\u003e\u003ctd\u003e2024-06-23T14:11:44Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/3059\" rel=\"nofollow\" target=\"_blank\"\u003e3059\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eMERGED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eAdd test case for using asm! outside of unsafe \u003c/td\u003e\u003ctd\u003e2024-06-22T06:40:27Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/3053\" rel=\"nofollow\" target=\"_blank\"\u003e3053\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eMERGED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eincorporate tl::expected into InlineAsm parsing\u003c/td\u003e\u003ctd\u003e2024-06-14T06:08:01Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/3011\" rel=\"nofollow\" target=\"_blank\"\u003e3011\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eMERGED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eRemove cstddef header from rust-fmt\u003c/td\u003e\u003ctd\u003e2024-05-19T03:03:05Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/3002\" rel=\"nofollow\" target=\"_blank\"\u003e3002\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eMERGED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eMake gccrs recognize negative_impls\u003c/td\u003e\u003ctd\u003e2024-05-15T22:06:45Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/2982\" rel=\"nofollow\" target=\"_blank\"\u003e2982\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eMERGED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eInline asm\u003c/td\u003e\u003ctd\u003e2024-05-08T19:41:27Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/2981\" rel=\"nofollow\" target=\"_blank\"\u003e2981\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eOPEN\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eCleanup macro invoc\u003c/td\u003e\u003ctd\u003e2024-05-08T17:47:46Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/2980\" rel=\"nofollow\" target=\"_blank\"\u003e2980\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eMERGED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eFix all tests in execute to be \\r\\n\u003c/td\u003e\u003ctd\u003e2024-05-08T06:47:12Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/2941\" rel=\"nofollow\" target=\"_blank\"\u003e2941\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eMERGED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eAdd an alternative solution on MacOS\u003c/td\u003e\u003ctd\u003e2024-04-05T03:10:57Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/2911\" rel=\"nofollow\" target=\"_blank\"\u003e2911\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eMERGED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eStore visibility properly in ExternalTypeItem: Fixes #2897\u003c/td\u003e\u003ctd\u003e2024-03-09T22:46:59Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/2895\" rel=\"nofollow\" target=\"_blank\"\u003e2895\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eMERGED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eAdd error emitting when we can't resolve id expr\u003c/td\u003e\u003ctd\u003e2024-03-01T10:40:34Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/2874\" rel=\"nofollow\" target=\"_blank\"\u003e2874\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eMERGED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eFirst stab at issue 2855 by splitting the two maps\u003c/td\u003e\u003ctd\u003e2024-02-25T21:13:02Z\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/2871\" rel=\"nofollow\" target=\"_blank\"\u003e2871\u003c/a\u003e\u003c/td\u003e\u003ctd\u003e\u003cstrong\u003eMERGED\u003c/strong\u003e\u003c/td\u003e\u003ctd\u003eFix FixMe in changing return type of builtin_macro_from_string() from BuiltinMacro to tl::optional/\u003cdiv\u003e\u003c/div\u003e\u003c/td\u003e\u003ctd\u003e2024-02-23T21:22:58Z\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\n\u003cp\u003eThe merged/filed rate is 22/25. Half of the PRs are easy to fix / fixable within a short amount of time (Code maintanence aspect). The other half is medium in difficulty, related to my summer project (Project aspect).\u003c/p\u003e\n\u003ch1 id=\"gccrs-inline-assembly\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#gccrs-inline-assembly\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eGCCRS Inline Assembly\u003c/h1\u003e\n\u003cp\u003eAlright, let's try to understand what I did this summer in greater detail.\u003c/p\u003e\n\u003cp\u003eThis write up will try to avoid lower level, implementation-based details but will let you walk away knowing what I, \u003ca href=\"https://badumbatish.github.io/\" rel=\"nofollow\" target=\"_blank\"\u003ebadumbatish\u003c/a\u003e did this summer :)\u003c/p\u003e\n\u003cp\u003eAlthough I won't post much code, I'll still provide links to my PRs for interested readers. Inspirations  includes contributors from the rust codebase and gccrs codebase. More specifically, \u003ca href=\"https://github.com/rust-lang/rust/blob/master/compiler/rustc_builtin_macros/src/asm.rs\" rel=\"nofollow\" target=\"_blank\"\u003easm.rs\u003c/a\u003e from rustc, Arthur, Pierre-Emmanuel and Mahad from gccrs.\u003c/p\u003e\n\u003ch2 id=\"purpose\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#purpose\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003ePurpose\u003c/h2\u003e\n\u003cp\u003eAssembly are often used by programmers as a precise instrument in case that compiler's high level constructs are too coarse for the programmers' intent. With the advent of inline  assembly, you can do this without having to create a seperate assembly file, maintaining the stackframe, register invariants, juggling different platforms and different calling conventions by yourself, etc...\u003c/p\u003e\n\u003cp\u003eThe purpose of my project is to provide support for inline assembly in gccrs. With respect to Rust's memory safety guarantees as well as the context of assembly languages usages in today's modern era, the project aims to alleviate the complexity from the programmmers while providing precautions and safeguards with unsafe blocks requirements and higher level constructs such as register operands, compared to raw hardware registers.\u003c/p\u003e\n\u003ch2 id=\"syntax\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#syntax\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eSyntax\u003c/h2\u003e\n\u003cp\u003eIn this section we'll take a look at the syntax of inline assembly, as well as dissecting some examples.\u003c/p\u003e\n\u003ch3 id=\"grammar\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#grammar\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eGrammar\u003c/h3\u003e\n\u003cp\u003eThe syntax for inline assembly is quite simple. This is taken from the \u003ca href=\"https://doc.rust-lang.org/reference/inline-assembly.html\" rel=\"nofollow\" target=\"_blank\"\u003eRust Reference website\u003c/a\u003e :\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre tabindex=\"0\" data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003eformat_string := STRING_LITERAL / RAW_STRING_LITERAL\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan\u003edir_spec := \"in\" / \"out\" / \"lateout\" / \"inout\" / \"inlateout\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan\u003ereg_spec := \u0026#x3C;register class\u003e / \"\\\"\" \u0026#x3C;explicit register\u003e \"\\\"\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan\u003eoperand_expr := expr / \"_\" / expr \"=\u003e\" expr / expr \"=\u003e\" \"_\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan\u003ereg_operand := [ident \"=\"] dir_spec \"(\" reg_spec \")\" operand_expr\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan\u003eclobber_abi := \"clobber_abi(\" \u0026#x3C;abi\u003e *(\",\" \u0026#x3C;abi\u003e) [\",\"] \")\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan\u003eoption := \"pure\" / \"nomem\" / \"readonly\" / \"preserves_flags\" / \"noreturn\" / \"nostack\" / \"att_syntax\" / \"raw\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan\u003eoptions := \"options(\" option *(\",\" option) [\",\"] \")\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan\u003eoperand := reg_operand / clobber_abi / options\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan\u003easm := \"asm!(\" format_string *(\",\" format_string) *(\",\" operand) [\",\"] \")\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan\u003eglobal_asm := \"global_asm!(\" format_string *(\",\" format_string) *(\",\" operand) [\",\"] \")\"\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"format_string := STRING_LITERAL / RAW_STRING_LITERAL\ndir_spec := \u0026#x22;in\u0026#x22; / \u0026#x22;out\u0026#x22; / \u0026#x22;lateout\u0026#x22; / \u0026#x22;inout\u0026#x22; / \u0026#x22;inlateout\u0026#x22;\nreg_spec := \u003cregister class\u003e / \u0026#x22;\\\u0026#x22;\u0026#x22; \u003cexplicit register\u003e \u0026#x22;\\\u0026#x22;\u0026#x22;\noperand_expr := expr / \u0026#x22;_\u0026#x22; / expr \u0026#x22;=\u003e\u0026#x22; expr / expr \u0026#x22;=\u003e\u0026#x22; \u0026#x22;_\u0026#x22;\nreg_operand := [ident \u0026#x22;=\u0026#x22;] dir_spec \u0026#x22;(\u0026#x22; reg_spec \u0026#x22;)\u0026#x22; operand_expr\nclobber_abi := \u0026#x22;clobber_abi(\u0026#x22; \u003cabi\u003e *(\u0026#x22;,\u0026#x22; \u003cabi\u003e) [\u0026#x22;,\u0026#x22;] \u0026#x22;)\u0026#x22;\noption := \u0026#x22;pure\u0026#x22; / \u0026#x22;nomem\u0026#x22; / \u0026#x22;readonly\u0026#x22; / \u0026#x22;preserves_flags\u0026#x22; / \u0026#x22;noreturn\u0026#x22; / \u0026#x22;nostack\u0026#x22; / \u0026#x22;att_syntax\u0026#x22; / \u0026#x22;raw\u0026#x22;\noptions := \u0026#x22;options(\u0026#x22; option *(\u0026#x22;,\u0026#x22; option) [\u0026#x22;,\u0026#x22;] \u0026#x22;)\u0026#x22;\noperand := reg_operand / clobber_abi / options\nasm := \u0026#x22;asm!(\u0026#x22; format_string *(\u0026#x22;,\u0026#x22; format_string) *(\u0026#x22;,\u0026#x22; operand) [\u0026#x22;,\u0026#x22;] \u0026#x22;)\u0026#x22;\nglobal_asm := \u0026#x22;global_asm!(\u0026#x22; format_string *(\u0026#x22;,\u0026#x22; format_string) *(\u0026#x22;,\u0026#x22; operand) [\u0026#x22;,\u0026#x22;] \u0026#x22;)\u0026#x22;\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eThe topmost level, or the start of the parse rule is either \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003easm\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"asm\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e or \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003eglobal_asm\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"global_asm\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e.\u003c/p\u003e\n\u003cp\u003eThe inline assembly code is represented by \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003eformat_string\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"format_string\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e. The other aspect is \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003eoperand\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"operand\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e, which includes \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003ereg_operand\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"reg_operand\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e, \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003eclobber_abi\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"clobber_abi\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e, and \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003eoptions\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"options\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e.\u003c/p\u003e\n\u003cp\u003eMore information about different types of operand can be referred to from \u003ca href=\"https://doc.rust-lang.org/reference/inline-assembly.html\" rel=\"nofollow\" target=\"_blank\"\u003ethe reference\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eKeep in mind that the way we see this division of the grammar is how we'll construct our AST subsequently, our parser.\u003c/p\u003e\n\u003ch3 id=\"syntax-example\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#syntax-example\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eSyntax example\u003c/h3\u003e\n\u003cp\u003eLet's look at some inline assembly examples pulled from the \u003ca href=\"https://doc.rust-lang.org/rust-by-example/unsafe/asm.html\" rel=\"nofollow\" target=\"_blank\"\u003eRust by example website\u003c/a\u003e.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThis is the simplest form, only including a no-op instruction\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre tabindex=\"0\" data-language=\"rust\" data-theme=\"github-dark-dimmed\"\u003e\u003ccode data-language=\"rust\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003euse\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e std\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003earch\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003easm;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003eunsafe\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e    asm!\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#96D0FF\"\u003e\"nop\"\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"use std::arch::asm;\n\nunsafe {\n    asm!(\u0026#x22;nop\u0026#x22;);\n}\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cul\u003e\n\u003cli\u003eOf course, more complex (non-simple) form of inline assembly requires some extra functionality:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre tabindex=\"0\" data-language=\"rust\" data-theme=\"github-dark-dimmed\"\u003e\u003ccode data-language=\"rust\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003euse\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e std\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003earch\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003easm;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003elet\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e x\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003eunsafe\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e    asm!\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#96D0FF\"\u003e\"mov {}, 5\"\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eout\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003ereg\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e x\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003eassert_eq!\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003ex, \u003c/span\u003e\u003cspan style=\"color:#6CB6FF\"\u003e5\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"use std::arch::asm;\n\nlet x: u64;\nunsafe {\n    asm!(\u0026#x22;mov {}, 5\u0026#x22;, out(reg) x);\n}\nassert_eq!(x, 5);\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eThis requires the operand functionality, more specifically the reg_operand category. In simple terms, the \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003e{}\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"{}\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e in the format string (template string) (designated by the double quote symbol) refers to the variable x. The out(reg) asks the compiler to substitute the  by the register used to store x and to assume the inline assembly will only write to this register and not expect any particular initial value. On the ARM platform architecture, in the raw assembly, the \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003e{}\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"{}\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e in the formatted string would be replaced with a  register allocated to \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003ex\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"x\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e, such as the \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003ex0\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"x0\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e register.\u003c/p\u003e\n\u003cp\u003eAn as a demonstrate, in the following code, \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003emove {}, 5\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"move {}, 5\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e is transformed into \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003emov x0, 5\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"mov x0, 5\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre tabindex=\"0\" data-language=\"asm\" data-theme=\"github-dark-dimmed\"\u003e\u003ccode data-language=\"asm\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    .cfi_def_cfa_offset \u003c/span\u003e\u003cspan style=\"color:#6CB6FF\"\u003e32\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    .cfi_offset \u003c/span\u003e\u003cspan style=\"color:#6CB6FF\"\u003e29\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e, -\u003c/span\u003e\u003cspan style=\"color:#6CB6FF\"\u003e32\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    .cfi_offset \u003c/span\u003e\u003cspan style=\"color:#6CB6FF\"\u003e30\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e, -\u003c/span\u003e\u003cspan style=\"color:#6CB6FF\"\u003e24\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e#APP\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e// \u003c/span\u003e\u003cspan style=\"color:#6CB6FF\"\u003e6\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \"asm_mov.rs\" \u003c/span\u003e\u003cspan style=\"color:#6CB6FF\"\u003e1\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e    mov\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e x0, \u003c/span\u003e\u003cspan style=\"color:#6CB6FF\"\u003e5\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e// \u003c/span\u003e\u003cspan style=\"color:#6CB6FF\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \"\" \u003c/span\u003e\u003cspan style=\"color:#6CB6FF\"\u003e2\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e#NO_APP\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    ...\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"    .cfi_def_cfa_offset 32\n    .cfi_offset 29, -32\n    .cfi_offset 30, -24\n    ...\n#APP\n// 6 \u0026#x22;asm_mov.rs\u0026#x22; 1\n    mov x0, 5\n\n// 0 \u0026#x22;\u0026#x22; 2\n#NO_APP\n    ...\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003ch2 id=\"overall-architecture\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#overall-architecture\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eOverall architecture\u003c/h2\u003e\n\u003cp\u003eIn this section we provide common compiler norms, discuss the overall architecture of the project as well as some of the most relevant files to the project.\u003c/p\u003e\n\u003cp\u003eThe end of this section provides a high level graph for readers to visualize the architecture.\u003c/p\u003e\n\u003ch3 id=\"definition\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#definition\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eDefinition\u003c/h3\u003e\n\u003cp\u003eBefore giving an overview of the architecture of the project, it's necessary to give context to common compiler norms:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eType checking: The process of ensuring that variables and expressions have types that align with the expected types (explicitly or implicitly) defined in the code, preventing type errors.\u003c/li\u003e\n\u003cli\u003eName resolution: The process of matching names (such as variables, functions, and types) in the code with their corresponding declarations to ensure correct scoping and accessibility.\u003c/li\u003e\n\u003cli\u003eUnsafe gating: The mechanism that restricts certain operations (e.g., raw pointer casting, inline assembly) to unsafe blocks, indicating that the programmer takes responsibility for upholding safety guarantees.\u003c/li\u003e\n\u003cli\u003eAST: Stands for Abstract syntax tree and is used to represent a program or a code snippet. Usually in a compiler, this data structure is the product of a parser. The compiler can then lower this data structure into a different data structure called HIR, which will be defined in the next sentence.\u003c/li\u003e\n\u003cli\u003eHIR: High Level Intermediate Representation. After AST, the compiler lowers the AST into a different representation. In gccrs, this is where different validations such as type checking, name resolution and unsafe gating happens. The compiler then lower this IR into what's known as GENERIC IL\u003c/li\u003e\n\u003cli\u003eTREE (GENERIC IL): GENERIC Intermediate Language. gcc's language-independent way of representing different constructs in trees.\u003c/li\u003e\n\u003cli\u003eGIMPLE: (From gcc:) is a three-address representation derived from GENERIC by breaking down GENERIC expressions into tuples of no more than 3 operands (with some exceptions like function calls).\u003c/li\u003e\n\u003cli\u003eGCC Backend: where gcc starts to generate archiecture-dependent code.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"architecture\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#architecture\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eArchitecture\u003c/h3\u003e\n\u003cp\u003eI haven't talked about how we should handle this. Obviously the plan is to have the compiler recognize the syntax so a parser is required, but what happens after that?\u003c/p\u003e\n\u003cp\u003eWell, like our cousin (or sibling?) rustc, the gccrs compiler itself has the AST, and then HIR. After that, gccrs converts its HIR into gcc's TREE (GENERIC IL) format. At this stage, gcc handles the conversion from inline assembly tree to gimple and then eventually raw architecture-dependent assembly code via gcc's backend.\u003c/p\u003e\n\u003cp\u003eWe need to also set up other stuff such as inline assembly validation, type checking, name resolution, etc etc. This will be mention in passing as it is relevant to Rust's safety feature.\u003c/p\u003e\n\u003ch3 id=\"related-files\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#related-files\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eRelated files\u003c/h3\u003e\n\u003cp\u003eThe related files for this issue includes\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003egcc/rust/expand/rust-macrobuiltins-asm.h/cc\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"gcc/rust/expand/rust-macrobuiltins-asm.h/cc\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e: Where the parsing of an \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003easm!()\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"asm!()\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e happens.\u003c/li\u003e\n\u003cli\u003e\u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003egcc/rust/ast/rust-expr.h\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"gcc/rust/ast/rust-expr.h\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e: Where the ast of an inline asm is defined.\u003c/li\u003e\n\u003cli\u003e\u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003egcc/rust/hir/tree/rust-hir-expr.h\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"gcc/rust/hir/tree/rust-hir-expr.h\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e: Where the HIR (high level ir) of an inline asm is defined.\u003c/li\u003e\n\u003cli\u003e\u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003egcc/rust/backend/rust-compile-asm.h/cc\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"gcc/rust/backend/rust-compile-asm.h/cc\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e: where the backend of inline asm starts processing.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"architecture-visualization\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#architecture-visualization\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eArchitecture visualization\u003c/h3\u003e\n\u003cp\u003eThe picture below depicts the project's pipeline.\n\u003cimg src=\"/blogs/mermaid_gsoc_arch1.svg\" alt=\"mermaid_gsoc_arch\"\u003e\u003c/p\u003e\n\u003ch2 id=\"ast\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#ast\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eAST\u003c/h2\u003e\n\u003cp\u003eThe AST follows the structure that the syntax provides.\u003c/p\u003e\n\u003cp\u003eAt the end of PR \u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/3060\" rel=\"nofollow\" target=\"_blank\"\u003e3060\u003c/a\u003e, it takes its structure from \u003ca href=\"https://github.com/rust-lang/rust/blob/master/compiler/rustc_builtin_macros/src/asm.rs\" rel=\"nofollow\" target=\"_blank\"\u003easm.rs\u003c/a\u003e. It inherits from the ExprWithoutBlock, which inherits from Expr, indicating that an asm! call is an expr.\u003c/p\u003e\n\u003cp\u003eHere, I give the high level structure of the AST related to inline assembly. In the gccrs codebase, the AST are represented with classes and structs.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eInlineAsm: this class inherits from ExprWithoutBlock, and contains containers for templated strings, operands, named arguments, register arguments, clobber abi, and options.\u003c/li\u003e\n\u003cli\u003eTupleTemplateStr: stands for a templated string where we store a location as well as the internet string\u003c/li\u003e\n\u003cli\u003eInlineAsmOperand: represents an operand in inline assembly, which can be a register operand (class InlineAsmRegOrRegClass) or some non-register operands such as a Sym or a Label.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eBy having a close mapping between the three things: Syntax, AST, and parsing, we lower our mental capacity in implementing them, maintaining a clear mental model if ever in need of debugging.\u003c/p\u003e\n\u003ch2 id=\"parser\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#parser\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eParser\u003c/h2\u003e\n\u003cp\u003eNice, now let's talk about the parser :)\u003c/p\u003e\n\u003cp\u003eWe'll be writing a simple recursive descent parser as described by our syntax section.\u003c/p\u003e\n\u003cp\u003eAs referenced above in the syntax section, the parser consists of 4 levels, 0 to 3, maintaining a clear and simple mapping between the parser and the syntax:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe first level (0), shows the entrance of the parser.\u003c/li\u003e\n\u003cli\u003eThe second level (1) describes the main loop of the parser, where we repeatedly parse all the formatted strings first, then operands then perform AST validation.\u003c/li\u003e\n\u003cli\u003eThe third and fourth level goes into the subcategory of each aspect of the second level and so on: parsing formatted strings means repeatedly parsing \u003cem\u003ea\u003c/em\u003e formatted string and parsing options means repeatedly parsing \u003cem\u003ean\u003c/em\u003e option, etc etc.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe diagram below shows the totality of the parser architecture, where the two greenish block in level 0 represents the starting point and the ending point of the parser.\n\u003cimg src=\"https://hackmd.io/_uploads/r1tIddrhR.svg\" alt=\"Untitled diagram-2024-09-04-060350\"\u003e\u003c/p\u003e\n\u003cp\u003eInterested readers can look into the master branch, in the file \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003egcc/rust/expand/rust-macro-builtins-asm.h/cc\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"gcc/rust/expand/rust-macro-builtins-asm.h/cc\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e for the implementation detail of the parser.\u003c/p\u003e\n\u003ch2 id=\"ast-to-hir\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#ast-to-hir\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eAST to HIR\u003c/h2\u003e\n\u003cp\u003eAfter we have gotten our AST, the next step is lowering it into HIR.\u003c/p\u003e\n\u003cp\u003eSince the inline assembly ASTs doesn't undergo much change in structure from AST to HIR, the HIRs representation inherits almost everything from the ASTs structure.\u003c/p\u003e\n\u003cp\u003eDespite similarity in structure, the HIR lowering is a necessary step in the pipeline where we get to inherit all of gccrs' necessary name resolution, unsafe gating and type checking.\u003c/p\u003e\n\u003ch3 id=\"hir-creation\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#hir-creation\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eHIR Creation\u003c/h3\u003e\n\u003cp\u003eThere must be an automatic way to do this. After all, the call \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003easm!\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"asm!\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e will appear everywhere, maybe in a block, maybe in another AST; how do we make sure that we can reach it and lower it correctly?\u003c/p\u003e\n\u003cp\u003eThe answer is the visitor pattern, here are \u003ca href=\"https://en.wikipedia.org/wiki/Visitor_pattern\" rel=\"nofollow\" target=\"_blank\"\u003esome\u003c/a\u003e of \u003ca href=\"https://refactoring.guru/design-patterns/visitor\" rel=\"nofollow\" target=\"_blank\"\u003ethe\u003c/a\u003e references to \u003ca href=\"https://www.youtube.com/watch?v=dQw4w9WgXcQ\" rel=\"nofollow\" target=\"_blank\"\u003elook into\u003c/a\u003e if you're new to this pattern.\u003c/p\u003e\n\u003cp\u003eIn short: The visitor pattern separate algorithms from the objects which they operate on.\u003c/p\u003e\n\u003cp\u003eIn my opinion, this is where the visitor pattern shines the brightest: you only have to worry about your part. Let's get into the nitty gritty.\u003c/p\u003e\n\u003cp\u003eIn the gccrs codebase, more specifically, the visitor class responsible for lowering AST to HIR is of the name \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003eASTLowering*\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"ASTLowering*\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e.\u003c/p\u003e\n\u003cp\u003eThe most general AST lowering class is \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003eASTLoweringBase\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"ASTLoweringBase\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e where all other AST lowering class inherits from to overload as needed.\u003c/p\u003e\n\u003cp\u003eSince our AST inherits from ExprWithoutBlock, which is a type of Expr, we implement our lowering from \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003eASTLoweringExpr\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"ASTLoweringExpr\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e. The following code block highlights the fact that we need to lower all of AST::Expr in our AST::InlineAsm, primarily in our AST::InlineAsmOperand; I show the pattern for the first two lowering of AST::InlineAsmOperand, as well as the method to create the HIR::InlineAsm.\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre tabindex=\"0\" data-language=\"cpp\" data-theme=\"github-dark-dimmed\"\u003e\u003ccode data-language=\"cpp\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F69D50\"\u003eHIR\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::InlineAsmOperand\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003etranslate_operand_in\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e AST\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::InlineAsmOperand \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eoperand\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  auto\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e in_value \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e operand.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_in\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  struct\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e HIR\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eInlineAsmOperand\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eIn\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e in \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    in_value.reg,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    std::\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eunique_ptr\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eExpr\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eASTLoweringExpr::\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003etranslate\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e*in_value.expr.get \u003c/span\u003e\u003cspan style=\"color:#fc8dc7\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#fc8dc7\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  return\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e in;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F69D50\"\u003eHIR\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::InlineAsmOperand\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003etranslate_operand_out\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e AST\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::InlineAsmOperand \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eoperand\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  auto\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e out_value \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e operand.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_out\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  struct\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e HIR\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eInlineAsmOperand\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eOut\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e out \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eout_value.reg, out_value.late,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\t\t\t\t\t std::\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eunique_ptr\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eExpr\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\t\t\t\t\t   ASTLoweringExpr::\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003etranslate\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\t\t\t\t\t     *out_value.expr.get \u003c/span\u003e\u003cspan style=\"color:#fc8dc7\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#fc8dc7\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  return\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e out;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#768390\"\u003e// [...]\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#768390\"\u003e// We omit translate_operand_inout, translate_operand_split_in_out,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#768390\"\u003e// translate_operand_const, translate_operand_sym,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#768390\"\u003e// translate_operand_label for clarity\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003efrom_operand\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e AST\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::InlineAsmOperand \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eoperand\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  using\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e RegisterType\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e AST\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eInlineAsmOperand\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eRegisterType\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  auto\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e type \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e operand.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_register_type\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  switch\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e    case\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e RegisterType\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::In:\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e      return\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003e translate_operand_in\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eoperand\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e    case\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e RegisterType\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::Out:\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e      return\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003e translate_operand_out\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eoperand\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e    case\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e RegisterType\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::InOut:\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e      return\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003e translate_operand_inout\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eoperand\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e    case\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e RegisterType\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::SplitInOut:\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e      return\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003e translate_operand_split_in_out\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eoperand\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e    case\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e RegisterType\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::Const:\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e      return\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003e translate_operand_const\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eoperand\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e    case\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e RegisterType\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::Sym:\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e      return\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003e translate_operand_sym\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eoperand\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e    case\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e RegisterType\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::Label:\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e      return\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003e translate_operand_label\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eoperand\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e    default\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e      rust_unreachable\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003evoid\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F69D50\"\u003eASTLoweringExpr\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003evisit\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eAST\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::InlineAsm \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eexpr\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  auto\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e crate_num \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e mappings.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_current_crate\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F69D50\"\u003e  Analysis\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::NodeMapping \u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003emapping\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003ecrate_num, expr.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_node_id\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\t\t\t\t mappings.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_next_hir_id\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003ecrate_num\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\t\t\t\t mappings.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_next_localdef_id\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003ecrate_num\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F69D50\"\u003e  std\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::vector\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eHIR\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::InlineAsmOperand\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e hir_operands;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  const\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e std\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::vector\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eAST\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::InlineAsmOperand\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003east_operands \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e expr.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_operands\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  for\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003eauto\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eoperand : ast_operands\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e      hir_operands.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003epush_back\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003efrom_operand\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eoperand\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e  translated\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e    =\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e HIR\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eInlineAsm\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eexpr.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_locus\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e, expr.is_global_asm,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\t\t\t  expr.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_template_\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e, expr.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_template_strs\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\t\t\t  hir_operands, expr.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_clobber_abi\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\t\t\t  expr.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_options\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e, mapping\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"HIR::InlineAsmOperand\ntranslate_operand_in (const AST::InlineAsmOperand \u0026#x26;operand)\n{\n  auto in_value = operand.get_in ();\n\n  struct HIR::InlineAsmOperand::In in (\n    in_value.reg,\n    std::unique_ptr\u003cExpr\u003e (ASTLoweringExpr::translate (*in_value.expr.get ())));\n  return in;\n}\n\nHIR::InlineAsmOperand\ntranslate_operand_out (const AST::InlineAsmOperand \u0026#x26;operand)\n{\n  auto out_value = operand.get_out ();\n  struct HIR::InlineAsmOperand::Out out (out_value.reg, out_value.late,\n\t\t\t\t\t std::unique_ptr\u003cExpr\u003e (\n\t\t\t\t\t   ASTLoweringExpr::translate (\n\t\t\t\t\t     *out_value.expr.get ())));\n  return out;\n}\n// [...]\n// We omit translate_operand_inout, translate_operand_split_in_out,\n// translate_operand_const, translate_operand_sym,\n// translate_operand_label for clarity\nfrom_operand (const AST::InlineAsmOperand \u0026#x26;operand)\n{\n  using RegisterType = AST::InlineAsmOperand::RegisterType;\n  auto type = operand.get_register_type ();\n\n  switch (type)\n    {\n    case RegisterType::In:\n      return translate_operand_in (operand);\n    case RegisterType::Out:\n      return translate_operand_out (operand);\n    case RegisterType::InOut:\n      return translate_operand_inout (operand);\n    case RegisterType::SplitInOut:\n      return translate_operand_split_in_out (operand);\n    case RegisterType::Const:\n      return translate_operand_const (operand);\n    case RegisterType::Sym:\n      return translate_operand_sym (operand);\n    case RegisterType::Label:\n      return translate_operand_label (operand);\n    default:\n      rust_unreachable ();\n    }\n}\nvoid\nASTLoweringExpr::visit (AST::InlineAsm \u0026#x26;expr)\n{\n  auto crate_num = mappings.get_current_crate ();\n  Analysis::NodeMapping mapping (crate_num, expr.get_node_id (),\n\t\t\t\t mappings.get_next_hir_id (crate_num),\n\t\t\t\t mappings.get_next_localdef_id (crate_num));\n\n  std::vector\u003cHIR::InlineAsmOperand\u003e hir_operands;\n  const std::vector\u003cAST::InlineAsmOperand\u003e \u0026#x26;ast_operands = expr.get_operands ();\n\n  for (auto \u0026#x26;operand : ast_operands)\n      hir_operands.push_back (from_operand (operand));\n\n\n  translated\n    = new HIR::InlineAsm (expr.get_locus (), expr.is_global_asm,\n\t\t\t  expr.get_template_ (), expr.get_template_strs (),\n\t\t\t  hir_operands, expr.get_clobber_abi (),\n\t\t\t  expr.get_options (), mapping);\n}\n\n\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003ch3 id=\"unsafe-gating\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#unsafe-gating\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eUnsafe gating\u003c/h3\u003e\n\u003cp\u003eSince \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"rust\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003easm!\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"asm!\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e is platform dependent and is inherently unsafe, i.e \"you would get a \u003ca href=\"https://en.wikipedia.org/wiki/Segmentation_fault\" rel=\"nofollow\" target=\"_blank\"\u003esegmentation fault\u003c/a\u003e with no probable stacktrace whatsoever\", rust requires asm! to be in an unsafe block.\u003c/p\u003e\n\u003cp\u003eIn the gccrs codebase, this \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003eunsafe gating\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"unsafe gating\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e is handled via \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003egcc/rust/checks/rust-unsafe-checker.h/cc\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"gcc/rust/checks/rust-unsafe-checker.h/cc\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e, again, employing the \u003ca href=\"https://stackoverflow.com/questions/6762256/how-does-double-dispatch-work-in-visitor-pattern\" rel=\"nofollow\" target=\"_blank\"\u003edouble dispatch\u003c/a\u003e functionality of the visitor pattern.\u003c/p\u003e\n\u003cp\u003eIn our implementation, the unsafe checker maintains a stack of contexts named \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"cpp\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003eunsafe_context\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"unsafe_context\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e with a convenient boolean function \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"cpp\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003eis_in_context\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"is_in_context()\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e. At the time of our visit, we check if it is an unsafe context or not.\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre tabindex=\"0\" data-language=\"cpp\" data-theme=\"github-dark-dimmed\"\u003e\u003ccode data-language=\"cpp\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003evoid\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F69D50\"\u003eUnsafeChecker\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003evisit\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eInlineAsm \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eexpr\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  if\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eunsafe_context.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eis_in_context\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e  rust_error_at\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    expr.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_locus\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eErrorCode\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::E0133,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#96D0FF\"\u003e    \"use of inline assembly is unsafe and requires unsafe function or block\"\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"void\nUnsafeChecker::visit (InlineAsm \u0026#x26;expr)\n{\n  if (unsafe_context.is_in_context ())\n    return;\n\n  rust_error_at (\n    expr.get_locus (), ErrorCode::E0133,\n    \u0026#x22;use of inline assembly is unsafe and requires unsafe function or block\u0026#x22;);\n}\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cblockquote\u003e\n\u003cp\u003eBut Jas, why we wouldn't want the UnsafeChecker to just maintain a boolean \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"cpp\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003eis_unsafe\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"is_unsafe\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e, and once UnsafeChecker visit an unsafe block, we set the boolean \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"cpp\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003eis_unsafe\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"is_unsafe\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e to true and consequently false after the UnsafeChecker finishes visiting?\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThis won't work if we are traversing an AST where we have nested unsafe block, thus a \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003etemplate \u0026#x3C;typename T\u003e class StackedContexts\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"template \u003ctypename T\u003e class StackedContexts\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e is needed. Let's examine an example where a single boolean failed and why we would need to use a stack.\u003c/p\u003e\n\u003cp\u003eIn this example, there is only 1 unsafe context; the boolean implementation satisfies the unsafe requirement.\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre tabindex=\"0\" data-language=\"diff\" data-theme=\"github-dark-dimmed\"\u003e\u003ccode data-language=\"diff\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003elet a = 15;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003eunsafe \u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e{\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e // we set the boolean to true\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e      // Now unsafe operations are allowed!\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e      let b = *\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\u0026#x26;a as *const i32\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e      let c = std::mem::transmute\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003ei32, f32\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e // we set it to false\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e// Yay me!!!\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"let a = 15;\nunsafe { // we set the boolean to true\n      // Now unsafe operations are allowed!\n      let b = *(\u0026#x26;a as *const i32);\n      let c = std::mem::transmute\u003ci32, f32\u003e(b);\n} // we set it to false\n// Yay me!!!\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eBut in the following case, where we have nested unsafe context, the boolean fails to recognize that we are still \"unsafe\"; thus needing a stack.\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre tabindex=\"0\" data-language=\"diff\" data-theme=\"github-dark-dimmed\"\u003e\u003ccode data-language=\"diff\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#8DDB8C\"\u003e+unsafe \u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e{\u003c/span\u003e\u003cspan style=\"color:#8DDB8C\"\u003e // wraps the above unsafe context inside another unsafe context\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    let a = 15;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    unsafe \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e{\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e // we set the boolean to true\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e         let b = *\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\u0026#x26;a as *const i32\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e         let c = std::mem::transmute\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003ei32, f32\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e // we set it to false\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    // Yay me!!!\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#8DDB8C\"\u003e+ \u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#8DDB8C\"\u003e+ // Now unsafe operations are forbidden again, but the boolean is false\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#8DDB8C\"\u003e+ let f = std::mem::transmute\u003c/span\u003e\u003cspan style=\"color:#8DDB8C\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#8DDB8C\"\u003ei32, f32\u003c/span\u003e\u003cspan style=\"color:#8DDB8C\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#8DDB8C\"\u003e15\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#8DDB8C\"\u003e; // Uh-oh!\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"+unsafe { // wraps the above unsafe context inside another unsafe context\n\n    let a = 15;\n    unsafe { // we set the boolean to true\n         let b = *(\u0026#x26;a as *const i32);\n         let c = std::mem::transmute\u003ci32, f32\u003e(b);\n    } // we set it to false\n    // Yay me!!!\n+ }\n+ // Now unsafe operations are forbidden again, but the boolean is false\n+ let f = std::mem::transmute\u003ci32, f32\u003e(15); // Uh-oh!\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eBefore every visit to an unsafe context, the unsafe checker inserts a context into the stack and after every visit, it pops that context out. A check to see if we are still unsafe checks if the stack is empty.\nReaders interested in implementation details can check \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003egcc/rust/checks/errors/rust-unsafe-checker.h/cc\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"gcc/rust/checks/errors/rust-unsafe-checker.h/cc\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e and \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003egcc/rust/util/rust-stacked-contexts.h\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"gcc/rust/util/rust-stacked-contexts.h\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e\u003c/p\u003e\n\u003ch3 id=\"type-checking\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#type-checking\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eType checking\u003c/h3\u003e\n\u003cp\u003eFrom the rust compiler dev references:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\"The only ones that are of particular interest to rustc are NORETURN which makes asm! return ! instead of ()\".\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eWe minimally represent this situation with the following implementation in \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003egcc/rust/typecheck/rust-hir-typecheck-expr.h/cc\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"gcc/rust/typecheck/rust-hir-typecheck-expr.h/cc\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre tabindex=\"0\" data-language=\"cpp\" data-theme=\"github-dark-dimmed\"\u003e\u003ccode data-language=\"cpp\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003evoid\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F69D50\"\u003eTypeCheckExpr\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003evisit\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eHIR\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::InlineAsm \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eexpr\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#768390\"\u003e  // We recursively typechecks its operands.\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e  typecheck_inline_asm_operand\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eexpr\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  if\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eexpr.options.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003ecount\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eAST\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eInlineAsmOption\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::NORETURN\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e==\u003c/span\u003e\u003cspan style=\"color:#6CB6FF\"\u003e 1\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    infered \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e TyTy\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eNeverType\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eexpr.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_mappings\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_hirid\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  else\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    infered\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e      =\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e TyTy\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eTupleType\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_unit_type\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eexpr.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_mappings\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_hirid\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"void\nTypeCheckExpr::visit (HIR::InlineAsm \u0026#x26;expr)\n{\n  // We recursively typechecks its operands.\n  typecheck_inline_asm_operand (expr);\n\n\n  if (expr.options.count (AST::InlineAsmOption::NORETURN) == 1)\n    infered = new TyTy::NeverType (expr.get_mappings ().get_hirid ());\n  else\n    infered\n      = TyTy::TupleType::get_unit_type (expr.get_mappings ().get_hirid ());\n}\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eI omit the part where we also recursive typecheck and infer each expr in each operand for the next part\u003c/p\u003e\n\u003ch3 id=\"resolution\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#resolution\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eResolution\u003c/h3\u003e\n\u003cp\u003eGiven an example that is part of \u003ca href=\"https://github.com/Rust-GCC/gccrs/pull/3060/files#diff-693188f770da1bcaab140cfa09a7df64b510f5b17f21d9dc7627fc401776086a\" rel=\"nofollow\" target=\"_blank\"\u003einline_asm_mov_x86_rs\u003c/a\u003e test case, where we refers to _x as a potential output:\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre tabindex=\"0\" data-language=\"rust\" data-theme=\"github-dark-dimmed\"\u003e\u003ccode data-language=\"rust\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003elet\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e mut\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e _x\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e i32\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#6CB6FF\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003eunsafe\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e    asm!\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#96D0FF\"\u003e        \"mov $5, {}\"\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e        out\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003ereg\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e _x\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"let mut _x: i32 = 0;\nunsafe {\n    asm!(\n        \u0026#x22;mov $5, {}\u0026#x22;,\n        out(reg) _x\n    );\n}\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eWe need a way to somehow link the \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003e_x\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"_x\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e that we refers inside the asm!, inside the unsafe block to the \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003e_x\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"_x\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e outside of the unsafe block.\u003c/p\u003e\n\u003cp\u003eThe part that handles this is called name resolution. The \u003ca href=\"https://rustc-dev-guide.rust-lang.org/name-resolution.html#:~:text=The%20name%20resolution%20in%20Rust,other%20via%20the%20ResolverAstLoweringExt%20trait.\" rel=\"nofollow\" target=\"_blank\"\u003eRust Compiler Dev Reference\u003c/a\u003e goes into much details for this part.\u003c/p\u003e\n\u003cp\u003eHere I provide some implementation details for gccrs.\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre tabindex=\"0\" data-language=\"cpp\" data-theme=\"github-dark-dimmed\"\u003e\u003ccode data-language=\"cpp\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#768390\"\u003e// Perform type checking on expr. Also runs type unification algorithm.\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#768390\"\u003e// Returns the unified type of expr\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F69D50\"\u003eTyTy\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::BaseType \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e*\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F69D50\"\u003eTypeCheckExpr\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eResolve\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eHIR\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::Expr \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eexpr\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e  TypeCheckExpr resolver;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e  expr-\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eaccept_vis\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eresolver\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  if\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eresolver.infered \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e==\u003c/span\u003e\u003cspan style=\"color:#6CB6FF\"\u003e nullptr\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e TyTy\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eErrorType\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eexpr-\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_mappings\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_hirid\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  auto\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e ref \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e expr-\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_mappings\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_hirid\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e  resolver.infered-\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eset_ref\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eref\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e  resolver.context-\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003einsert_type\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eexpr-\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_mappings\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e, resolver.infered\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  return\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e resolver.infered;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"// Perform type checking on expr. Also runs type unification algorithm.\n// Returns the unified type of expr\nTyTy::BaseType *\nTypeCheckExpr::Resolve (HIR::Expr *expr)\n{\n  TypeCheckExpr resolver;\n  expr-\u003eaccept_vis (resolver);\n\n  if (resolver.infered == nullptr)\n    return new TyTy::ErrorType (expr-\u003eget_mappings ().get_hirid ());\n\n  auto ref = expr-\u003eget_mappings ().get_hirid ();\n  resolver.infered-\u003eset_ref (ref);\n  resolver.context-\u003einsert_type (expr-\u003eget_mappings (), resolver.infered);\n\n  return resolver.infered;\n}\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003ch2 id=\"tree-generic\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#tree-generic\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eTREE (GENERIC)\u003c/h2\u003e\n\u003cp\u003eAfter we have finished setting up the AST and the HIR, we'll set up the TREE (GENERIC IR) infrastructure for our asm! node and after that, this IR will be lowered by gcc itself (GIMPLE IR), relieving us from duty.\u003c/p\u003e\n\u003cp\u003eThe most central data structure used in the IR is \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003etree\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"tree\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e, thus the name. From now, we'll refer to TREE IR as GENERIC IR.\u003c/p\u003e\n\u003cp\u003eThe knowledge I learned about GENERIC is through this documentation \u003ca href=\"https://gcc.gnu.org/onlinedocs/gccint/GENERIC.html\" rel=\"nofollow\" target=\"_blank\"\u003ehttps://gcc.gnu.org/onlinedocs/gccint/GENERIC.html\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"overall\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#overall\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eOverall\u003c/h3\u003e\n\u003cp\u003eLet's look at the definition and explore the tree code structures\u003c/p\u003e\n\u003cp\u003eFrom the GCC GENERIC:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThe purpose of GENERIC is simply to provide a language-independent way of representing an entire function in trees... If you can express it with the codes in gcc/tree.def, it’s GENERIC.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eNeedless to say, we are to obtain a working knowledge of trees and tree codes :)\u003c/p\u003e\n\u003cp\u003eIn the tree.def file, the tree codes are defined with the following structure:\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre tabindex=\"0\" data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003eDEFTREECODE (name, string_name, class, operand_count)\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"DEFTREECODE (name, string_name, class, operand_count)\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003ewhere:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ename: The symbolic name of the tree node.\u003c/li\u003e\n\u003cli\u003estring_name: The human-readable string representing the node.\u003c/li\u003e\n\u003cli\u003eclass: A classification for the nodes to follow a specific structure/functionality.\u003c/li\u003e\n\u003cli\u003eoperand_count: The number of fields it takes to make the tree of this type.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eLet's give an example of some of the tree codes we're sure to use:\u003c/p\u003e\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003ctable\u003e\u003cthead\u003e\u003ctr\u003e\u003cth\u003eTree code definition\u003c/th\u003e\u003cth\u003edefinition location in tree.def\u003c/th\u003e\u003cth\u003eUsage in our backend\u003c/th\u003e\u003c/tr\u003e\u003c/thead\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd\u003eDEFTREECOE(TREE_LIST, \"tree_list\", tcc_exceptional, 0)\u003c/td\u003e\u003ctd\u003eLine 54\u003c/td\u003e\u003ctd\u003eConstruction of operands\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003eDEFTREECODE(STRING_CST, \"string_cst\", tcc_constant, 0)\u003c/td\u003e\u003ctd\u003eLine 310\u003c/td\u003e\u003ctd\u003eConstruction of templated assembly code\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003eDEFTREECODE(ASM_EXPR, \"asm_expr\", tcc_statement, 5)\u003c/td\u003e\u003ctd\u003eLine 1008\u003c/td\u003e\u003ctd\u003eConstruction of inline assembly node\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\n\u003ch3 id=\"anatomy\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#anatomy\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eAnatomy\u003c/h3\u003e\n\u003cp\u003eI'll give a detailed look of the ones that are needed for the project.\u003c/p\u003e\n\u003ch4 id=\"tree_list\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#tree_list\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eTREE_LIST\u003c/h4\u003e\n\u003cp\u003eTREE_LIST is ... just a list of trees... It has a TREE_VALUE, TREE_PURPOSE and TREE_CHAIN.\u003c/p\u003e\n\u003cp\u003eFor the first two values, TREE_VALUE holds the element while TREE_PURPOSE gives a directive to later stages on what to do with this TREE_VALUE. In our tree usage section, we'll see that a tree list of register operands contains a TREE_VALUE of variables and a TREE_PURPOSE of register type, denoting if it's input or output register operands.\u003c/p\u003e\n\u003cp\u003eThe TREE_CHAIN node points to the next element in the tree list, which is also a TREE_LIST.\u003c/p\u003e\n\u003cp\u003eIn \u003ca href=\"https://github.com/Rust-GCC/gccrs/blob/master/gcc/tree.cc\" rel=\"nofollow\" target=\"_blank\"\u003egcc/tree.cc\u003c/a\u003e, a way to construct a tree list is\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre tabindex=\"0\" data-language=\"cpp\" data-theme=\"github-dark-dimmed\"\u003e\u003ccode data-language=\"cpp\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#768390\"\u003e/* Return a newly created TREE_LIST node whose\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#768390\"\u003e   purpose and value fields are PARM and VALUE.  */\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003etree\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003ebuild_tree_list\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003etree parm, tree value MEM_STAT_DECL\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e  tree t \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003e make_node\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eTREE_LIST PASS_MEM_STAT\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e  TREE_PURPOSE\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003et\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e parm;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e  TREE_VALUE\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003et\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e value;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  return\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e t;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"/* Return a newly created TREE_LIST node whose\n   purpose and value fields are PARM and VALUE.  */\ntree\nbuild_tree_list (tree parm, tree value MEM_STAT_DECL)\n{\n  tree t = make_node (TREE_LIST PASS_MEM_STAT);\n  TREE_PURPOSE (t) = parm;\n  TREE_VALUE (t) = value;\n  return t;\n}\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eA trend you'll see is that these underlying wrapper methods that construct our trees is that they'll start with a \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003etree t = make node(...)\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"tree t = make node(...)\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e or something that allocates memory for a tree, and then some  more \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003eUPPER_CASE_SETTER_GETTER_METHOD(t) = ...\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"UPPER_CASE_SETTER_GETTER_METHOD(t) = ...\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e that follows.\u003c/p\u003e\n\u003ch4 id=\"string_cst\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#string_cst\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eSTRING_CST\u003c/h4\u003e\n\u003cp\u003eThe STRING_CST is a tree constant of string. We'll use this type of TREE in a lot of places. For example, TREE_PURPOSE in the above TREE_LIST often uses some form of STRING_CST as a directive for later stages. We can also use it as a way to encode our unprocessed/templated inline assembly code as STRING_CST.\u003c/p\u003e\n\u003cp\u003eSometimes, our strings can also be represented not by a STRING_CST but by ARRAY of type CHAR, and this is also acceptable. An example of this is in \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003ecc\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"cc\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e for the inline assembly code.\u003c/p\u003e\n\u003cp\u003eA call to construct STRING_CST: \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003ebuild_string\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"build_string\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e, takes two parameters: a length of cstr, including the NULL delimiter and the cstr itself.\u003c/p\u003e\n\u003ch4 id=\"asm_expr\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#asm_expr\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eASM_EXPR\u003c/h4\u003e\n\u003cp\u003eAn ASM_EXPR has 5 parameters it needs passing.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAn ASM_STRING of treecode STRING_CST\u003c/li\u003e\n\u003cli\u003eAn ASM_OUTPUTS of treecode TREE_LIST\u003c/li\u003e\n\u003cli\u003eAn ASM_INPUTS of treecode TREE_LIST\u003c/li\u003e\n\u003cli\u003eAn ASM_CLOBBERS\u003c/li\u003e\n\u003cli\u003eAn ASM_LABELS\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eI omit the last two treecodes simply because the project hasn't had the capacity to explore the clobber and label functionality.\u003c/p\u003e\n\u003ch3 id=\"tree-usage\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#tree-usage\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eTREE USAGE\u003c/h3\u003e\n\u003cp\u003eIn constructing the tree representation of our inline assembly, we combine the existing infrastructure as well as our knowledge of tree codes.\u003c/p\u003e\n\u003cp\u003eMore specifically, we rely on existing tree generation of our variables and raw c strings. We build ourselves a list of input and output registers to make up the ASM_EXPR tree.\u003c/p\u003e\n\u003cp\u003eThe process of building our ASM_EXPR is as follow:\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre tabindex=\"0\" data-language=\"cpp\" data-theme=\"github-dark-dimmed\"\u003e\u003ccode data-language=\"cpp\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003etree\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F69D50\"\u003eCompileAsm\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003etree_codegen_asm\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eHIR\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::InlineAsm \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eexpr\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  auto\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e asm_expr\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e    =\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003e asm_build_stmt\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eexpr.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eget_locus\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e{\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003easm_construct_string_tree\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eexpr\u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e\t\t\t\t\t  asm_construct_outputs\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eexpr\u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e\t\t\t\t\t  asm_construct_inputs\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eexpr\u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e\t\t\t\t\t  asm_construct_clobber_tree\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eexpr\u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e\t\t\t\t\t  asm_construct_label_tree\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eexpr\u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e  ASM_INPUT_P\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003easm_expr\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e expr.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eis_simple_asm\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e  ASM_VOLATILE_P\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003easm_expr\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#6CB6FF\"\u003e false\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e  ASM_INLINE_P\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003easm_expr\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e expr.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eis_inline_asm\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  return\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e asm_expr;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003etree\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F69D50\"\u003eCompileAsm\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003easm_build_stmt\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6CB6FF\"\u003e  location_t\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e loc,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  const\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e std\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::array\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003etree, \u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eCompileAsm\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::ASM_TREE_ARRAY_LENGTH\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003etrees\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#768390\"\u003e  // Prototype functiion for building an ASM_EXPR tree.\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e  tree ret;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  bool\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e side_effects;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e  ret \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003e make_node\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eASM_EXPR\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e  TREE_TYPE\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eret\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e void_type_node;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e  SET_EXPR_LOCATION\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eret, loc\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e  side_effects \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#6CB6FF\"\u003e false\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  for\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003esize_t\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e i \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#6CB6FF\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e; i \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e trees.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003esize\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e; i\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e++\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e      tree t \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e trees\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003ei\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e]\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e      if\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003et \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e\u0026#x26;\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e !\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eTYPE_P\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003et\u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\tside_effects \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e|=\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003e TREE_SIDE_EFFECTS\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003et\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e      TREE_OPERAND\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eret, i\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e t;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e  TREE_SIDE_EFFECTS\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eret\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e|=\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e side_effects;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e  return\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e ret;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"tree\nCompileAsm::tree_codegen_asm (HIR::InlineAsm \u0026#x26;expr)\n{\n  auto asm_expr\n    = asm_build_stmt (expr.get_locus (), {asm_construct_string_tree (expr),\n\t\t\t\t\t  asm_construct_outputs (expr),\n\t\t\t\t\t  asm_construct_inputs (expr),\n\t\t\t\t\t  asm_construct_clobber_tree (expr),\n\t\t\t\t\t  asm_construct_label_tree (expr)});\n\n  ASM_INPUT_P (asm_expr) = expr.is_simple_asm ();\n  ASM_VOLATILE_P (asm_expr) = false;\n  ASM_INLINE_P (asm_expr) = expr.is_inline_asm ();\n\n  return asm_expr;\n}\n\ntree\nCompileAsm::asm_build_stmt (\n  location_t loc,\n  const std::array\u003ctree, CompileAsm::ASM_TREE_ARRAY_LENGTH\u003e \u0026#x26;trees)\n{\n  // Prototype functiion for building an ASM_EXPR tree.\n  tree ret;\n  bool side_effects;\n\n  ret = make_node (ASM_EXPR);\n  TREE_TYPE (ret) = void_type_node;\n  SET_EXPR_LOCATION (ret, loc);\n\n\n  side_effects = false;\n  for (size_t i = 0; i \u003c trees.size (); i++)\n    {\n      tree t = trees[i];\n      if (t \u0026#x26;\u0026#x26; !TYPE_P (t))\n\tside_effects |= TREE_SIDE_EFFECTS (t);\n      TREE_OPERAND (ret, i) = t;\n    }\n\n  TREE_SIDE_EFFECTS (ret) |= side_effects;\n\n  return ret;\n}\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eIn the end, we add the tree to a list of statements in the following fashion:\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre tabindex=\"0\" data-language=\"cpp\" data-theme=\"github-dark-dimmed\"\u003e\u003ccode data-language=\"cpp\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003evoid\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F69D50\"\u003eCompileExpr\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003evisit\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003eHIR\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e::InlineAsm \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eexpr\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e  CompileAsm \u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003easm_codegen\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e  ctx-\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003eadd_statement\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003easm_codegen.\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003etree_codegen_asm\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003eexpr\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"void\nCompileExpr::visit (HIR::InlineAsm \u0026#x26;expr)\n{\n  CompileAsm asm_codegen (ctx);\n  ctx-\u003eadd_statement (asm_codegen.tree_codegen_asm (expr));\n\n}\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eReaders interested in the implementation details can refer to\n\u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003egcc/rust/backend/rust-compile-asm.h/cc\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"gcc/rust/backend/rust-compile-asm.h/cc\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e and \u003cspan data-rehype-pretty-code-figure=\"\"\u003e\u003ccode data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan\u003egcc/rust/backend/rust-compile-expr.h/cc\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"gcc/rust/backend/rust-compile-expr.h/cc\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/span\u003e\u003c/p\u003e\n\u003ch2 id=\"results\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#results\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eResults\u003c/h2\u003e\n\u003cp\u003eYayyy, we've finally relieved ourselves of code generation responsibilities, leaving the rest to GIMPLE, RTL, and gcc backend. The gccrs compiler can now generate correct instructions using the in and out register operands.\u003c/p\u003e\n\u003cp\u003eBelow shows a few test cases that gccrs can now pass:\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre tabindex=\"0\" data-language=\"rust\" data-theme=\"github-dark-dimmed\"\u003e\u003ccode data-language=\"rust\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#768390\"\u003e/* { dg-do run { target arm*-*-* } } */\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#768390\"\u003e/* { dg-output \"5\\r*\\n9\\r*\\n\" }*/\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e#!\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003efeature\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003erustc_attrs\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e]\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e#\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003erustc_builtin_macro\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e]\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003emacro_rules!\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003e asm\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e{\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003eextern\u003c/span\u003e\u003cspan style=\"color:#96D0FF\"\u003e \"C\"\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e    fn\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003e printf\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003es\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e *const\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e i8\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e...\u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003efn\u003c/span\u003e\u003cspan style=\"color:#DCBDFB\"\u003e main\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e i32\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6cb6ff\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e mut\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e x\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e i32\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#6CB6FF\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e mut\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e _y\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e i32\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#6CB6FF\"\u003e 9\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e    unsafe\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e        asm!\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#96D0FF\"\u003e            \"mov {}, 5\"\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e            out\u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003ereg\u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e x\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e        \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e        printf\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#96D0FF\"\u003e\"%d\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e\\n\\0\u003c/span\u003e\u003cspan style=\"color:#96D0FF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e as\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e *const\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e str\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e as\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e *const\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e i8\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e, x\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F47067\"\u003e    unsafe\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e        asm!\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#96D0FF\"\u003e            \"mov {}, {}\"\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e            in\u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003ereg\u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e _y,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e            out\u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003ereg\u003c/span\u003e\u003cspan style=\"color:#ff938a\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e x\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e        \u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#DCBDFB\"\u003e        printf\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#96D0FF\"\u003e\"%d\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e\\n\\0\u003c/span\u003e\u003cspan style=\"color:#96D0FF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e as\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e *const\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e str\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e as\u003c/span\u003e\u003cspan style=\"color:#F47067\"\u003e *const\u003c/span\u003e\u003cspan style=\"color:#F69D50\"\u003e i8\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e, x\u003c/span\u003e\u003cspan style=\"color:#daaa3f\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ADBAC7\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ADBAC7\"\u003e    \u003c/span\u003e\u003cspan style=\"color:#6bc46d\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6CB6FF\"\u003e    0\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#6cb6ff\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"/* { dg-do run { target arm*-*-* } } */\n/* { dg-output \u0026#x22;5\\r*\\n9\\r*\\n\u0026#x22; }*/\n\n#![feature(rustc_attrs)]\n#[rustc_builtin_macro]\nmacro_rules! asm {\n    () =\u003e {};\n}\n\nextern \u0026#x22;C\u0026#x22; {\n    fn printf(s: *const i8, ...);\n}\n\nfn main() -\u003e i32 {\n    let mut x: i32 = 0;\n    let mut _y: i32 = 9;\n\n    unsafe {\n        asm!(\n            \u0026#x22;mov {}, 5\u0026#x22;,\n            out(reg) x\n        );\n        printf(\u0026#x22;%d\\n\\0\u0026#x22; as *const str as *const i8, x);\n    };\n\n    unsafe {\n        asm!(\n            \u0026#x22;mov {}, {}\u0026#x22;,\n            in(reg) _y,\n            out(reg) x\n        );\n        printf(\u0026#x22;%d\\n\\0\u0026#x22; as *const str as *const i8, x);\n    }\n\n    0\n}\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003ch2 id=\"end-words\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#end-words\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eEnd words\u003c/h2\u003e\n\u003cp\u003eParticipating in Google Summer of Code for gccrs  (and get paid for it hehe) has been my most gratifying and meaningful experience in software development. I am mentored by Arthur Cohen and Pierre-Emmanuel \"PEP\" Patry; Arthur helped me with the direction of the project and code reviews while Pierre-Emmanuel provided me with code infrastructure navigation and PR code-reviews, both of which are much needed.\u003c/p\u003e\n\u003cp\u003eThe main struggles for me in this internship is three fold:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAround designing the code infrastructure to support inline assembly.\u003c/li\u003e\n\u003cli\u003eAround constructing new AST/HIR/ Tree IR via inheritance.\u003c/li\u003e\n\u003cli\u003eIn general, navigating around documentation and codebase.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThere wasn't much in terms of inline assembly related work before the summer of my internship in gccrs. This means that I need also to decide how to\ncreate and structure my code in a way that fits into the codebase itself. At that moment, there was just this fear of not knowing what to do, not knowing what to code.\nThat's the thing I love about software engineering in general and compiler more specifically.\nThe concept is akin to create something out of thin air: you made up a class and named it AST, inherited this class from another AST and trust that the visitor\npattern will come to save you once you have also created your made-up parser to produce this made-up AST; and the pattern continues on.\nLooking back, I think given the time, I should have done more. Put in more PRs and contribute more test cases; sadly, I’ve let my indecisiveness and fear of the unknown consume me.\u003c/p\u003e\n\u003cp\u003eDocumentation, I've learned, is a some-what of dire thing in the compiler world. I'm now, in retrospect, extra grateful for Arthur when he wrote\nup a whole docs detailing each step for me when I attempted a hard PR. Thank you Arthur moah moah moah I love you.\u003c/p\u003e\n\u003cp\u003eI am taking a graduate course in compiler right now (Compiler optimization) (beaten to a pulp) and will try to get into another graduate compiler class next semester (Implementation of PL) and work in the industry in 2025.\u003c/p\u003e\n\u003cp\u003eThank you for reading :)\u003c/p\u003e"])</script><script>self.__next_f.push([1,"6:[\"$\",\"div\",null,{\"className\":\"py-12 flex flex-col items-center  justify-items-start mx-auto \",\"children\":[[\"$\",\"$L2\",null,{\"href\":\"/blog\",\"className\":\"flex justify-center text-4xl\",\"children\":[\"$\",\"h2\",null,{\"children\":\"My blog\"}]}],[\"$\",\"article\",null,{\"className\":\"p-8 prose pt-0.5 max-w-none w-full lg:w-1/2 md:w-4/6 sm:w-5/6 prose-sky mx-auto\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex justify-center text-2xl font-bold \",\"children\":[\"$\",\"h2\",null,{\"children\":\"What I did for GSoc 2024\"}]}],[\"$\",\"div\",null,{\"className\":\"flex justify-start text-xl font-bold underline\",\"children\":[\"$\",\"h4\",null,{\"children\":\"2024-08-22\"}]}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$11\"}}]]}]]}]\n"])</script><script>self.__next_f.push([1,"a:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"What I did for GSoc 2024\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"The article is a report of what Jasmine's done for her Google Summer Of Code\"}],[\"$\",\"link\",\"2\",{\"rel\":\"icon\",\"href\":\"/_next/static/media/pfp6.723cdd8c.png\"}],[\"$\",\"$L12\",\"3\",{}]],\"error\":null,\"digest\":\"$undefined\"}\nf:\"$a:metadata\"\n"])</script></body></html>