1:"$Sreact.fragment"
2:I[6874,["874","static/chunks/874-437a265a67d6cfee.js","880","static/chunks/app/posts/%5Bid%5D/page-f0f7551128d4c13f.js"],""]
3:I[7555,[],""]
4:I[1295,[],""]
5:I[7921,["874","static/chunks/874-437a265a67d6cfee.js","63","static/chunks/63-63ed21df6f1fc3e7.js","177","static/chunks/app/layout-05e345a4cd50b3e1.js"],"default"]
7:I[9665,[],"OutletBoundary"]
9:I[4911,[],"AsyncMetadataOutlet"]
b:I[9665,[],"ViewportBoundary"]
d:I[9665,[],"MetadataBoundary"]
e:"$Sreact.suspense"
10:I[8393,[],""]
:HL["/_next/static/media/7385e8d9d3c5518f-s.p.ttf","font",{"crossOrigin":"","type":"font/ttf"}]
:HL["/_next/static/css/3b37cf79ceb9ce8f.css","style"]
:HL["/_next/static/css/3864b451a61e4546.css","style"]
0:{"P":null,"b":"tQMlEKZuY6bvMOxK9xxAn","p":"","c":["","posts","gsoc_prop"],"i":false,"f":[[["",{"children":["posts",{"children":[["id","gsoc_prop","d"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/3b37cf79ceb9ce8f.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","className":"px-4 py-4","children":["$","body",null,{"className":"__className_d4e0c8 flex flex-col min-h-screen","children":[["$","$L2",null,{"href":"/","children":["$","div",null,{"className":"flex justify-center items-center py-4 ","children":["$","h1",null,{"className":"text-4xl font-bold","children":"Jasmine Tang"}]}]}],["$","div",null,{"className":"flex-1","children":["$","$L3",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}],["$","$L5",null,{}],["$","footer",null,{"className":"footer self-center justify-center gap-2 pt-4 items-center italic ","children":["$","p",null,{"children":"Built by Jasmine with NextJS, TailwindCSS, and a tonnn of loveee :)"}]}]]}]}]]}],{"children":["posts",["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["id","gsoc_prop","d"],["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L6",[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/3864b451a61e4546.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","$L7",null,{"children":["$L8",["$","$L9",null,{"promise":"$@a"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,[["$","$Lb",null,{"children":"$Lc"}],["$","meta",null,{"name":"next-size-adjust","content":""}]],["$","$Ld",null,{"children":["$","div",null,{"hidden":true,"children":["$","$e",null,{"fallback":null,"children":"$Lf"}]}]}]]}],false]],"m":"$undefined","G":["$10",[]],"s":false,"S":true}
c:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
8:null
12:I[8175,[],"IconMark"]
11:T9321,<nav class="toc"><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#prologue">Prologue</a></li><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#jjasmines-gsoc-gccrs-proposal">jjasmineâ€™s Gsoc GCCRS proposal</a></li><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#gsoc-proposal-inline-assembly-support">Gsoc Proposal: Inline assembly Support</a></li><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#project">Project</a></li><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#goals">Goals</a></li><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#expected-timeline--responsibitilies">Expected timeline &#x26; responsibitilies</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#expected-timeline">Expected timeline</a><ol class="toc-level toc-level-3"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#week-1-3-may-27---june-17-implement-and-test-the-parser-to-convert-rust-asm-format-to-gcc-asm-format">WEEK 1-3 (May 27 - June 17): Implement and test the parser to convert rust asm format to gcc asm format.</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#week-4-june-17---june-24-improve-if-possible-asm-ast-in-rust-macro-builtins-implement-asm-hir-and-visitor">WEEK 4 (June 17 - June 24): Improve (if possible) asm-AST in rust-macro-builtins, implement asm-HIR and visitor</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#week-5-june-24---july-1-implement-handlers-for-asm-creating-ast-asm-from-a-stream-of-tokens">WEEK 5 (June 24 - July 1): Implement handlers for asm, creating AST asm from a stream of tokens.</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#week-6-7-july-1---july-15-work-with-astlowering-lowering-the-asm-ast-to-hir-high-level-ir">WEEK 6-7 (July 1 - July 15): Work with ASTLowering, lowering the asm-AST to HIR (high level IR).</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#week-7-8-july-15---july-29-work-with-generic-il-in-compile-converting-hir-to-generic-intermediate-language">WEEK 7-8 (July 15 - July 29): Work with GENERIC IL in Compile*, converting HIR to GENERIC intermediate language.</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#week-9-july-29---aug-5-end-to-end-testing">WEEK 9 (July 29 - Aug 5): End-to-end testing.</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#week-11-12-aug-5---19-spare-time-allocation-for-different-parts-of-projects">WEEK 11-12 (Aug 5 - 19): Spare time allocation for different parts of projects.</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#week-10-aug-19---aug-26-report-and-documentation">WEEK 10 (Aug 19 - Aug 26): Report and Documentation</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#responsibitiles-and-my-schedule">Responsibitiles and my schedule.</a><ol class="toc-level toc-level-3"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#university">University</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#internship">Internship</a></li></ol></li></ol></li><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#design-doc">Design doc</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#lexer--parser-implementation">Lexer &#x26; Parser implementation</a><ol class="toc-level toc-level-3"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#grammar">Grammar</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#implementation">Implementation</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#rust-asm-ast-hir-and-visitor">rust asm-ast, HIR, and visitor</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#asm-handlers">asm-handlers</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#astlowering">ASTLowering</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#converting-hir-to-generic-intermediate-language">Converting HIR to GENERIC intermediate language</a></li></ol></li><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#introduce-myself-my-skills-and-accomplishments">Introduce myself, my skills and accomplishments</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#information">Information</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#about-myself">About myself</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#my-contribution-to-gccrs">My contribution to gccrs</a></li></ol></li></ol></nav><h1 id="prologue"><a aria-hidden="true" tabindex="-1" href="#prologue"><span class="icon icon-link"></span></a>Prologue</h1>
<p>Hi everyone, I hope you're doing great. This is an archive of my GSoc 2024 proposal: Inline Assembly in gccrs.</p>
<p>Also here's a <a href="https://www.youtube.com/watch?v=hSYfVjRMeis&#x26;ab_channel=darkcat-Topic" rel="nofollow" target="_blank">song</a> for you :)</p>
<p>I hope
you enjoy!</p>
<h1 id="jjasmines-gsoc-gccrs-proposal"><a aria-hidden="true" tabindex="-1" href="#jjasmines-gsoc-gccrs-proposal"><span class="icon icon-link"></span></a>jjasmineâ€™s Gsoc GCCRS proposal</h1>
<h1 id="gsoc-proposal-inline-assembly-support"><a aria-hidden="true" tabindex="-1" href="#gsoc-proposal-inline-assembly-support"><span class="icon icon-link"></span></a>Gsoc Proposal: Inline assembly Support</h1>
<h1 id="project"><a aria-hidden="true" tabindex="-1" href="#project"><span class="icon icon-link"></span></a>Project</h1>
<p>From the gccrs github, "gccrs is a full alternative implementation of the Rust language ontop of GCC with the goal to become fully upstream with the GNU toolchain."</p>
<p>One of the steps to reach its implementation counterpart's parity (rustc) is the support of inline assembly. Enabling this feature allows programmers to work on low level situation where some extra performance is always needed.</p>
<p>An example is where you would want to handle the case of moving 16-bit data when the data is not exactly 64-bit.</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#737994;font-style:italic">// https://github.com/rust-lang/rust/blob/</span></span>
<span class="line"><span style="color:#737994;font-style:italic">// b3df0d7e5ef5f7dbeeca3fb289c65680ad013f87/library/std/src/sys/pal/sgx/abi/</span></span>
<span class="line"><span style="color:#737994;font-style:italic">// usercalls/alloc.rs#L330</span></span>
<span class="line"><span style="color:#CA9EE6">unsafe</span><span style="color:#CA9EE6"> fn</span><span style="color:#8CAAEE;font-style:italic"> copy_quadwords</span><span style="color:#949CBB">(</span><span style="color:#EA999C">src</span><span style="color:#81C8BE">:</span><span style="color:#81C8BE"> *</span><span style="color:#CA9EE6">const</span><span style="color:#CA9EE6"> u8</span><span style="color:#949CBB">,</span><span style="color:#EA999C"> dst</span><span style="color:#81C8BE">:</span><span style="color:#81C8BE"> *</span><span style="color:#CA9EE6">mut</span><span style="color:#CA9EE6"> u8</span><span style="color:#949CBB">,</span><span style="color:#EA999C"> len</span><span style="color:#81C8BE">:</span><span style="color:#CA9EE6"> usize</span><span style="color:#949CBB">)</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#CA9EE6">    unsafe</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#8CAAEE;font-style:italic">        asm!</span><span style="color:#949CBB">(</span></span>
<span class="line"><span style="color:#A6D189">            "rep movsq (%rsi), (%rdi)"</span><span style="color:#949CBB">,</span></span>
<span class="line"><span style="color:#8CAAEE;font-style:italic">            inout</span><span style="color:#949CBB">(</span><span style="color:#A6D189">"rcx"</span><span style="color:#949CBB">)</span><span style="color:#C6D0F5"> len </span><span style="color:#81C8BE">/</span><span style="color:#EF9F76"> 8</span><span style="color:#81C8BE"> =></span><span style="color:#C6D0F5"> _</span><span style="color:#949CBB">,</span></span>
<span class="line"><span style="color:#8CAAEE;font-style:italic">            inout</span><span style="color:#949CBB">(</span><span style="color:#A6D189">"rdi"</span><span style="color:#949CBB">)</span><span style="color:#C6D0F5"> dst </span><span style="color:#81C8BE">=></span><span style="color:#C6D0F5"> _</span><span style="color:#949CBB">,</span></span>
<span class="line"><span style="color:#8CAAEE;font-style:italic">            inout</span><span style="color:#949CBB">(</span><span style="color:#A6D189">"rsi"</span><span style="color:#949CBB">)</span><span style="color:#C6D0F5"> src </span><span style="color:#81C8BE">=></span><span style="color:#C6D0F5"> _</span><span style="color:#949CBB">,</span></span>
<span class="line"><span style="color:#8CAAEE;font-style:italic">            options</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">att_syntax</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> nostack</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> preserves_flags</span><span style="color:#949CBB">)</span></span>
<span class="line"><span style="color:#949CBB">        );</span></span>
<span class="line"><span style="color:#949CBB">    }</span></span>
<span class="line"><span style="color:#949CBB">}</span></span></code></pre>
<p>The project focuses on adding implementation for two built-in Rust macros: <code>asm!()</code>, and <code>global_asm!()</code>.</p>
<p>The gcc compiler will be able to detect parse the assembly code within asm!, and global_asm! macro, converting them to gcc assembly format to eventually generate code.</p>
<h1 id="goals"><a aria-hidden="true" tabindex="-1" href="#goals"><span class="icon icon-link"></span></a>Goals</h1>
<p>This work will require modifications to multiple parts of our compiler, with the creation of built-in macro expanders, AST nodes, HIR nodes, as well as the development of a Rust inline-assembly parser to then convert it to the GCC inline assembly format:</p>
<ul>
<li>Develop a Rust inline assembly parser.</li>
<li>Improve AST inline assembly node.</li>
<li>Construct HIR inline assembly node.</li>
<li>Construct HIR node visitor for the Lowering process.</li>
<li>Implement the HIR -> Generic IL process for inline assembly HIR nodes.</li>
<li>End to test testing of the new gccrs compiler for parity with rustc</li>
</ul>
<h1 id="expected-timeline--responsibitilies"><a aria-hidden="true" tabindex="-1" href="#expected-timeline--responsibitilies"><span class="icon icon-link"></span></a>Expected timeline &#x26; responsibitilies</h1>
<p>The project (coding aspect) is classified as 175 hours (medium) spanning from May 27 to August 26 (3 months or 12 weeks). This equates to 175/12 = 14.58 hours per week, or 2 hours per day.</p>
<p>The first subsection serves as a mini design doc where I explain my timeline and expand to my implementation goals.</p>
<p>The second subsection goes over my schedule and other responsibilities I have over summer and how I plan to counteract that.</p>
<h2 id="expected-timeline"><a aria-hidden="true" tabindex="-1" href="#expected-timeline"><span class="icon icon-link"></span></a>Expected timeline</h2>
<h3 id="week-1-3-may-27---june-17-implement-and-test-the-parser-to-convert-rust-asm-format-to-gcc-asm-format"><a aria-hidden="true" tabindex="-1" href="#week-1-3-may-27---june-17-implement-and-test-the-parser-to-convert-rust-asm-format-to-gcc-asm-format"><span class="icon icon-link"></span></a>WEEK 1-3 (May 27 - June 17): Implement and test the parser to convert rust asm format to gcc asm format.</h3>
<p>Since Rust follows a different convention in calling its assembly than C/C++, I need to parse and capture the information so that in later stages, I can use the information as arguments into one of gccâ€™s available function call regarding inline assembly.
The parser will be a recursive-descent parser, adhering to the ABNF syntax described at <a href="https://doc.rust-lang.org/reference/inline-assembly.html" rel="nofollow" target="_blank">https://doc.rust-lang.org/reference/inline-assembly.html</a></p>
<p>The programmer (me in this case) will need to learn about gccrsâ€™ token stream API, error emitting api (rust_error?), in order to input tokens and process them.</p>
<p>The tests would consist of different scenarios of token streams from valid rust files and the parser should be able to capture all the necessary information from the token streams. For testing, the programmer should consult <a href="https://www.gnu.org/software/dejagnu/manual/index.html" rel="nofollow" target="_blank">https://www.gnu.org/software/dejagnu/manual/index.html</a> and look at relevant test suites</p>
<p>One inspiration for this part would be <a href="https://github.com/rust-lang/rust/blob/master/compiler/rustc_codegen_gcc/src/asm.rs" rel="nofollow" target="_blank">rustc_codegen_gcc/asm.rs</a> to see how the project translates rust inline assembly to gcc inline assembly IR (IR here represents the result after the parser has finished parsing it and the semantics have been transformed (per the <a href="https://github.com/rust-lang/rust/blob/master/compiler/rustc_codegen_gcc/src/asm.rs" rel="nofollow" target="_blank">asm.rs</a> file's comment) and later can be used solely to generate code).</p>
<p>Another one is since rust asm uses formatting with arg, it will be helpful to consider  <a href="https://github.com/rust-lang/rust/blob/master/compiler/rustc_parse_format/src/lib.rs" rel="nofollow" target="_blank">https://github.com/rust-lang/rust/blob/master/compiler/rustc_parse_format/src/lib.rs</a> and see how they work with the formatting logic.</p>
<h3 id="week-4-june-17---june-24-improve-if-possible-asm-ast-in-rust-macro-builtins-implement-asm-hir-and-visitor"><a aria-hidden="true" tabindex="-1" href="#week-4-june-17---june-24-improve-if-possible-asm-ast-in-rust-macro-builtins-implement-asm-hir-and-visitor"><span class="icon icon-link"></span></a>WEEK 4 (June 17 - June 24): Improve (if possible) asm-AST in rust-macro-builtins, implement asm-HIR and visitor</h3>
<p>From <a href="https://github.com/Rust-GCC/gccrs/issues/1566" rel="nofollow" target="_blank">Rust-GCC/gccrs#1566</a>, asm-AST has already been implemented, I am to implement asm-HIR and its visitor instead.</p>
<p>The AST (Abstract syntax tree) is the result of the Rust Inline Assembly Parser. This AST will be transformed to a HIR (High Level Intermediate Representation) through a process called <code>Lowering.</code> This IR helps us perform multiple syntax desugaring, as well as type-checking or borrow checking through the uses of its visitors.</p>
<p>This subpart is done after parsing so that we know what our asm-HIR needs from the parser.</p>
<p>Testing-wise, Iâ€™m not sure there is any testing to be done for this part.</p>
<h3 id="week-5-june-24---july-1-implement-handlers-for-asm-creating-ast-asm-from-a-stream-of-tokens"><a aria-hidden="true" tabindex="-1" href="#week-5-june-24---july-1-implement-handlers-for-asm-creating-ast-asm-from-a-stream-of-tokens"><span class="icon icon-link"></span></a>WEEK 5 (June 24 - July 1): Implement handlers for asm, creating AST asm from a stream of tokens.</h3>
<p>From the available parser, I can use it in conjunction with asm-nodes and asm-AST in rust-macro-builtsin, outputing the asm-AST that I have declared and defined.</p>
<p>No testing on this part.</p>
<h3 id="week-6-7-july-1---july-15-work-with-astlowering-lowering-the-asm-ast-to-hir-high-level-ir"><a aria-hidden="true" tabindex="-1" href="#week-6-7-july-1---july-15-work-with-astlowering-lowering-the-asm-ast-to-hir-high-level-ir"><span class="icon icon-link"></span></a>WEEK 6-7 (July 1 - July 15): Work with ASTLowering, lowering the asm-AST to HIR (high level IR).</h3>
<p>The main classes to deal with are ASTLowering* in the gcc/rust/hir folder. I would create a new class inheriting from ASTLoweringBase and a constructor from asm-AST to deal with lowering the asm-AST.</p>
<h3 id="week-7-8-july-15---july-29-work-with-generic-il-in-compile-converting-hir-to-generic-intermediate-language"><a aria-hidden="true" tabindex="-1" href="#week-7-8-july-15---july-29-work-with-generic-il-in-compile-converting-hir-to-generic-intermediate-language"><span class="icon icon-link"></span></a>WEEK 7-8 (July 15 - July 29): Work with GENERIC IL in Compile*, converting HIR to GENERIC intermediate language.</h3>
<p>The calls to express and create GENERIC tree will be provided via gcc/tree.def. For this part, some helpful definitions are present in gcc/c/c-typeck.cc</p>
<h3 id="week-9-july-29---aug-5-end-to-end-testing"><a aria-hidden="true" tabindex="-1" href="#week-9-july-29---aug-5-end-to-end-testing"><span class="icon icon-link"></span></a>WEEK 9 (July 29 - Aug 5): End-to-end testing.</h3>
<p>Introduce end-to-end testing and fix all relevant bugs.</p>
<p>The required testing involves testing existing inline assembly invocations taken directly from the Rust standard library, as well as testcases from rustc.</p>
<h3 id="week-11-12-aug-5---19-spare-time-allocation-for-different-parts-of-projects"><a aria-hidden="true" tabindex="-1" href="#week-11-12-aug-5---19-spare-time-allocation-for-different-parts-of-projects"><span class="icon icon-link"></span></a>WEEK 11-12 (Aug 5 - 19): Spare time allocation for different parts of projects.</h3>
<p>2 week of free time will be allocated to different aspect of the project.</p>
<h3 id="week-10-aug-19---aug-26-report-and-documentation"><a aria-hidden="true" tabindex="-1" href="#week-10-aug-19---aug-26-report-and-documentation"><span class="icon icon-link"></span></a>WEEK 10 (Aug 19 - Aug 26): Report and Documentation</h3>
<p>I will finish up my report and documentation before submission of my project.</p>
<h2 id="responsibitiles-and-my-schedule"><a aria-hidden="true" tabindex="-1" href="#responsibitiles-and-my-schedule"><span class="icon icon-link"></span></a>Responsibitiles and my schedule.</h2>
<h3 id="university"><a aria-hidden="true" tabindex="-1" href="#university"><span class="icon icon-link"></span></a>University</h3>
<p>My university spring semester ends on Friday, May 10, 2024 with my final exam on May 9.</p>
<p>My university fall semester usually begins on August 23.</p>
<p>My fall semester coursework will (likely) be:</p>
<ul>
<li>CS 265. Compiler Optimization and Code Generation (3 Units) (Grad)</li>
<li>CS 189: Introduction to Machine Learning (4 Units) (Ugrad)</li>
<li>CS 170: Efficient Algorithms and Intractable Problems (4 Units) (Ugrad)</li>
</ul>
<h3 id="internship"><a aria-hidden="true" tabindex="-1" href="#internship"><span class="icon icon-link"></span></a>Internship</h3>
<p>I have an offer where the starting date will be end of May - early June and the ending date will be on the second week of August.</p>
<p>I will be working on the project over the course of May to August 26.</p>
<p>If I am unable to complete the project's goals, I will make sure to discuss an extension with my mentors at the earliest possible.</p>
<p>Such detailed timeline coupled with comprehensive design document is to ensure my progress is consistent throughout.</p>
<h1 id="design-doc"><a aria-hidden="true" tabindex="-1" href="#design-doc"><span class="icon icon-link"></span></a>Design doc</h1>
<p>The design doc is to help me plan out ahead my implementation and discuss them with my mentor.</p>
<h2 id="lexer--parser-implementation"><a aria-hidden="true" tabindex="-1" href="#lexer--parser-implementation"><span class="icon icon-link"></span></a>Lexer &#x26; Parser implementation</h2>
<h3 id="grammar"><a aria-hidden="true" tabindex="-1" href="#grammar"><span class="icon icon-link"></span></a>Grammar</h3>
<p>The BNF grammar for the inline assembly is</p>
<pre><code>format_string := STRING_LITERAL / RAW_STRING_LITERAL
dir_spec := "in" / "out" / "lateout" / "inout" / "inlateout"
reg_spec := &#x3C;register class> / "\"" &#x3C;explicit register> "\""
operand_expr := expr / "_" / expr "=>" expr / expr "=>" "_"
reg_operand := [ident "="] dir_spec "(" reg_spec ")" operand_expr
clobber_abi := "clobber_abi(" &#x3C;abi> *("," &#x3C;abi>) [","] ")"
option := "pure" / "nomem" / "readonly" / "preserves_flags" /
        "noreturn" / "nostack" / "att_syntax" / "raw"
options := "options(" option *("," option) [","] ")"
operand := reg_operand / clobber_abi / options
asm := "asm!(" format_string *("," format_string)
    *("," operand) [","] ")"
global_asm := "global_asm!(" format_string
    *("," format_string) *("," operand) [","] ")"

end := asm | global_asm
</code></pre>
<p>where the end result will be an <code>end</code>.</p>
<h3 id="implementation"><a aria-hidden="true" tabindex="-1" href="#implementation"><span class="icon icon-link"></span></a>Implementation</h3>
<p>The lexer I'll be using on this part will be the <code>MacroInvocLexer</code> via <code>MacroInvocLexer lex (invoc.get_delim_tok_tree ().to_token_stream ());</code>. It serves as a parameter for my parser like
<code>Parser&#x3C;MacroInvocLexer> parser (lex);</code></p>
<p>With the parser called <code>p</code>, I can call the methods in <code>gcc/rust/parse/rust-parse.h</code> on the parser to perform some recursive descent logic.</p>
<h2 id="rust-asm-ast-hir-and-visitor"><a aria-hidden="true" tabindex="-1" href="#rust-asm-ast-hir-and-visitor"><span class="icon icon-link"></span></a>rust asm-ast, HIR, and visitor</h2>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#737994;font-style:italic">// Namespace HIR</span></span>
<span class="line"><span style="color:#737994;font-style:italic">// In rust-hir-exp.h</span></span>
<span class="line"><span style="color:#C6D0F5">InlineAsm : ExprWithoutBlock </span><span style="color:#949CBB">{</span></span>
<span class="line"><span style="color:#C6D0F5">    ...</span></span>
<span class="line"><span style="color:#949CBB">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#737994;font-style:italic">// in rust-hir.cc</span></span>
<span class="line"><span style="color:#CA9EE6">void</span><span style="color:#E5C890"> InlineAsm</span><span style="color:#949CBB">::</span><span style="color:#8CAAEE;font-style:italic">accept</span><span style="color:#949CBB">(</span><span style="color:#E5C890;font-style:italic">HIRExpressionVisitor</span><span style="color:#81C8BE"> &#x26;</span><span style="color:#EA999C;font-style:italic">vis</span><span style="color:#949CBB">)</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#C6D0F5">    vis</span><span style="color:#949CBB">.</span><span style="color:#8CAAEE;font-style:italic">visit</span><span style="color:#949CBB"> (</span><span style="color:#81C8BE">*</span><span style="color:#E78284">this</span><span style="color:#949CBB">);</span></span>
<span class="line"><span style="color:#949CBB">}</span></span></code></pre>
<p>The visitor for HIR::InlineAsm is HIRExpressionVisitor.</p>
<h2 id="asm-handlers"><a aria-hidden="true" tabindex="-1" href="#asm-handlers"><span class="icon icon-link"></span></a>asm-handlers</h2>
<p>I need to add two entries which are the handler functions to the <code>gcc/rust/expand/rust-macro-builtins.cc</code>'s <code>MacroBuiltin::builtin_transcribers</code> and remove the <code>llvm_asm</code> key from the map.</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#949CBB">{</span><span style="color:#A6D189">"asm"</span><span style="color:#949CBB">,</span><span style="color:#E5C890"> MacroBuiltin</span><span style="color:#949CBB">::</span><span style="color:#C6D0F5">asm_handler</span><span style="color:#949CBB">},</span></span>
<span class="line"><span style="color:#949CBB">{</span><span style="color:#A6D189">"llvm_asm"</span><span style="color:#949CBB">,</span><span style="color:#E5C890"> MacroBuiltin</span><span style="color:#949CBB">::</span><span style="color:#C6D0F5">sorry</span><span style="color:#949CBB">},</span><span style="color:#737994;font-style:italic"> // Remove this.</span></span>
<span class="line"><span style="color:#949CBB">{</span><span style="color:#A6D189">"global_asm"</span><span style="color:#949CBB">,</span><span style="color:#E5C890"> MacroBuiltin</span><span style="color:#949CBB">::</span><span style="color:#C6D0F5">global_asm_handler</span><span style="color:#949CBB">},</span></span></code></pre>
<p>I also need to define the two handlers in <code>gcc/rust/expand/rust-macro-builtins.h</code>. They both will</p>
<ul>
<li>Call the parser I implement in the previous part, get the AST::asm from it.</li>
<li>Transform the <code>AST::asm</code> node to an <code>AST::Fragment</code></li>
<li>Return the <code>AST::Fragment</code>.</li>
</ul>
<p>An <code>AST::Fragment</code> is an AST that can be incorporated back to the AST produced by the general parser. The main reasoning for not returning the <code>AST::asm</code> but instead opting for <code>AST::Fragment</code> is because of the process described by <a href="https://github.com/rust-lang/rustc-dev-guide/blob/master/src/macro-expansion.md" rel="nofollow" target="_blank">https://github.com/rust-lang/rustc-dev-guide/blob/master/src/macro-expansion.md</a></p>
<h2 id="astlowering"><a aria-hidden="true" tabindex="-1" href="#astlowering"><span class="icon icon-link"></span></a>ASTLowering</h2>
<h2 id="converting-hir-to-generic-intermediate-language"><a aria-hidden="true" tabindex="-1" href="#converting-hir-to-generic-intermediate-language"><span class="icon icon-link"></span></a>Converting HIR to GENERIC intermediate language</h2>
<p>Document for GENERIC asm is at <a href="https://gcc.gnu.org/onlinedocs/gccint/Basic-Statements.html" rel="nofollow" target="_blank">GENERIC</a>.</p>
<p>In gcc/c/c-typeck.cc, there is the provided build_asm_expr which I can use to generate GENERIC</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">tree</span></span>
<span class="line"><span style="color:#8CAAEE;font-style:italic">build_asm_expr</span><span style="color:#949CBB"> (</span><span style="color:#E5C890;font-style:italic">location_t</span><span style="color:#EA999C;font-style:italic"> loc</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> tree </span><span style="color:#EA999C;font-style:italic">string</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> tree </span><span style="color:#EA999C;font-style:italic">outputs</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> tree </span><span style="color:#EA999C;font-style:italic">inputs</span><span style="color:#949CBB">,</span></span>
<span class="line"><span style="color:#C6D0F5">		tree </span><span style="color:#EA999C;font-style:italic">clobbers</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> tree </span><span style="color:#EA999C;font-style:italic">labels</span><span style="color:#949CBB">,</span><span style="color:#CA9EE6"> bool</span><span style="color:#EA999C;font-style:italic"> simple</span><span style="color:#949CBB">,</span><span style="color:#CA9EE6"> bool</span><span style="color:#EA999C;font-style:italic"> is_inline</span><span style="color:#949CBB">);</span></span></code></pre>
<p>There are also some macro definitions in <code>gcc/tree.h</code> that are helpful in manipulating tree expr.</p>
<p>For example, from line 1381 to 1385</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#737994;font-style:italic">/* ASM_EXPR accessors. ASM_STRING returns a STRING_CST for the</span></span>
<span class="line"><span style="color:#737994;font-style:italic">   instruction (e.g., "mov x, y"). ASM_OUTPUTS, ASM_INPUTS, and</span></span>
<span class="line"><span style="color:#737994;font-style:italic">   ASM_CLOBBERS represent the outputs, inputs, and clobbers for the</span></span>
<span class="line"><span style="color:#737994;font-style:italic">   statement.  */</span></span>
<span class="line"><span style="color:#E5C890">#define</span><span style="color:#8CAAEE;font-style:italic"> ASM_STRING</span><span style="color:#949CBB">(</span><span style="color:#EA999C;font-style:italic">NODE</span><span style="color:#949CBB">)</span><span style="color:#8CAAEE;font-style:italic">        TREE_OPERAND</span><span style="color:#949CBB"> (</span><span style="color:#8CAAEE;font-style:italic">ASM_EXPR_CHECK</span><span style="color:#949CBB"> (</span><span style="color:#C6D0F5">NODE</span><span style="color:#949CBB">),</span><span style="color:#EF9F76"> 0</span><span style="color:#949CBB">)</span></span>
<span class="line"><span style="color:#E5C890">#define</span><span style="color:#8CAAEE;font-style:italic"> ASM_OUTPUTS</span><span style="color:#949CBB">(</span><span style="color:#EA999C;font-style:italic">NODE</span><span style="color:#949CBB">)</span><span style="color:#8CAAEE;font-style:italic">       TREE_OPERAND</span><span style="color:#949CBB"> (</span><span style="color:#8CAAEE;font-style:italic">ASM_EXPR_CHECK</span><span style="color:#949CBB"> (</span><span style="color:#C6D0F5">NODE</span><span style="color:#949CBB">),</span><span style="color:#EF9F76"> 1</span><span style="color:#949CBB">)</span></span>
<span class="line"><span style="color:#E5C890">#define</span><span style="color:#8CAAEE;font-style:italic"> ASM_INPUTS</span><span style="color:#949CBB">(</span><span style="color:#EA999C;font-style:italic">NODE</span><span style="color:#949CBB">)</span><span style="color:#8CAAEE;font-style:italic">        TREE_OPERAND</span><span style="color:#949CBB"> (</span><span style="color:#8CAAEE;font-style:italic">ASM_EXPR_CHECK</span><span style="color:#949CBB"> (</span><span style="color:#C6D0F5">NODE</span><span style="color:#949CBB">),</span><span style="color:#EF9F76"> 2</span><span style="color:#949CBB">)</span></span>
<span class="line"><span style="color:#E5C890">#define</span><span style="color:#8CAAEE;font-style:italic"> ASM_CLOBBERS</span><span style="color:#949CBB">(</span><span style="color:#EA999C;font-style:italic">NODE</span><span style="color:#949CBB">)</span><span style="color:#8CAAEE;font-style:italic">      TREE_OPERAND</span><span style="color:#949CBB"> (</span><span style="color:#8CAAEE;font-style:italic">ASM_EXPR_CHECK</span><span style="color:#949CBB"> (</span><span style="color:#C6D0F5">NODE</span><span style="color:#949CBB">),</span><span style="color:#EF9F76"> 3</span><span style="color:#949CBB">)</span></span>
<span class="line"><span style="color:#E5C890">#define</span><span style="color:#8CAAEE;font-style:italic"> ASM_LABELS</span><span style="color:#949CBB">(</span><span style="color:#EA999C;font-style:italic">NODE</span><span style="color:#949CBB">)</span><span style="color:#8CAAEE;font-style:italic">	    TREE_OPERAND</span><span style="color:#949CBB"> (</span><span style="color:#8CAAEE;font-style:italic">ASM_EXPR_CHECK</span><span style="color:#949CBB"> (</span><span style="color:#C6D0F5">NODE</span><span style="color:#949CBB">),</span><span style="color:#EF9F76"> 4</span><span style="color:#949CBB">)</span></span></code></pre>
<p>Another point worth mentioning that since these ASM accessors are nothing but STRING_CST, it would be helpful to be able to determine how to build a STRING_CST. The detailed documentation in <code>gcc/tree.cc</code> is:</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#737994;font-style:italic">/* Return a newly constructed STRING_CST node whose value is the LEN</span></span>
<span class="line"><span style="color:#737994;font-style:italic">   characters at STR when STR is nonnull, or all zeros otherwise.</span></span>
<span class="line"><span style="color:#737994;font-style:italic">   Note that for a C string literal, LEN should include the trailing NUL.</span></span>
<span class="line"><span style="color:#737994;font-style:italic">   The TREE_TYPE is not initialized.  */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C6D0F5">tree</span></span>
<span class="line"><span style="color:#8CAAEE;font-style:italic">build_string</span><span style="color:#949CBB"> (</span><span style="color:#CA9EE6">unsigned</span><span style="color:#EA999C;font-style:italic"> len</span><span style="color:#949CBB">,</span><span style="color:#CA9EE6"> const</span><span style="color:#CA9EE6"> char</span><span style="color:#81C8BE"> *</span><span style="color:#C6D0F5">str</span><span style="color:#737994;font-style:italic"> /*= NULL */</span><span style="color:#949CBB">)</span><span style="color:#949CBB"> {</span><span style="color:#C6D0F5">...</span><span style="color:#949CBB">}</span></span></code></pre>
<h1 id="introduce-myself-my-skills-and-accomplishments"><a aria-hidden="true" tabindex="-1" href="#introduce-myself-my-skills-and-accomplishments"><span class="icon icon-link"></span></a>Introduce myself, my skills and accomplishments</h1>
<h2 id="information"><a aria-hidden="true" tabindex="-1" href="#information"><span class="icon icon-link"></span></a>Information</h2>
<p>Name: Jasmine Tang</p>
<p>Email (personal): <a href="mailto:tanghocle456@gmail.com">tanghocle456@gmail.com</a></p>
<p>Email (personal): <a href="mailto:thisisjjasmine@gmail.com">thisisjjasmine@gmail.com</a></p>
<p>Email (University): <a href="mailto:jjasmine@berkeley.edu">jjasmine@berkeley.edu</a></p>
<p>GitHub: <a href="https://github.com/badumbatish" rel="nofollow" target="_blank">badumbatish</a></p>
<p>Resume (continually updated): <a href="https://www.overleaf.com/read/bzvddqdhfdqp#fb6509" rel="nofollow" target="_blank">https://www.overleaf.com/read/bzvddqdhfdqp#fb6509</a></p>
<p>University: University of California Berkeley</p>
<h2 id="about-myself"><a aria-hidden="true" tabindex="-1" href="#about-myself"><span class="icon icon-link"></span></a>About myself</h2>
<p>Hi everyone, Iâ€™m Jasmine. Iâ€™m currently a junior undergraduate at UC Berkeley majoring in EECS. This semester, I am taking an undergraduate compiler and will be taking a grad class about code optimization this upcoming Fall.</p>
<p>Iâ€™ve been programming in C, C++, Python, Java, Rust, mainly C/C++ and have done projects in relation to C++ and compilers</p>
<p>Regarding compilers,  one of my projects include building a Scheme (Lisp dialect) Interpreter with recursive descent parsing in Python. As a semester-long class project, I am also building a ChocoPy compiler (a statically-typed subset of Python) with Javaâ€™s lexer and Javaâ€™s LALR(1) parser generator, writing passes for semantic checking and type-checking, as well as generating RISC-V assembly code. I just recently finished the LLVMâ€™s Kaleidoscope tutorial and am trying to refactor the LLVM-based compiler as my own hobby project; currently I have gotten lexing and parsing refactored.</p>
<p>Iâ€™ve also done a number of projects related to C/C++. Some includes reimplementing std::vector with the standard allocator. As another semester-long class project, Iâ€™m working on PintOS, an educational operating system, adding support for syscalls, multiprocessing and multithreading and file systems.</p>
<h2 id="my-contribution-to-gccrs"><a aria-hidden="true" tabindex="-1" href="#my-contribution-to-gccrs"><span class="icon icon-link"></span></a>My contribution to gccrs</h2>
<p>I want to preface this by saying all of this contribution would not be possible if not for my potential mentor Arthur.</p>
<p>I joined gccrs' Zulip channel in late febuary / early March and since have put in some pull requests for the repository as well as contributed an ARM-based Ubuntu Docker image tailored to development of gccrs with persistent storage settings and different hotswappable versions of the image via docker compose at <a href="https://github.com/badumbatish/gccrs-workspace" rel="nofollow" target="_blank">https://github.com/badumbatish/gccrs-workspace</a>.</p>
<p>My first contribution was adding tl::optional typing to MacroBuiltin map, a data structure I need to familiar with for this project.</p>
<p>The second contribution was to refactor all macro handlers into different themes to ease navigation and development.</p>
<p>For the third and fourth one, I fixed a error emitting bug when late-resolving an id expression and fixed visibility storage from parsing ExternalTypeItem until HIR construction.</p>
<p>Please feel free to see a list of my pull requests to gccrs at <a href="https://github.com/Rust-GCC/gccrs/pulls?q=is%3Apr+author%3Abadumbatish+" rel="nofollow" target="_blank">https://github.com/Rust-GCC/gccrs/pulls?q=is%3Apr+author%3Abadumbatish+</a></p>
<p>or by putting <code>is:pr author:badumbatish</code> in the pull request search bar.</p>
<p>or by selecting <code>badumbatish</code> as author in mobile.</p>6:["$","div",null,{"className":"py-12 flex flex-col items-center  justify-items-start mx-auto ","children":[["$","$L2",null,{"href":"/blog","className":"flex justify-center text-4xl","children":["$","h2",null,{"children":"My blog"}]}],["$","article",null,{"className":"p-8 prose pt-0.5 max-w-none w-full lg:w-1/2 md:w-4/6 sm:w-5/6 prose-sky mx-auto","children":[["$","div",null,{"className":"flex justify-center text-2xl font-bold ","children":["$","h2",null,{"children":"jjasmineâ€™s Gsoc GCCRS proposal"}]}],["$","div",null,{"className":"flex justify-start text-xl font-bold underline","children":["$","h4",null,{"children":"2025-02-25"}]}],["$","div",null,{"dangerouslySetInnerHTML":{"__html":"$11"}}]]}]]}]
a:{"metadata":[["$","title","0",{"children":"jjasmineâ€™s Gsoc GCCRS proposal"}],["$","meta","1",{"name":"description","content":"Jasmine revealed her self-hosted 2024 GSoc proposal for 'Getting into GSoc how?' and LinkedIn article"}],["$","link","2",{"rel":"icon","href":"/_next/static/media/pfp5.0daa0f7d.jpeg"}],["$","$L12","3",{}]],"error":null,"digest":"$undefined"}
f:"$a:metadata"
