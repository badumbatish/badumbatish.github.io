<!DOCTYPE html><!--QBXzGDkfmMcPbkr9Jh_4l--><html lang="en" class="px-4 py-4"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/7385e8d9d3c5518f-s.p.ttf" as="font" crossorigin="" type="font/ttf"/><link rel="stylesheet" href="/_next/static/css/3b37cf79ceb9ce8f.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/3864b451a61e4546.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-47bbed6067fe1d45.js"/><script src="/_next/static/chunks/4bd1b696-cf72ae8a39fa05aa.js" async=""></script><script src="/_next/static/chunks/964-05defa3e0b8af640.js" async=""></script><script src="/_next/static/chunks/main-app-98bd3314d8e089b7.js" async=""></script><script src="/_next/static/chunks/874-437a265a67d6cfee.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bid%5D/page-f0f7551128d4c13f.js" async=""></script><script src="/_next/static/chunks/63-63ed21df6f1fc3e7.js" async=""></script><script src="/_next/static/chunks/app/layout-05e345a4cd50b3e1.js" async=""></script><meta name="next-size-adjust" content=""/><title>[HIATUS] Going to the gym with MLIR: Linear register allocation for ... a stackless virtual machine?</title><meta name="description" content="Jasmine plans out register allocation for the DEX recompiler."/><link rel="icon" href="/_next/static/media/pfp5.0daa0f7d.jpeg"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__className_d4e0c8 flex flex-col min-h-screen"><div hidden=""><!--$--><!--/$--></div><a href="/"><div class="flex justify-center items-center py-4 "><h1 class="text-4xl font-bold">Jasmine Tang</h1></div></a><div class="flex-1"><div class="py-12 flex flex-col items-center  justify-items-start mx-auto "><a class="flex justify-center text-4xl" href="/blog"><h2>My blog</h2></a><article class="p-8 prose pt-0.5 max-w-none w-full lg:w-1/2 md:w-4/6 sm:w-5/6 prose-sky mx-auto"><div class="flex justify-center text-2xl font-bold "><h2>[HIATUS] Going to the gym with MLIR: Linear register allocation for ... a stackless virtual machine?</h2></div><div class="flex justify-start text-xl font-bold underline"><h4>2025-01-16</h4></div><div><nav class="toc"><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#prologue">Prologue</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#reader-supporting-section">Reader supporting section</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#introduction">Introduction</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#differences">Differences</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#steps">Steps</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#phis-in-register-allocation-41">Phis in register allocation (4.1)</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#topo-blocks-and-numbering-42">Topo blocks and numbering (4.2)</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#building-live-intervals-43">Building live intervals (4.3)</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#coalescing-arguments">Coalescing arguments</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#assigning-registers">Assigning registers</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#obstacles">Obstacles</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#resources">Resources</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#papers">Papers</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#textbooks">Textbooks</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#ai-tools">AI tools</a></li></ol></li></ol></nav><p><a href="https://www.youtube.com/watch?v=zAgVtzhjfCA&#x26;ab_channel=SabrinaCarpenter-Topic" rel="nofollow" target="_blank">Please, please, please</a> don't read
it now. It's unfinished, and I'm not sure if it'll go into impl or design doc :)</p>
<h2 id="prologue"><a aria-hidden="true" tabindex="-1" href="#prologue"><span class="icon icon-link"></span></a>Prologue</h2>
<p>Hi everyone, I hope everybody's been great :) I hope you like my last report for my graduate class <a href="https://badumbatish.github.io/posts/going_to_mlir_gym_1" rel="nofollow" target="_blank">here</a>. This article is also related to the same project. It
discusses the
SSA linear scan
register
allocation algorithm and the steps taken to implement it.</p>
<p>Just like the last MLIR report post, I also include a supporting section (<strong>SS</strong>) right before the introduction for
unfamiliar
reader in the compiler space.</p>
<p>Without reading the SS, I assume interested readers are familiar with some basic middle-end IR concepts (e.g <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ϕ</span></span></span></span>
notation, liveness analysis, loops).</p>
<p>With reading the SS, there is some context from the last report's <a href="https://badumbatish.github.io/posts/going_to_mlir_gym_1#reader-supporting-section" rel="nofollow" target="_blank">SS</a> that I think would be helpful.</p>
<p>And as is tradition, I also wanna share a <a href="https://www.youtube.com/watch?v=5HFyoxqUi0g&#x26;ab_channel=CROWONHYENAS" rel="nofollow" target="_blank">song</a> for
you to listen to while reading. Initially it was between this song and <a href="https://www.youtube.com/watch?v=eW6f7mEXfPQ&#x26;ab_channel=HipHopDXAsia" rel="nofollow" target="_blank">that</a> song. What can I say? I guess this is a long form way to say I want you to listen to
both :)</p>
<p>I hope everybody enjoys :)</p>
<h2 id="reader-supporting-section"><a aria-hidden="true" tabindex="-1" href="#reader-supporting-section"><span class="icon icon-link"></span></a>Reader supporting section</h2>
<p></p><details><summary>Open Reader supporting section</summary><p></p>
<ul>
<li>
<p>Dominance: In a CFG, with the entry basic block <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><msub><mi>B</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">BB_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and any two basic block A and B, if all paths from
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><msub><mi>B</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">BB_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> to B goes through A, then A is said to dominate B. The notation for dominance is A
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≫</mo></mrow><annotation encoding="application/x-tex">\gg</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">≫</span></span></span></span> B and every node is said to dominate itself.</p>
</li>
<li>
<p>Dataflow analysis: Abstractly, dataflow analysis is a way to understand how data moves and changes throughout a
computer program.
It helps us track what happens to different values (like variables) as the program runs from start to finish.</p>
</li>
</ul>
<p>For example, when <a href="https://en.wikipedia.org/wiki/Reaching_definition" rel="nofollow" target="_blank">reaching definition</a> is
run, the compiler can detect if some variable is possibly uninitialized and warn us if such cases appear:</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#737994;font-style:italic">// Just an example for reaching definition.</span></span>
<span class="line"><span style="color:#CA9EE6">fn</span><span style="color:#8CAAEE;font-style:italic"> reaching_def_example</span><span style="color:#949CBB">(</span><span style="color:#EA999C">condition</span><span style="color:#81C8BE">:</span><span style="color:#E5C890;font-style:italic"> bool</span><span style="color:#949CBB">)</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#CA9EE6">    let</span><span style="color:#C6D0F5"> x</span><span style="color:#81C8BE">:</span><span style="color:#CA9EE6"> i32</span><span style="color:#949CBB">;</span><span style="color:#737994;font-style:italic"> // x is declared but not initialized</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CA9EE6">    if</span><span style="color:#C6D0F5"> condition </span><span style="color:#949CBB">{</span><span style="color:#737994;font-style:italic"> // if this `if` condition is `false`,</span></span>
<span class="line"><span style="color:#C6D0F5">       x </span><span style="color:#81C8BE">=</span><span style="color:#EF9F76"> 5</span><span style="color:#949CBB">;</span><span style="color:#737994;font-style:italic">      // `x` is not initialized</span></span>
<span class="line"><span style="color:#949CBB">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8CAAEE;font-style:italic">    println!</span><span style="color:#949CBB">(</span><span style="color:#A6D189">"</span><span style="color:#949CBB">{}</span><span style="color:#A6D189">"</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> x</span><span style="color:#949CBB">);</span><span style="color:#737994;font-style:italic"> // Warning: x might be uninitialized</span></span>
<span class="line"><span style="color:#737994;font-style:italic">                      // if condition is false</span></span>
<span class="line"><span style="color:#949CBB">}</span></span></code></pre>
<ul>
<li>Loop header: In hand with dominance, a block is said to be a loop header if it dominates one of its
predecessors (a block that points to it). Knowing what a loop header is, and later identifying it would be of great
help in
our live intervals (of our linear register allocator) construction. As in the paper by Wimmer and Franz, their live
intervals construction bypasses the dataflow analysis cost itself, simply on the concept of dominance and loop header.</li>
</ul>
<p>Before heading further, let's look at an example for the two concepts.</p>
<p>In this control flow graph, A dominates every BB, including itself.
B dominates D; even though there is a path from
D to B, it must have first passed from B first. Since B dominates its predecessor, B is a loop header; hence,
there is a loop :)</p>
<p>D is:
<img src="/blogs/dominance_mlir_gym_2.svg" alt="dominance_mlir_gym_2.svg"></p>
<ul>
<li>Live interval and Live ranges pre-notes: Different papers derive the meaning of a live range differently. For example,
in Engineering a
Compiler 2nd Edition pg. 690, live range is a closed set of pairs of use and def locations. In Mössenböck &#x26;
Pfeiffer, the roughly same definition is dedicated to <code>live intervals</code>, leaving the meaning of <code>range</code> to just mean
a pair of <code>use</code> and <code>def</code>. I chose to follow the definition laid out by Mössenböck &#x26; Pfeiffer where a live interval
contains an ordered list of live ranges. [todo, add some example here, or the next two section?]</li>
</ul>
<p>For example:</p>
<pre><code>// Add an example here pleaseeeeeeeee >,&#x3C;

</code></pre>
<p>Overall, the concepts were born to ease the job of register allocators. If some variables are not live anymore
(since their definitions), their registers can be reused for another variable instead. In this view, contention for a
register (a scarce resource)
between some variables can instead be seen as the intersection (or lack thereof) between different live ranges. In
this effect, at the register allocation phase, the compiler effective translates the tradition SSA variable naming
scheme into a set of live intervals.</p>
<p>Hopefully, after
reading the two (closely related) definitions and seeing how they're defined to solve the same problem, we've cleared
up the
confusion.</p>
<ul>
<li>Terminologies: in this article, sometimes I refer to SSA variables as mlir::Value. This boils down to the same
concept: a variable that is defined only once (and cannot be changed).</li>
</ul>
<p></p></details><p></p>
<h2 id="introduction"><a aria-hidden="true" tabindex="-1" href="#introduction"><span class="icon icon-link"></span></a>Introduction</h2>
<p>todo: refer to this <a href="https://ieeexplore.ieee.org/document/7924389" rel="nofollow" target="_blank">https://ieeexplore.ieee.org/document/7924389</a>
Register allocation is an important aspect in the compiler construction phase.
Registers being the fastest
(but most limited) in the memory hierarchy, the compiler's register allocator must be strategic about this
resource, more usages in registers instead of the stack means reduced latency and
improved execution speed.</p>
<p>In the case of our recompiler, the main motivation related to obfuscation. <a href="https://farena.in/" rel="nofollow" target="_blank">Edu</a>'s employer,
<a href="https://www.quarkslab.com/" rel="nofollow" target="_blank">Quarkslab</a> is interested in applying obfuscation method to DEX files. With the methods
generating a lot of virtual registers, there were concerns about it exceeding the limit of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>16</mn></msup><mo>=</mo><mn>65</mn><mo separator="true">,</mo><mn>536</mn></mrow><annotation encoding="application/x-tex">2^{16} = 65,536</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">16</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">65</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">536</span></span></span></span> virtual
registers. In this case, the linear register allocation project helps bring down the number of virtual registers under
the limit (of course they can just run less obfuscation hahahah).</p>
<p>This article then draws the learning mainly from three sources: the text book Engineer a Compiler, and two papers
from Mössenböck &#x26; Pfeiffer <a href="https://link.springer.com/content/pdf/10.1007/3-540-45937-5_17.pdf" rel="nofollow" target="_blank">MP02</a> and Wimmer &#x26; Franz <a href="http://www.christianwimmer.at/Publications/Wimmer10a/Wimmer10a.pdf" rel="nofollow" target="_blank">WF10</a>.</p>
<p>Personally, this is also another opportunity for me to improve my compiler arsenal. Some undergraduate compiler
classes leave this part out or only as part of a pen and paper exercise; knowing how to perform register allocation
(and writing about it)
would be a big push in the direction.</p>
<p>All discussed concepts are driven from the links in the resources section.</p>
<h2 id="differences"><a aria-hidden="true" tabindex="-1" href="#differences"><span class="icon icon-link"></span></a>Differences</h2>
<p>We're planning to improve the lowering of MjolnIR to smali. What this means is that instead of lowering directly
from SSA variables to virtual registers with
<span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#CA9EE6">template</span><span style="color:#949CBB">&#x3C;</span><span style="color:#CA9EE6">class</span><span style="color:#E5C890;font-style:italic"> Aspect</span><span style="color:#949CBB">></span><span style="color:#CA9EE6"> class</span><span style="color:#E5C890;font-style:italic"> SmaliCounter</span></span></code></span>, we lower indirectly with our register
allocation, first translating them into the namespace of live intervals first, then down to virtual registers.</p>
<p>More specifically, we'll :</p>
<ul>
<li>Produce live intervals from ssa values and their uses and defs.</li>
<li>Optionally merge <code>compatible</code> live intervals together (the process is called coalescing).</li>
<li>Lower down to virtual registers.</li>
</ul>
<p>This new process introduces new stages that are clearly described and compared through this diagram.</p>
<p>[todo add mermaid here]</p>
<h2 id="steps"><a aria-hidden="true" tabindex="-1" href="#steps"><span class="icon icon-link"></span></a>Steps</h2>
<p>To say that linear register allocation simply comprises 3 steps is a simplification. The three big steps eventually
break down into substeps when a reader starts asking these questions of the sort: Where and how do
we get our live intervals? How do we map SSA value to a said interval? What mechanics helps us merge <code>compatible</code>? How is
MLIR helping here? We'll</p>
<ul>
<li>First discuss the problem of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ϕ</span></span></span></span> in the context of live intervals.</li>
<li>Number the mlir operation via the topological ordering of basic blocks.</li>
<li>Construct our live intervals.</li>
<li>Coalesce</li>
<li>Translate to virtual registers, during this time we might split intervals to produce what is called live holes.</li>
</ul>
<p>It is important to note that although I follow the MP02 paper, some recaps for WF10 will also be noted.</p>
<h2 id="phis-in-register-allocation-41"><a aria-hidden="true" tabindex="-1" href="#phis-in-register-allocation-41"><span class="icon icon-link"></span></a>Phis in register allocation (4.1)</h2>
<p>The (natural) nuisance of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ϕ</span></span></span></span>s is rooted in the idea of false registers contention. If two basic blocks <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">B_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">B_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> with their respective SSA
variables <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">b_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">b_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> both connect at basic block <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span> with the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϕ</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">\phi_{c}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">ϕ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, the two SSA variables (and the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ϕ</span></span></span></span>)
all refers to the same entity. In this case, even though the live range of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">b_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">b_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> clashes together,
they should still share the same register.</p>
<p>To navigate this, we often perform a preprocessing step called copy generation or move generation: add a proxy move instruction
and introduce new SSA variables to make sure that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">b_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">b_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> doesn't clash anymore, then perform a step called register coalesce to join them together.</p>
<p>In this context, different papers (MP02 and WF10) handle this problem differently in terms of preprocessing the graph.
Expectedly, the two papers made
no mention of MLIR (of course hahaa).</p>
<p>Idea: The idea is that in MLIR, we can use MjolnIR's move op on these.</p>
<p>these <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">b_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">b_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is the resulting
operands of
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">B_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">B_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>'s terminators and
that when the control flows to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>, their representation turns into <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϕ</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">\phi_{c}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">ϕ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>. Simply put, we can focus on
generating the virtual registers for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϕ</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">\phi_{c}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">ϕ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and produce redundant moves as the first step for the algorithm.</p>
<p>todo: show the graph of B1 and B2 flowing into C.
todo: discuss Brock and then wimmer.</p>
<h2 id="topo-blocks-and-numbering-42"><a aria-hidden="true" tabindex="-1" href="#topo-blocks-and-numbering-42"><span class="icon icon-link"></span></a>Topo blocks and numbering (4.2)</h2>
<p>In order for a live range to make sense, we need to know where (or when) does an SSA value start living and where (or when)
does an SSA value ends its life. To do this, we need to number the instruction topologically.</p>
<p>In linear scan register allocation, after we have handled our <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ϕ</span></span></span></span>s as prescribed above, we then flatten the CFG
into a list of
basic blocks topologically. In a DAG, this reduces to Reverse Post Order traversal, or RPO for short.</p>
<p>The reason for this is todo: numbering the op</p>
<p>In both the MP02 and the
WF10 paper, this is achieved with an ordered list based on the BB's dominance. I should also note here that
ordered (in layperson terms)
means that if
block A arrives before block B, then block B cannot dominate block A.</p>
<p>Since the topological ordering of the graph naturally lends itself to a dominance ordered list, MLIR itself shows
its definition for <span class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#E5C890">mlir</span><span style="color:#949CBB">::</span><span style="color:#C6D0F5">getBlocksSortedByDominance</span></span></code></span> as reverse-post-order DFS:</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#E5C890;font-style:italic">SetVector</span><span style="color:#949CBB">&#x3C;</span><span style="color:#E5C890;font-style:italic">Block</span><span style="color:#81C8BE"> *</span><span style="color:#949CBB">></span><span style="color:#E5C890"> mlir</span><span style="color:#949CBB">::</span><span style="color:#8CAAEE;font-style:italic">getBlocksSortedByDominance</span><span style="color:#949CBB">(</span><span style="color:#E5C890;font-style:italic">Region</span><span style="color:#81C8BE"> &#x26;</span><span style="color:#EA999C;font-style:italic">region</span><span style="color:#949CBB">)</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#737994;font-style:italic">    // For each block that has not been visited yet (i.e. that has no</span></span>
<span class="line"><span style="color:#737994;font-style:italic">    // predecessors), add it to the list as well as its successors.</span></span>
<span class="line"><span style="color:#C6D0F5">    SetVector</span><span style="color:#81C8BE">&#x3C;</span><span style="color:#C6D0F5">Block </span><span style="color:#81C8BE">*></span><span style="color:#C6D0F5"> blocks</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#CA9EE6">    for</span><span style="color:#949CBB"> (</span><span style="color:#C6D0F5">Block </span><span style="color:#81C8BE">&#x26;</span><span style="color:#C6D0F5">b </span><span style="color:#949CBB">:</span><span style="color:#C6D0F5"> region</span><span style="color:#949CBB">)</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#CA9EE6">         if</span><span style="color:#949CBB"> (</span><span style="color:#C6D0F5">blocks</span><span style="color:#949CBB">.</span><span style="color:#8CAAEE;font-style:italic">count</span><span style="color:#949CBB">(</span><span style="color:#81C8BE">&#x26;</span><span style="color:#C6D0F5">b</span><span style="color:#949CBB">)</span><span style="color:#81C8BE"> ==</span><span style="color:#EF9F76"> 0</span><span style="color:#949CBB">)</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#E5C890">               llvm</span><span style="color:#949CBB">::</span><span style="color:#C6D0F5">ReversePostOrderTraversal</span><span style="color:#81C8BE">&#x3C;</span><span style="color:#C6D0F5">Block </span><span style="color:#81C8BE">*></span><span style="color:#8CAAEE;font-style:italic"> traversal</span><span style="color:#949CBB">(</span><span style="color:#81C8BE">&#x26;</span><span style="color:#C6D0F5">b</span><span style="color:#949CBB">);</span></span>
<span class="line"><span style="color:#C6D0F5">               blocks</span><span style="color:#949CBB">.</span><span style="color:#8CAAEE;font-style:italic">insert</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">traversal</span><span style="color:#949CBB">.</span><span style="color:#8CAAEE;font-style:italic">begin</span><span style="color:#949CBB">(),</span><span style="color:#C6D0F5"> traversal</span><span style="color:#949CBB">.</span><span style="color:#8CAAEE;font-style:italic">end</span><span style="color:#949CBB">());</span></span>
<span class="line"><span style="color:#949CBB">         }</span></span>
<span class="line"><span style="color:#949CBB">    }</span></span>
<span class="line"><span style="color:#8CAAEE;font-style:italic">    assert</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">blocks</span><span style="color:#949CBB">.</span><span style="color:#8CAAEE;font-style:italic">size</span><span style="color:#949CBB">()</span><span style="color:#81C8BE"> ==</span><span style="color:#C6D0F5"> region</span><span style="color:#949CBB">.</span><span style="color:#8CAAEE;font-style:italic">getBlocks</span><span style="color:#949CBB">().</span><span style="color:#8CAAEE;font-style:italic">size</span><span style="color:#949CBB">()</span><span style="color:#81C8BE"> &#x26;&#x26;</span></span>
<span class="line"><span style="color:#A6D189">          "some blocks are not sorted"</span><span style="color:#949CBB">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CA9EE6">    return</span><span style="color:#C6D0F5"> blocks</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#949CBB">}</span></span></code></pre>
<p>At this point, we've gotten our hands on the block list. But Wimmer and Franz introduce a stronger condition: all
blocks belonging to the same loop must be continuous and that "TODO".</p>
<p>Personally, I think the API provided by MLIR won't
satisfy
the condition; there is a chance that a loop header block might be followed by its exit, non-looping block, and then,
the blocks that belong to the loop body.</p>
<p>The write up here follows the MP02 paper more. Thus the need for loop detection is left as an <a href="https://pages.cs.wisc.edu/~fischer/cs701.f14/finding.loops.html" rel="nofollow" target="_blank">afterthought</a></p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#737994;font-style:italic">                                        // the arg is from mlir::getBlocksSortedByDominance</span></span>
<span class="line"><span style="color:#E5C890;font-style:italic">SmaliCounter</span><span style="color:#949CBB">&#x3C;</span><span style="color:#E5C890;font-style:italic">Operation</span><span style="color:#81C8BE">*</span><span style="color:#949CBB">></span><span style="color:#8CAAEE;font-style:italic"> numberOperation</span><span style="color:#949CBB">(</span><span style="color:#E5C890;font-style:italic">SetVector</span><span style="color:#949CBB">&#x3C;</span><span style="color:#E5C890;font-style:italic">Block</span><span style="color:#81C8BE">*</span><span style="color:#949CBB">></span><span style="color:#EA999C;font-style:italic"> blocks</span><span style="color:#949CBB">)</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#C6D0F5">    SmaliCounter op_counter</span><span style="color:#949CBB">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CA9EE6">    for</span><span style="color:#949CBB"> (</span><span style="color:#CA9EE6">auto</span><span style="color:#81C8BE"> &#x26;</span><span style="color:#C6D0F5">block </span><span style="color:#949CBB">:</span><span style="color:#C6D0F5"> blocks</span><span style="color:#949CBB">)</span></span>
<span class="line"><span style="color:#CA9EE6">        for</span><span style="color:#949CBB"> (</span><span style="color:#CA9EE6">auto</span><span style="color:#81C8BE"> &#x26;</span><span style="color:#C6D0F5">op </span><span style="color:#949CBB">:</span><span style="color:#C6D0F5"> block</span><span style="color:#949CBB">)</span></span>
<span class="line"><span style="color:#C6D0F5">           op_counter</span><span style="color:#949CBB">.</span><span style="color:#8CAAEE;font-style:italic">get_counter</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">op</span><span style="color:#949CBB">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CA9EE6">    return</span><span style="color:#C6D0F5"> op_counter</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#949CBB">}</span></span></code></pre>
<ul>
<li>
<p>Construct the live ranges (with live holes).</p>
</li>
<li>
<p>Construct the</p>
</li>
</ul>
<h2 id="building-live-intervals-43"><a aria-hidden="true" tabindex="-1" href="#building-live-intervals-43"><span class="icon icon-link"></span></a>Building live intervals (4.3)</h2>
<p>In MP02, the paper starts off with what it means for an SSA variable to be live. Since we know that for a variable to be
used in block b, it must have been defined in either b or one of its predecessors p.</p>
<p>Let's call <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mrow><mi>v</mi><mo separator="true">,</mo><mi>b</mi></mrow></msub></mrow><annotation encoding="application/x-tex">r_{v,b}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> the live range
of an SSA variable in a block. MP02 describes different intricacies in handling this:</p>
<ul>
<li>An algorithm on calculating live ranges</li>
<li>How the live range of a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ϕ</span></span></span></span> variable should be.</li>
</ul>
<p>TODO: say how phi's hard to handle
TODO: you really should define a live range class.
TODO: Talk about how the MP02 paper conflates the live range of an instruction with an SSA value.</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#CA9EE6">using</span><span style="color:#E5C890;font-style:italic"> LRStart</span><span style="color:#81C8BE"> =</span><span style="color:#CA9EE6"> uint32_t</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#CA9EE6">using</span><span style="color:#E5C890;font-style:italic"> LREnd</span><span style="color:#81C8BE">=</span><span style="color:#CA9EE6"> uint32_t</span><span style="color:#949CBB">;</span></span>
<span class="line"><span style="color:#CA9EE6">using</span><span style="color:#E5C890;font-style:italic"> LiveRange</span><span style="color:#81C8BE"> =</span><span style="color:#E5C890"> std</span><span style="color:#949CBB">::</span><span style="color:#E5C890;font-style:italic">pair</span><span style="color:#949CBB">&#x3C;</span><span style="color:#E5C890;font-style:italic">LRStart</span><span style="color:#949CBB">,</span><span style="color:#E5C890;font-style:italic"> LREnd</span><span style="color:#949CBB">>;</span><span style="color:#737994;font-style:italic"> // From above description</span></span>
<span class="line"></span>
<span class="line"><span style="color:#737994;font-style:italic">// todo: do add range here</span></span>
<span class="line"><span style="color:#737994;font-style:italic">// todo: readers probably find the algorithm too complicated. you might wanna draw some kind of diagram.</span></span>
<span class="line"><span style="color:#CA9EE6">void</span><span style="color:#8CAAEE;font-style:italic"> add_range</span><span style="color:#949CBB">(</span><span style="color:#E5C890;font-style:italic">ins</span><span style="color:#EA999C;font-style:italic"> i</span><span style="color:#949CBB">,</span><span style="color:#E5C890;font-style:italic"> ssa</span><span style="color:#EA999C;font-style:italic"> value</span><span style="color:#949CBB">,</span><span style="color:#E5C890;font-style:italic"> block</span><span style="color:#EA999C;font-style:italic"> b</span><span style="color:#949CBB">,</span><span style="color:#E5C890;font-style:italic"> end</span><span style="color:#C6D0F5">: </span><span style="color:#CA9EE6">int32_t</span><span style="color:#949CBB">)</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#737994;font-style:italic">    // assume that ssa value ends its living at `end`</span></span>
<span class="line"><span style="color:#737994;font-style:italic">    // and that the instruction i uniquely defines the ssa value (of course cause its ssa duh hahaha)</span></span>
<span class="line"><span style="color:#737994;font-style:italic">    // jasmine plz do this</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CA9EE6">    if</span><span style="color:#949CBB"> (</span><span style="color:#C6D0F5">b</span><span style="color:#949CBB">.</span><span style="color:#8CAAEE;font-style:italic">contains_instruction</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">i</span><span style="color:#949CBB">))</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#C6D0F5">        live_interval</span><span style="color:#949CBB">[</span><span style="color:#C6D0F5">value</span><span style="color:#949CBB">].</span><span style="color:#8CAAEE;font-style:italic">combine_range</span><span style="color:#949CBB">(</span><span style="color:#8CAAEE;font-style:italic">numbering_of</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">i</span><span style="color:#949CBB">),</span><span style="color:#C6D0F5"> end</span><span style="color:#949CBB">);</span></span>
<span class="line"><span style="color:#949CBB">    }</span><span style="color:#CA9EE6"> else</span></span>
<span class="line"><span style="color:#C6D0F5">        live_interval</span><span style="color:#949CBB">[</span><span style="color:#C6D0F5">value</span><span style="color:#949CBB">].</span><span style="color:#8CAAEE;font-style:italic">combine_range</span><span style="color:#949CBB">(</span><span style="color:#8CAAEE;font-style:italic">numbering_of</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">b</span><span style="color:#949CBB">.</span><span style="color:#8CAAEE;font-style:italic">begin</span><span style="color:#949CBB">()),</span><span style="color:#C6D0F5"> end</span><span style="color:#949CBB">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#737994;font-style:italic">    // For example, the ranges [1,3[, [3,7[ are merged into a single range [1,7[</span></span>
<span class="line"><span style="color:#949CBB">}</span></span>
<span class="line"><span style="color:#E5C890;font-style:italic">DenseMap</span><span style="color:#949CBB">&#x3C;</span><span style="color:#E5C890;font-style:italic">Value</span><span style="color:#949CBB">,</span><span style="color:#E5C890;font-style:italic"> Vector</span><span style="color:#949CBB">&#x3C;</span><span style="color:#E5C890;font-style:italic">LiveRange</span><span style="color:#949CBB">>></span><span style="color:#8CAAEE;font-style:italic"> build_intervals</span><span style="color:#949CBB">(</span><span style="color:#E5C890;font-style:italic">Region</span><span style="color:#81C8BE"> &#x26;</span><span style="color:#EA999C;font-style:italic">region</span><span style="color:#949CBB">)</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#737994;font-style:italic">    // TODO: i know my ass will need the smali counter again soon. Maybe split the function here.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#737994;font-style:italic">    // TODO: We get the value from the operand like this</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CA9EE6">    for</span><span style="color:#C6D0F5"> b in blocks</span><span style="color:#949CBB">:</span></span>
<span class="line"><span style="color:#C6D0F5">        live </span><span style="color:#81C8BE">=</span><span style="color:#949CBB"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CA9EE6">    for</span><span style="color:#C6D0F5"> b in blocks</span><span style="color:#949CBB">:</span></span>
<span class="line"><span style="color:#CA9EE6">        for</span><span style="color:#C6D0F5"> s in b</span><span style="color:#949CBB">.</span><span style="color:#8CAAEE;font-style:italic">get_successors</span><span style="color:#949CBB">()</span><span style="color:#C6D0F5">:</span></span>
<span class="line"><span style="color:#C6D0F5">        b</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">live </span><span style="color:#81C8BE">=</span><span style="color:#C6D0F5"> b</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">live</span><span style="color:#949CBB">.</span><span style="color:#8CAAEE;font-style:italic">union</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">s</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">live</span><span style="color:#949CBB">)</span></span>
<span class="line"><span style="color:#CA9EE6">        for</span><span style="color:#C6D0F5"> each argument arg of the block s</span><span style="color:#949CBB">:</span></span>
<span class="line"><span style="color:#C6D0F5">            b</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">live </span><span style="color:#81C8BE">=</span><span style="color:#C6D0F5"> b</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">live </span><span style="color:#81C8BE">-</span><span style="color:#C6D0F5"> arg</span></span>
<span class="line"><span style="color:#CA9EE6">        for</span><span style="color:#C6D0F5"> each terminator t  in b</span><span style="color:#949CBB">:</span></span>
<span class="line"><span style="color:#C6D0F5">            b</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">live </span><span style="color:#81C8BE">=</span><span style="color:#C6D0F5"> b</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">live </span><span style="color:#CA9EE6">union</span><span style="color:#E5C890;font-style:italic"> t</span><span style="color:#C6D0F5">'s jump argument input</span></span>
<span class="line"><span style="color:#C6D0F5">        for each ssa value v in live do:</span></span>
<span class="line"><span style="color:#C6D0F5">            add_range(get_defining_instruction(v)</span><span style="color:#949CBB">,</span><span style="color:#E5C890;font-style:italic"> v</span><span style="color:#949CBB">,</span><span style="color:#E5C890;font-style:italic"> b</span><span style="color:#949CBB">,</span><span style="color:#E5C890;font-style:italic"> numbering_of</span><span style="color:#C6D0F5">(b.end()) + 1)</span></span>
<span class="line"><span style="color:#C6D0F5">        for instruction i in b.reverse():</span></span>
<span class="line"><span style="color:#C6D0F5">            b.live = b.live - i.defining_result()</span></span>
<span class="line"><span style="color:#C6D0F5">            for each op in i:</span></span>
<span class="line"><span style="color:#C6D0F5">            if op not in live:</span></span>
<span class="line"><span style="color:#C6D0F5">                b.live = b.live union op</span></span>
<span class="line"><span style="color:#C6D0F5">                add_range(get_defining_instruction(op)</span><span style="color:#949CBB">,</span><span style="color:#E5C890;font-style:italic"> op</span><span style="color:#949CBB">,</span><span style="color:#E5C890;font-style:italic"> b</span><span style="color:#949CBB">,</span><span style="color:#E5C890;font-style:italic"> numbering_of</span><span style="color:#C6D0F5">(i))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#737994;font-style:italic">    // todo: we do this because although we visualize ssa as having an inherent counter, it is not visible in the</span></span>
<span class="line"><span style="color:#C6D0F5">mlir api</span></span>
<span class="line"><span style="color:#C6D0F5">}</span></span></code></pre>
<p>todo: Note that we will not directly output any register. What we'll do is we'll have a 2D hash map that given an
instruction and an SSA value, we get out some new virtual registers that is not dependent on the smali counter.</p>
<h2 id="coalescing-arguments"><a aria-hidden="true" tabindex="-1" href="#coalescing-arguments"><span class="icon icon-link"></span></a>Coalescing arguments</h2>
<p>mlir::Value has <code>hasOneUse()</code></p>
<pre><code>if op = move a &#x3C;- b &#x26;&#x26; b.hasOneUse():
    union(a, b, uf)


mlir::Value find(mlir::Value v
void union(mlir::Value a, mlir::Value b, UF uf) {

}
</code></pre>
<h2 id="assigning-registers"><a aria-hidden="true" tabindex="-1" href="#assigning-registers"><span class="icon icon-link"></span></a>Assigning registers</h2>
<p>In greedily assigning SSA variables to registers -> needs priority queue to always get the lowest starting pointer
interval available.</p>
<p>note: need a register counter class, need composition for customized set.</p>
<p>note: need dedicated class for live range, it needs to optionally store a reg. It needs to have <code>bool ends_before (LiveRange other)</code> and <code>bool no_overlap()</code></p>
<p>note: set in C++ is binary tree, we can compromise speed of pq for ease of algo impl</p>
<p>4 different collections:</p>
<ul>
<li>unhandled (set): all intervals that start after cur.beg</li>
<li>handled (set) : all intervals end before cur.beg</li>
<li>active (set): all intervlas where one of the ranges overlap cur.beg</li>
<li>inactive (set): all intervals where cur.beg falls into one of their holes</li>
</ul>
<p>todo: explain to readers meaning of "ends before" versus "does not overlap"</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#8CAAEE;font-style:italic">LinearScan</span><span style="color:#949CBB">()</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#CA9EE6">    auto</span><span style="color:#C6D0F5"> unhandled </span><span style="color:#81C8BE">=</span><span style="color:#8CAAEE;font-style:italic"> get_ranges_from</span><span style="color:#949CBB">(</span><span style="color:#8CAAEE;font-style:italic">build_intervals</span><span style="color:#949CBB">(</span><span style="color:#C6D0F5">method</span><span style="color:#949CBB">))</span></span>
<span class="line"><span style="color:#C6D0F5">    DenseSet active</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> inactive</span><span style="color:#949CBB">,</span><span style="color:#C6D0F5"> handled</span><span style="color:#949CBB">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#CA9EE6">    while</span><span style="color:#949CBB"> (</span><span style="color:#81C8BE">!</span><span style="color:#C6D0F5">unhanlded</span><span style="color:#949CBB">.</span><span style="color:#8CAAEE;font-style:italic">empty</span><span style="color:#949CBB">())</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#CA9EE6">        auto</span><span style="color:#C6D0F5"> curr </span><span style="color:#81C8BE">=</span><span style="color:#C6D0F5"> unhandled</span><span style="color:#949CBB">.</span><span style="color:#8CAAEE;font-style:italic">top</span><span style="color:#949CBB">();</span><span style="color:#C6D0F5"> unhandled</span><span style="color:#949CBB">.</span><span style="color:#8CAAEE;font-style:italic">pop</span><span style="color:#949CBB">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CA9EE6">        for</span><span style="color:#949CBB"> (</span><span style="color:#CA9EE6">auto</span><span style="color:#C6D0F5"> i </span><span style="color:#949CBB">:</span><span style="color:#C6D0F5"> active</span><span style="color:#949CBB">)</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#737994;font-style:italic">            // todo</span></span>
<span class="line"><span style="color:#949CBB">        }</span></span>
<span class="line"><span style="color:#CA9EE6">        for</span><span style="color:#949CBB"> (</span><span style="color:#CA9EE6">auto</span><span style="color:#C6D0F5"> i </span><span style="color:#949CBB">:</span><span style="color:#C6D0F5"> inactive</span><span style="color:#949CBB">)</span><span style="color:#949CBB"> {</span></span>
<span class="line"><span style="color:#737994;font-style:italic">            // todo</span></span>
<span class="line"><span style="color:#949CBB">        }</span></span>
<span class="line"><span style="color:#949CBB">    }</span></span>
<span class="line"><span style="color:#949CBB">}</span></span></code></pre>
<p>todo: no concept of spilled.</p>
<p>todo: if we don't assign mem loc to an SSA, we need to prove that assign mem loc is the same as not assigning mem loc.</p>
<h2 id="obstacles"><a aria-hidden="true" tabindex="-1" href="#obstacles"><span class="icon icon-link"></span></a>Obstacles</h2>
<h2 id="resources"><a aria-hidden="true" tabindex="-1" href="#resources"><span class="icon icon-link"></span></a>Resources</h2>
<h3 id="papers"><a aria-hidden="true" tabindex="-1" href="#papers"><span class="icon icon-link"></span></a>Papers</h3>
<ul>
<li>MP02 - <a href="https://link.springer.com/content/pdf/10.1007/3-540-45937-5_17.pdf" rel="nofollow" target="_blank">Linear Scan Register Allocation in the Context of SSA Form and Register Constraints</a> - Hanspeter Mössenböck and Michael Pfeiffer.</li>
<li>WF10 <a href="http://www.christianwimmer.at/Publications/Wimmer10a/Wimmer10a.pdf" rel="nofollow" target="_blank">Linear Scan Register Allocation on SSA Form</a> -
Christian Wimmer and Michael Franz.</li>
<li><a href="https://web.cs.ucla.edu/~palsberg/course/cs132/linearscan.pdf" rel="nofollow" target="_blank">Linear Scan Register Allocation</a> - Massimiliano
Poletto and Vivek Sarkar.</li>
</ul>
<h3 id="textbooks"><a aria-hidden="true" tabindex="-1" href="#textbooks"><span class="icon icon-link"></span></a>Textbooks</h3>
<ul>
<li><a href="https://www.goodreads.com/book/show/60277251-engineering-a-compiler" rel="nofollow" target="_blank">Engineering a Compiler</a> - Keith D. Cooper and Linda Torczon.</li>
</ul>
<h3 id="ai-tools"><a aria-hidden="true" tabindex="-1" href="#ai-tools"><span class="icon icon-link"></span></a>AI tools</h3>
<p>Hahahaha you're really funny.</p></div></article></div><!--$--><!--/$--></div><button class="bottom-4 right-4 fixed"><div class="inline text-2xl font-bold border-black border-2 rounded  p-0 m-0 h-100 w-100">⇡⇡</div></button><footer class="footer self-center justify-center gap-2 pt-4 items-center italic "><p>Built by Jasmine with NextJS, TailwindCSS, and a tonnn of loveee :)</p></footer><script src="/_next/static/chunks/webpack-47bbed6067fe1d45.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[6874,[\"874\",\"static/chunks/874-437a265a67d6cfee.js\",\"880\",\"static/chunks/app/posts/%5Bid%5D/page-f0f7551128d4c13f.js\"],\"\"]\n3:I[7555,[],\"\"]\n4:I[1295,[],\"\"]\n5:I[7921,[\"874\",\"static/chunks/874-437a265a67d6cfee.js\",\"63\",\"static/chunks/63-63ed21df6f1fc3e7.js\",\"177\",\"static/chunks/app/layout-05e345a4cd50b3e1.js\"],\"default\"]\n7:I[9665,[],\"OutletBoundary\"]\n9:I[4911,[],\"AsyncMetadataOutlet\"]\nb:I[9665,[],\"ViewportBoundary\"]\nd:I[9665,[],\"MetadataBoundary\"]\ne:\"$Sreact.suspense\"\n10:I[8393,[],\"\"]\n:HL[\"/_next/static/media/7385e8d9d3c5518f-s.p.ttf\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/ttf\"}]\n:HL[\"/_next/static/css/3b37cf79ceb9ce8f.css\",\"style\"]\n:HL[\"/_next/static/css/3864b451a61e4546.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"QBXzGDkfmMcPbkr9Jh-4l\",\"p\":\"\",\"c\":[\"\",\"posts\",\"going_to_mlir_gym_2\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"going_to_mlir_gym_2\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/3b37cf79ceb9ce8f.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"px-4 py-4\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_d4e0c8 flex flex-col min-h-screen\",\"children\":[[\"$\",\"$L2\",null,{\"href\":\"/\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex justify-center items-center py-4 \",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-4xl font-bold\",\"children\":\"Jasmine Tang\"}]}]}],[\"$\",\"div\",null,{\"className\":\"flex-1\",\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"$L5\",null,{}],[\"$\",\"footer\",null,{\"className\":\"footer self-center justify-center gap-2 pt-4 items-center italic \",\"children\":[\"$\",\"p\",null,{\"children\":\"Built by Jasmine with NextJS, TailwindCSS, and a tonnn of loveee :)\"}]}]]}]}]]}],{\"children\":[\"posts\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"id\",\"going_to_mlir_gym_2\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L6\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/3864b451a61e4546.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L7\",null,{\"children\":[\"$L8\",[\"$\",\"$L9\",null,{\"promise\":\"$@a\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]],[\"$\",\"$Ld\",null,{\"children\":[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$e\",null,{\"fallback\":null,\"children\":\"$Lf\"}]}]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$10\",[]],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n8:null\n"])</script><script>self.__next_f.push([1,"12:I[8175,[],\"IconMark\"]\n11:Tfb97,"])</script><script>self.__next_f.push([1,"\u003cnav class=\"toc\"\u003e\u003col class=\"toc-level toc-level-1\"\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#prologue\"\u003ePrologue\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#reader-supporting-section\"\u003eReader supporting section\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#introduction\"\u003eIntroduction\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#differences\"\u003eDifferences\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#steps\"\u003eSteps\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#phis-in-register-allocation-41\"\u003ePhis in register allocation (4.1)\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#topo-blocks-and-numbering-42\"\u003eTopo blocks and numbering (4.2)\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#building-live-intervals-43\"\u003eBuilding live intervals (4.3)\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#coalescing-arguments\"\u003eCoalescing arguments\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#assigning-registers\"\u003eAssigning registers\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#obstacles\"\u003eObstacles\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#resources\"\u003eResources\u003c/a\u003e\u003col class=\"toc-level toc-level-2\"\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#papers\"\u003ePapers\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#textbooks\"\u003eTextbooks\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#ai-tools\"\u003eAI tools\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/nav\u003e\u003cp\u003e\u003ca href=\"https://www.youtube.com/watch?v=zAgVtzhjfCA\u0026#x26;ab_channel=SabrinaCarpenter-Topic\" rel=\"nofollow\" target=\"_blank\"\u003ePlease, please, please\u003c/a\u003e don't read\nit now. It's unfinished, and I'm not sure if it'll go into impl or design doc :)\u003c/p\u003e\n\u003ch2 id=\"prologue\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#prologue\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003ePrologue\u003c/h2\u003e\n\u003cp\u003eHi everyone, I hope everybody's been great :) I hope you like my last report for my graduate class \u003ca href=\"https://badumbatish.github.io/posts/going_to_mlir_gym_1\" rel=\"nofollow\" target=\"_blank\"\u003ehere\u003c/a\u003e. This article is also related to the same project. It\ndiscusses the\nSSA linear scan\nregister\nallocation algorithm and the steps taken to implement it.\u003c/p\u003e\n\u003cp\u003eJust like the last MLIR report post, I also include a supporting section (\u003cstrong\u003eSS\u003c/strong\u003e) right before the introduction for\nunfamiliar\nreader in the compiler space.\u003c/p\u003e\n\u003cp\u003eWithout reading the SS, I assume interested readers are familiar with some basic middle-end IR concepts (e.g \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\phi\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eϕ\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\nnotation, liveness analysis, loops).\u003c/p\u003e\n\u003cp\u003eWith reading the SS, there is some context from the last report's \u003ca href=\"https://badumbatish.github.io/posts/going_to_mlir_gym_1#reader-supporting-section\" rel=\"nofollow\" target=\"_blank\"\u003eSS\u003c/a\u003e that I think would be helpful.\u003c/p\u003e\n\u003cp\u003eAnd as is tradition, I also wanna share a \u003ca href=\"https://www.youtube.com/watch?v=5HFyoxqUi0g\u0026#x26;ab_channel=CROWONHYENAS\" rel=\"nofollow\" target=\"_blank\"\u003esong\u003c/a\u003e for\nyou to listen to while reading. Initially it was between this song and \u003ca href=\"https://www.youtube.com/watch?v=eW6f7mEXfPQ\u0026#x26;ab_channel=HipHopDXAsia\" rel=\"nofollow\" target=\"_blank\"\u003ethat\u003c/a\u003e song. What can I say? I guess this is a long form way to say I want you to listen to\nboth :)\u003c/p\u003e\n\u003cp\u003eI hope everybody enjoys :)\u003c/p\u003e\n\u003ch2 id=\"reader-supporting-section\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#reader-supporting-section\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eReader supporting section\u003c/h2\u003e\n\u003cp\u003e\u003c/p\u003e\u003cdetails\u003e\u003csummary\u003eOpen Reader supporting section\u003c/summary\u003e\u003cp\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eDominance: In a CFG, with the entry basic block \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eB\u003c/mi\u003e\u003cmsub\u003e\u003cmi\u003eB\u003c/mi\u003e\u003cmn\u003e0\u003c/mn\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eBB_0\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.05017em;\"\u003eB\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.05017em;\"\u003eB\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e and any two basic block A and B, if all paths from\n\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eB\u003c/mi\u003e\u003cmsub\u003e\u003cmi\u003eB\u003c/mi\u003e\u003cmn\u003e0\u003c/mn\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eBB_0\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.05017em;\"\u003eB\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.05017em;\"\u003eB\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e to B goes through A, then A is said to dominate B. The notation for dominance is A\n\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmo\u003e≫\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\gg\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≫\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e B and every node is said to dominate itself.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eDataflow analysis: Abstractly, dataflow analysis is a way to understand how data moves and changes throughout a\ncomputer program.\nIt helps us track what happens to different values (like variables) as the program runs from start to finish.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eFor example, when \u003ca href=\"https://en.wikipedia.org/wiki/Reaching_definition\" rel=\"nofollow\" target=\"_blank\"\u003ereaching definition\u003c/a\u003e is\nrun, the compiler can detect if some variable is possibly uninitialized and warn us if such cases appear:\u003c/p\u003e\n\u003cpre class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e// Just an example for reaching definition.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003efn\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003e reaching_def_example\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#EA999C\"\u003econdition\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e bool\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e x\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003e i32\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e // x is declared but not initialized\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e condition \u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e{\u003c/span\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e // if this `if` condition is `false`,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e       x \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#EF9F76\"\u003e 5\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e      // `x` is not initialized\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003e    println!\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#A6D189\"\u003e\"\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e{}\u003c/span\u003e\u003cspan style=\"color:#A6D189\"\u003e\"\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e x\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e);\u003c/span\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e // Warning: x might be uninitialized\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e                      // if condition is false\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eLoop header: In hand with dominance, a block is said to be a loop header if it dominates one of its\npredecessors (a block that points to it). Knowing what a loop header is, and later identifying it would be of great\nhelp in\nour live intervals (of our linear register allocator) construction. As in the paper by Wimmer and Franz, their live\nintervals construction bypasses the dataflow analysis cost itself, simply on the concept of dominance and loop header.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eBefore heading further, let's look at an example for the two concepts.\u003c/p\u003e\n\u003cp\u003eIn this control flow graph, A dominates every BB, including itself.\nB dominates D; even though there is a path from\nD to B, it must have first passed from B first. Since B dominates its predecessor, B is a loop header; hence,\nthere is a loop :)\u003c/p\u003e\n\u003cp\u003eD is:\n\u003cimg src=\"/blogs/dominance_mlir_gym_2.svg\" alt=\"dominance_mlir_gym_2.svg\"\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eLive interval and Live ranges pre-notes: Different papers derive the meaning of a live range differently. For example,\nin Engineering a\nCompiler 2nd Edition pg. 690, live range is a closed set of pairs of use and def locations. In Mössenböck \u0026#x26;\nPfeiffer, the roughly same definition is dedicated to \u003ccode\u003elive intervals\u003c/code\u003e, leaving the meaning of \u003ccode\u003erange\u003c/code\u003e to just mean\na pair of \u003ccode\u003euse\u003c/code\u003e and \u003ccode\u003edef\u003c/code\u003e. I chose to follow the definition laid out by Mössenböck \u0026#x26; Pfeiffer where a live interval\ncontains an ordered list of live ranges. [todo, add some example here, or the next two section?]\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eFor example:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e// Add an example here pleaseeeeeeeee \u003e,\u0026#x3C;\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOverall, the concepts were born to ease the job of register allocators. If some variables are not live anymore\n(since their definitions), their registers can be reused for another variable instead. In this view, contention for a\nregister (a scarce resource)\nbetween some variables can instead be seen as the intersection (or lack thereof) between different live ranges. In\nthis effect, at the register allocation phase, the compiler effective translates the tradition SSA variable naming\nscheme into a set of live intervals.\u003c/p\u003e\n\u003cp\u003eHopefully, after\nreading the two (closely related) definitions and seeing how they're defined to solve the same problem, we've cleared\nup the\nconfusion.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eTerminologies: in this article, sometimes I refer to SSA variables as mlir::Value. This boils down to the same\nconcept: a variable that is defined only once (and cannot be changed).\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003c/details\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 id=\"introduction\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#introduction\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003etodo: refer to this \u003ca href=\"https://ieeexplore.ieee.org/document/7924389\" rel=\"nofollow\" target=\"_blank\"\u003ehttps://ieeexplore.ieee.org/document/7924389\u003c/a\u003e\nRegister allocation is an important aspect in the compiler construction phase.\nRegisters being the fastest\n(but most limited) in the memory hierarchy, the compiler's register allocator must be strategic about this\nresource, more usages in registers instead of the stack means reduced latency and\nimproved execution speed.\u003c/p\u003e\n\u003cp\u003eIn the case of our recompiler, the main motivation related to obfuscation. \u003ca href=\"https://farena.in/\" rel=\"nofollow\" target=\"_blank\"\u003eEdu\u003c/a\u003e's employer,\n\u003ca href=\"https://www.quarkslab.com/\" rel=\"nofollow\" target=\"_blank\"\u003eQuarkslab\u003c/a\u003e is interested in applying obfuscation method to DEX files. With the methods\ngenerating a lot of virtual registers, there were concerns about it exceeding the limit of \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsup\u003e\u003cmn\u003e2\u003c/mn\u003e\u003cmn\u003e16\u003c/mn\u003e\u003c/msup\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e65\u003c/mn\u003e\u003cmo separator=\"true\"\u003e,\u003c/mo\u003e\u003cmn\u003e536\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e2^{16} = 65,536\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8141em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord\"\u003e2\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8141em;\"\u003e\u003cspan style=\"top:-3.063em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e16\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e65\u003c/span\u003e\u003cspan class=\"mpunct\"\u003e,\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e536\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e virtual\nregisters. In this case, the linear register allocation project helps bring down the number of virtual registers under\nthe limit (of course they can just run less obfuscation hahahah).\u003c/p\u003e\n\u003cp\u003eThis article then draws the learning mainly from three sources: the text book Engineer a Compiler, and two papers\nfrom Mössenböck \u0026#x26; Pfeiffer \u003ca href=\"https://link.springer.com/content/pdf/10.1007/3-540-45937-5_17.pdf\" rel=\"nofollow\" target=\"_blank\"\u003eMP02\u003c/a\u003e and Wimmer \u0026#x26; Franz \u003ca href=\"http://www.christianwimmer.at/Publications/Wimmer10a/Wimmer10a.pdf\" rel=\"nofollow\" target=\"_blank\"\u003eWF10\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003ePersonally, this is also another opportunity for me to improve my compiler arsenal. Some undergraduate compiler\nclasses leave this part out or only as part of a pen and paper exercise; knowing how to perform register allocation\n(and writing about it)\nwould be a big push in the direction.\u003c/p\u003e\n\u003cp\u003eAll discussed concepts are driven from the links in the resources section.\u003c/p\u003e\n\u003ch2 id=\"differences\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#differences\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eDifferences\u003c/h2\u003e\n\u003cp\u003eWe're planning to improve the lowering of MjolnIR to smali. What this means is that instead of lowering directly\nfrom SSA variables to virtual registers with\n\u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003etemplate\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e Aspect\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003e class\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e SmaliCounter\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e, we lower indirectly with our register\nallocation, first translating them into the namespace of live intervals first, then down to virtual registers.\u003c/p\u003e\n\u003cp\u003eMore specifically, we'll :\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eProduce live intervals from ssa values and their uses and defs.\u003c/li\u003e\n\u003cli\u003eOptionally merge \u003ccode\u003ecompatible\u003c/code\u003e live intervals together (the process is called coalescing).\u003c/li\u003e\n\u003cli\u003eLower down to virtual registers.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThis new process introduces new stages that are clearly described and compared through this diagram.\u003c/p\u003e\n\u003cp\u003e[todo add mermaid here]\u003c/p\u003e\n\u003ch2 id=\"steps\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#steps\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eSteps\u003c/h2\u003e\n\u003cp\u003eTo say that linear register allocation simply comprises 3 steps is a simplification. The three big steps eventually\nbreak down into substeps when a reader starts asking these questions of the sort: Where and how do\nwe get our live intervals? How do we map SSA value to a said interval? What mechanics helps us merge \u003ccode\u003ecompatible\u003c/code\u003e? How is\nMLIR helping here? We'll\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFirst discuss the problem of \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\phi\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eϕ\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e in the context of live intervals.\u003c/li\u003e\n\u003cli\u003eNumber the mlir operation via the topological ordering of basic blocks.\u003c/li\u003e\n\u003cli\u003eConstruct our live intervals.\u003c/li\u003e\n\u003cli\u003eCoalesce\u003c/li\u003e\n\u003cli\u003eTranslate to virtual registers, during this time we might split intervals to produce what is called live holes.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIt is important to note that although I follow the MP02 paper, some recaps for WF10 will also be noted.\u003c/p\u003e\n\u003ch2 id=\"phis-in-register-allocation-41\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#phis-in-register-allocation-41\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003ePhis in register allocation (4.1)\u003c/h2\u003e\n\u003cp\u003eThe (natural) nuisance of \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\phi\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eϕ\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003es is rooted in the idea of false registers contention. If two basic blocks \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003eB\u003c/mi\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eB_1\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.05017em;\"\u003eB\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e and \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003eB\u003c/mi\u003e\u003cmn\u003e2\u003c/mn\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eB_2\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.05017em;\"\u003eB\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e with their respective SSA\nvariables \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003eb\u003c/mi\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eb_1\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003eb\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e and \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003eb\u003c/mi\u003e\u003cmn\u003e2\u003c/mn\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eb_2\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003eb\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e both connect at basic block \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eC\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eC\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.07153em;\"\u003eC\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e with the \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmi\u003ec\u003c/mi\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\phi_{c}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003eϕ\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ec\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e, the two SSA variables (and the \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\phi\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eϕ\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e)\nall refers to the same entity. In this case, even though the live range of \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003eb\u003c/mi\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eb_1\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003eb\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e and \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003eb\u003c/mi\u003e\u003cmn\u003e2\u003c/mn\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eb_2\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003eb\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e clashes together,\nthey should still share the same register.\u003c/p\u003e\n\u003cp\u003eTo navigate this, we often perform a preprocessing step called copy generation or move generation: add a proxy move instruction\nand introduce new SSA variables to make sure that \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003eb\u003c/mi\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eb_1\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003eb\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e and \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003eb\u003c/mi\u003e\u003cmn\u003e2\u003c/mn\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eb_2\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003eb\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e doesn't clash anymore, then perform a step called register coalesce to join them together.\u003c/p\u003e\n\u003cp\u003eIn this context, different papers (MP02 and WF10) handle this problem differently in terms of preprocessing the graph.\nExpectedly, the two papers made\nno mention of MLIR (of course hahaa).\u003c/p\u003e\n\u003cp\u003eIdea: The idea is that in MLIR, we can use MjolnIR's move op on these.\u003c/p\u003e\n\u003cp\u003ethese \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003eb\u003c/mi\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eb_1\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003eb\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e and \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003eb\u003c/mi\u003e\u003cmn\u003e2\u003c/mn\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eb_2\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003eb\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e is the resulting\noperands of\n\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003eB\u003c/mi\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eB_1\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.05017em;\"\u003eB\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e and\n\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003eB\u003c/mi\u003e\u003cmn\u003e2\u003c/mn\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eB_2\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.05017em;\"\u003eB\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e's terminators and\nthat when the control flows to \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eC\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eC\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.07153em;\"\u003eC\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e, their representation turns into \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmi\u003ec\u003c/mi\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\phi_{c}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003eϕ\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ec\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e. Simply put, we can focus on\ngenerating the virtual registers for \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmi\u003ec\u003c/mi\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\phi_{c}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003eϕ\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ec\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e and produce redundant moves as the first step for the algorithm.\u003c/p\u003e\n\u003cp\u003etodo: show the graph of B1 and B2 flowing into C.\ntodo: discuss Brock and then wimmer.\u003c/p\u003e\n\u003ch2 id=\"topo-blocks-and-numbering-42\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#topo-blocks-and-numbering-42\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eTopo blocks and numbering (4.2)\u003c/h2\u003e\n\u003cp\u003eIn order for a live range to make sense, we need to know where (or when) does an SSA value start living and where (or when)\ndoes an SSA value ends its life. To do this, we need to number the instruction topologically.\u003c/p\u003e\n\u003cp\u003eIn linear scan register allocation, after we have handled our \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\phi\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eϕ\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003es as prescribed above, we then flatten the CFG\ninto a list of\nbasic blocks topologically. In a DAG, this reduces to Reverse Post Order traversal, or RPO for short.\u003c/p\u003e\n\u003cp\u003eThe reason for this is todo: numbering the op\u003c/p\u003e\n\u003cp\u003eIn both the MP02 and the\nWF10 paper, this is achieved with an ordered list based on the BB's dominance. I should also note here that\nordered (in layperson terms)\nmeans that if\nblock A arrives before block B, then block B cannot dominate block A.\u003c/p\u003e\n\u003cp\u003eSince the topological ordering of the graph naturally lends itself to a dominance ordered list, MLIR itself shows\nits definition for \u003cspan class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E5C890\"\u003emlir\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003egetBlocksSortedByDominance\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/span\u003e as reverse-post-order DFS:\u003c/p\u003e\n\u003cpre class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003eSetVector\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003eBlock\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e *\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003e mlir\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003egetBlocksSortedByDominance\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003eRegion\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#EA999C;font-style:italic\"\u003eregion\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e    // For each block that has not been visited yet (i.e. that has no\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e    // predecessors), add it to the list as well as its successors.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    SetVector\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eBlock \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e*\u003e\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e blocks\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e    for\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eBlock \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eb \u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e region\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e         if\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eblocks\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003ecount\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e ==\u003c/span\u003e\u003cspan style=\"color:#EF9F76\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E5C890\"\u003e               llvm\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eReversePostOrderTraversal\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eBlock \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e*\u003e\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003e traversal\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e               blocks\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003einsert\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003etraversal\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003ebegin\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(),\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e traversal\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003eend\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e         }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003e    assert\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eblocks\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003esize\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e ==\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e region\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003egetBlocks\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e().\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003esize\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e \u0026#x26;\u0026#x26;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#A6D189\"\u003e          \"some blocks are not sorted\"\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e blocks\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAt this point, we've gotten our hands on the block list. But Wimmer and Franz introduce a stronger condition: all\nblocks belonging to the same loop must be continuous and that \"TODO\".\u003c/p\u003e\n\u003cp\u003ePersonally, I think the API provided by MLIR won't\nsatisfy\nthe condition; there is a chance that a loop header block might be followed by its exit, non-looping block, and then,\nthe blocks that belong to the loop body.\u003c/p\u003e\n\u003cp\u003eThe write up here follows the MP02 paper more. Thus the need for loop detection is left as an \u003ca href=\"https://pages.cs.wisc.edu/~fischer/cs701.f14/finding.loops.html\" rel=\"nofollow\" target=\"_blank\"\u003eafterthought\u003c/a\u003e\u003c/p\u003e\n\u003cpre class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e                                        // the arg is from mlir::getBlocksSortedByDominance\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003eSmaliCounter\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003eOperation\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003e numberOperation\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003eSetVector\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003eBlock\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#EA999C;font-style:italic\"\u003e blocks\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    SmaliCounter op_counter\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e    for\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003eauto\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eblock \u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e blocks\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e        for\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003eauto\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eop \u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e block\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e           op_counter\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003eget_counter\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eop\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e op_counter\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eConstruct the live ranges (with live holes).\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eConstruct the\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"building-live-intervals-43\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#building-live-intervals-43\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eBuilding live intervals (4.3)\u003c/h2\u003e\n\u003cp\u003eIn MP02, the paper starts off with what it means for an SSA variable to be live. Since we know that for a variable to be\nused in block b, it must have been defined in either b or one of its predecessors p.\u003c/p\u003e\n\u003cp\u003eLet's call \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003er\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003ev\u003c/mi\u003e\u003cmo separator=\"true\"\u003e,\u003c/mo\u003e\u003cmi\u003eb\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003er_{v,b}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\"\u003er\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3361em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\"\u003ev\u003c/span\u003e\u003cspan class=\"mpunct mtight\"\u003e,\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight\"\u003eb\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2861em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e the live range\nof an SSA variable in a block. MP02 describes different intricacies in handling this:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAn algorithm on calculating live ranges\u003c/li\u003e\n\u003cli\u003eHow the live range of a \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\phi\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eϕ\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e variable should be.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eTODO: say how phi's hard to handle\nTODO: you really should define a live range class.\nTODO: Talk about how the MP02 paper conflates the live range of an instruction with an SSA value.\u003c/p\u003e\n\u003cpre class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003eusing\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e LRStart\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003e uint32_t\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003eusing\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e LREnd\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003e uint32_t\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003eusing\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e LiveRange\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#E5C890\"\u003e std\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003epair\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003eLRStart\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e LREnd\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e\u003e;\u003c/span\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e // From above description\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e// todo: do add range here\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e// todo: readers probably find the algorithm too complicated. you might wanna draw some kind of diagram.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003evoid\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003e add_range\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003eins\u003c/span\u003e\u003cspan style=\"color:#EA999C;font-style:italic\"\u003e i\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e ssa\u003c/span\u003e\u003cspan style=\"color:#EA999C;font-style:italic\"\u003e value\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e block\u003c/span\u003e\u003cspan style=\"color:#EA999C;font-style:italic\"\u003e b\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e end\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003eint32_t\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e    // assume that ssa value ends its living at `end`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e    // and that the instruction i uniquely defines the ssa value (of course cause its ssa duh hahaha)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e    // jasmine plz do this\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003econtains_instruction\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003ei\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e))\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e        live_interval\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003evalue\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e].\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003ecombine_range\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003enumbering_of\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003ei\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e),\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e end\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e    }\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003e else\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e        live_interval\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003evalue\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e].\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003ecombine_range\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003enumbering_of\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003ebegin\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e()),\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e end\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e    // For example, the ranges [1,3[, [3,7[ are merged into a single range [1,7[\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003eDenseMap\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003eValue\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e Vector\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003eLiveRange\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003e build_intervals\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003eRegion\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#EA999C;font-style:italic\"\u003eregion\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e    // TODO: i know my ass will need the smali counter again soon. Maybe split the function here.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e    // TODO: We get the value from the operand like this\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e    for\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e b in blocks\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e        live \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e    for\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e b in blocks\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e        for\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e s in b\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003eget_successors\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e        b\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003elive \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e b\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003elive\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003eunion\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003es\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003elive\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e        for\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e each argument arg of the block s\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e            b\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003elive \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e b\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003elive \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e arg\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e        for\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e each terminator t  in b\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e            b\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003elive \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e b\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003elive \u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003eunion\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e t\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e's jump argument input\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e        for each ssa value v in live do:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e            add_range(get_defining_instruction(v)\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e v\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e b\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e numbering_of\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e(b.end()) + 1)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e        for instruction i in b.reverse():\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e            b.live = b.live - i.defining_result()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e            for each op in i:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e            if op not in live:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e                b.live = b.live union op\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e                add_range(get_defining_instruction(op)\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e op\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e b\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#E5C890;font-style:italic\"\u003e numbering_of\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e(i))\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e    // todo: we do this because although we visualize ssa as having an inherent counter, it is not visible in the\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003emlir api\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003etodo: Note that we will not directly output any register. What we'll do is we'll have a 2D hash map that given an\ninstruction and an SSA value, we get out some new virtual registers that is not dependent on the smali counter.\u003c/p\u003e\n\u003ch2 id=\"coalescing-arguments\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#coalescing-arguments\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eCoalescing arguments\u003c/h2\u003e\n\u003cp\u003emlir::Value has \u003ccode\u003ehasOneUse()\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eif op = move a \u0026#x3C;- b \u0026#x26;\u0026#x26; b.hasOneUse():\n    union(a, b, uf)\n\n\nmlir::Value find(mlir::Value v\nvoid union(mlir::Value a, mlir::Value b, UF uf) {\n\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"assigning-registers\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#assigning-registers\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eAssigning registers\u003c/h2\u003e\n\u003cp\u003eIn greedily assigning SSA variables to registers -\u003e needs priority queue to always get the lowest starting pointer\ninterval available.\u003c/p\u003e\n\u003cp\u003enote: need a register counter class, need composition for customized set.\u003c/p\u003e\n\u003cp\u003enote: need dedicated class for live range, it needs to optionally store a reg. It needs to have \u003ccode\u003ebool ends_before (LiveRange other)\u003c/code\u003e and \u003ccode\u003ebool no_overlap()\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003enote: set in C++ is binary tree, we can compromise speed of pq for ease of algo impl\u003c/p\u003e\n\u003cp\u003e4 different collections:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eunhandled (set): all intervals that start after cur.beg\u003c/li\u003e\n\u003cli\u003ehandled (set) : all intervals end before cur.beg\u003c/li\u003e\n\u003cli\u003eactive (set): all intervlas where one of the ranges overlap cur.beg\u003c/li\u003e\n\u003cli\u003einactive (set): all intervals where cur.beg falls into one of their holes\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003etodo: explain to readers meaning of \"ends before\" versus \"does not overlap\"\u003c/p\u003e\n\u003cpre class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003eLinearScan\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e    auto\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e unhandled \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003e get_ranges_from\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003ebuild_intervals\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003emethod\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e))\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e    DenseSet active\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e inactive\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e handled\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e    while\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003eunhanlded\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003eempty\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e())\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e        auto\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e curr \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e unhandled\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003etop\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e();\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e unhandled\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003epop\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e        for\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003eauto\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e i \u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e active\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e            // todo\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#CA9EE6\"\u003e        for\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#CA9EE6\"\u003eauto\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e i \u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e inactive\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e            // todo\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003etodo: no concept of spilled.\u003c/p\u003e\n\u003cp\u003etodo: if we don't assign mem loc to an SSA, we need to prove that assign mem loc is the same as not assigning mem loc.\u003c/p\u003e\n\u003ch2 id=\"obstacles\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#obstacles\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eObstacles\u003c/h2\u003e\n\u003ch2 id=\"resources\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#resources\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eResources\u003c/h2\u003e\n\u003ch3 id=\"papers\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#papers\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003ePapers\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eMP02 - \u003ca href=\"https://link.springer.com/content/pdf/10.1007/3-540-45937-5_17.pdf\" rel=\"nofollow\" target=\"_blank\"\u003eLinear Scan Register Allocation in the Context of SSA Form and Register Constraints\u003c/a\u003e - Hanspeter Mössenböck and Michael Pfeiffer.\u003c/li\u003e\n\u003cli\u003eWF10 \u003ca href=\"http://www.christianwimmer.at/Publications/Wimmer10a/Wimmer10a.pdf\" rel=\"nofollow\" target=\"_blank\"\u003eLinear Scan Register Allocation on SSA Form\u003c/a\u003e -\nChristian Wimmer and Michael Franz.\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://web.cs.ucla.edu/~palsberg/course/cs132/linearscan.pdf\" rel=\"nofollow\" target=\"_blank\"\u003eLinear Scan Register Allocation\u003c/a\u003e - Massimiliano\nPoletto and Vivek Sarkar.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"textbooks\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#textbooks\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eTextbooks\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.goodreads.com/book/show/60277251-engineering-a-compiler\" rel=\"nofollow\" target=\"_blank\"\u003eEngineering a Compiler\u003c/a\u003e - Keith D. Cooper and Linda Torczon.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"ai-tools\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#ai-tools\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eAI tools\u003c/h3\u003e\n\u003cp\u003eHahahaha you're really funny.\u003c/p\u003e"])</script><script>self.__next_f.push([1,"6:[\"$\",\"div\",null,{\"className\":\"py-12 flex flex-col items-center  justify-items-start mx-auto \",\"children\":[[\"$\",\"$L2\",null,{\"href\":\"/blog\",\"className\":\"flex justify-center text-4xl\",\"children\":[\"$\",\"h2\",null,{\"children\":\"My blog\"}]}],[\"$\",\"article\",null,{\"className\":\"p-8 prose pt-0.5 max-w-none w-full lg:w-1/2 md:w-4/6 sm:w-5/6 prose-sky mx-auto\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex justify-center text-2xl font-bold \",\"children\":[\"$\",\"h2\",null,{\"children\":\"[HIATUS] Going to the gym with MLIR: Linear register allocation for ... a stackless virtual machine?\"}]}],[\"$\",\"div\",null,{\"className\":\"flex justify-start text-xl font-bold underline\",\"children\":[\"$\",\"h4\",null,{\"children\":\"2025-01-16\"}]}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$11\"}}]]}]]}]\n"])</script><script>self.__next_f.push([1,"a:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"[HIATUS] Going to the gym with MLIR: Linear register allocation for ... a stackless virtual machine?\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Jasmine plans out register allocation for the DEX recompiler.\"}],[\"$\",\"link\",\"2\",{\"rel\":\"icon\",\"href\":\"/_next/static/media/pfp5.0daa0f7d.jpeg\"}],[\"$\",\"$L12\",\"3\",{}]],\"error\":null,\"digest\":\"$undefined\"}\nf:\"$a:metadata\"\n"])</script></body></html>